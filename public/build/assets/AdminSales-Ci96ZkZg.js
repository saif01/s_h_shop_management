import{_ as B,c as p,a as l,w as i,r as d,m as L,o as m,i as T,d as F,b as s,f as g,t as r,e as x,l as X,F as z,h as O,p as K}from"./app-B76V_J0T.js";import{a as W}from"./adminPaginationMixin-BpksgI63.js";const Z={props:["fieldLabel","required","variant","min","initialDate"],data(){return{isMenuOpen:null,selectedDate:this.initialDate==null?null:new Date(this.initialDate),dbFormatDate:null,dateFieldLavel:this.fieldLabel??"Selected date",fieldPlaceHolder:"Enter "+this.fieldLabel,yesterdayIso:new Date(new Date().setDate(new Date().getDate()-1))}},computed:{computedCustomValue(){if(this.selectedDate)return this.frmtInsideDate(this.selectedDate)}},watch:{computedCustomValue:function(a){a&&this.dbFormatDate!==null&&this.$emit("trigerInputValue",this.dbFormatDate)},initialDate:function(a){a?(this.selectedDate=new Date(a),this.$nextTick(()=>{this.computedCustomValue&&this.dbFormatDate&&this.$emit("trigerInputValue",this.dbFormatDate)})):(this.selectedDate=null,this.dbFormatDate=null,this.$emit("trigerInputValue",null))}},mounted(){this.initialDate&&this.selectedDate&&this.$nextTick(()=>{this.computedCustomValue&&this.dbFormatDate&&this.$emit("trigerInputValue",this.dbFormatDate)})},methods:{onClear(){this.selectedDate=null,this.dbFormatDate=null,this.$emit("trigerInputValue",null)},frmtInsideDate(a){const t=new Date(a),n=t.getDate(),_=t.getMonth()+1,e=t.getFullYear(),o=n.toString().padStart(2,"0"),c=_.toString().padStart(2,"0"),v=`${o}/${c}/${e}`;return this.dbFormatDate=`${e}-${c}-${o}`,v}}};function $(a,t,n,_,e,o){const c=d("v-text-field"),v=d("v-date-picker"),b=d("v-menu");return m(),p("div",null,[l(b,{modelValue:e.isMenuOpen,"onUpdate:modelValue":t[3]||(t[3]=h=>e.isMenuOpen=h),"close-on-content-click":!1},{activator:i(({props:h})=>[l(c,L({label:e.dateFieldLavel,placeholder:e.fieldPlaceHolder,"model-value":o.computedCustomValue,readonly:""},h,{clearable:"","onClick:clear":t[0]||(t[0]=y=>o.onClear()),density:"compact",class:n.required?"required":null,variant:n.variant?n.variant:"outlined",rules:[n.required?y=>!!y||`This ${e.dateFieldLavel} is required`:null]}),null,16,["label","placeholder","model-value","class","variant","rules"])]),default:i(()=>[l(v,{"show-adjacent-months":"","hide-header":"","hide-actions":"",position:"sticky",modelValue:e.selectedDate,"onUpdate:modelValue":[t[1]||(t[1]=h=>e.selectedDate=h),t[2]||(t[2]=h=>(e.isMenuOpen=!1,n.initialDate=null))],min:n.min?e.yesterdayIso:null},null,8,["modelValue","min"])]),_:1},8,["modelValue"])])}const tt=B(Z,[["render",$]]),et={name:"SaleDialog",mixins:[W],components:{DatePickerVuetifyInput:tt},props:{modelValue:{type:Boolean,required:!0},sale:{type:Object,default:null}},emits:["update:modelValue","saved"],data(){return{form:this.getEmptyForm(),formValid:!1,cartItems:[],productSearch:"",searchResults:[],mostSoldProducts:[],customers:[],warehouses:[],saving:!1,paymentMethod:"cash",paymentMethods:[{title:"Cash",value:"cash"},{title:"Card",value:"card"},{title:"Mobile Banking",value:"mobile_banking"},{title:"Bank Transfer",value:"bank_transfer"},{title:"Cheque",value:"cheque"}],rules:{required:a=>!!a||"Required"},discountAmountManuallySet:!1,taxAmountManuallySet:!1}},computed:{isEdit(){return!!this.form.id},calculatedItemsDiscount(){return this.cartItems.reduce((a,t)=>a+(t.discount||0),0)},calculatedItemsTax(){return this.cartItems.reduce((a,t)=>a+(t.tax||0),0)},calculatedTotalTax(){const a=this.calculatedItemsTax,t=parseFloat(this.form.tax_amount)||0,n=this.form.tax_amount>0||this.taxAmountManuallySet||this.form.tax_amount===0&&a===0?t:0;return a+n}},watch:{sale:{immediate:!0,async handler(a){a&&a.id?await this.loadSaleForEdit(a.id):(this.form=this.getEmptyForm(),this.cartItems=[],this.discountAmountManuallySet=!1,this.taxAmountManuallySet=!1)}},modelValue(a){a?(this.fetchOptions(),this.fetchMostSoldProducts(),(!this.sale||!this.sale.id)&&(this.form=this.getEmptyForm(),this.cartItems=[],this.discountAmountManuallySet=!1,this.taxAmountManuallySet=!1)):(this.form=this.getEmptyForm(),this.cartItems=[],this.discountAmountManuallySet=!1,this.taxAmountManuallySet=!1)}},methods:{getEmptyForm(){return{id:null,customer_id:null,warehouse_id:null,invoice_date:new Date().toISOString().split("T")[0],due_date:null,subtotal:0,tax_amount:0,discount_amount:0,shipping_cost:0,total_amount:0,paid_amount:0,balance_amount:0,notes:""}},async fetchOptions(){try{const[a,t]=await Promise.all([T.get("/api/v1/customers"),T.get("/api/v1/warehouses")]);this.customers=a.data.data||a.data.customers||[],this.warehouses=t.data.data||t.data.warehouses||[]}catch(a){console.error("Failed to load options",a)}},async fetchMostSoldProducts(){try{const{data:a}=await T.get("/api/v1/products",{params:{per_page:10,is_active:1,sort:"most_sold",order:"desc"}});let t=a.data||a.products||[];if(t.length===0){const{data:n}=await T.get("/api/v1/products",{params:{per_page:10,is_active:1,has_stock:1}});t=n.data||n.products||[]}this.mostSoldProducts=t.filter(n=>n.stock_quantity>0).slice(0,10)}catch(a){console.error("Failed to load most sold products",a)}},async searchProducts(){if(this.productSearch)try{const{data:a}=await T.get("/api/v1/products",{params:{search:this.productSearch,per_page:10}});this.searchResults=a.data||a.products||[]}catch(a){console.error("Failed to search products",a)}},addToCart(a){const t=this.cartItems.findIndex(n=>n.product_id===a.id);if(t>=0)this.cartItems[t].quantity++,this.updateCartItem(t);else{const n=parseFloat(a.tax_rate||0);this.cartItems.push({product_id:a.id,product_name:a.name,quantity:1,unit_price:parseFloat(a.sale_price),discount:0,tax_rate:n,tax:0,total:0}),this.updateCartItem(this.cartItems.length-1)}if(!this.form.warehouse_id&&a.stock_by_warehouse&&a.stock_by_warehouse.length>0){const n=a.stock_by_warehouse.filter(_=>_.quantity>0).sort((_,e)=>(e.quantity||0)-(_.quantity||0))[0];n&&n.warehouse_id?this.form.warehouse_id=n.warehouse_id:a.stock_by_warehouse[0]&&a.stock_by_warehouse[0].warehouse_id&&(this.form.warehouse_id=a.stock_by_warehouse[0].warehouse_id)}this.productSearch="",this.searchResults=[],this.calculateTotals()},updateCartItem(a,t=!1){const n=this.cartItems[a];if(!n)return;const e=n.quantity*n.unit_price-(n.discount||0);if(t)e>0&&n.tax>0&&(n.tax_rate=parseFloat((n.tax/e*100).toFixed(2)));else{const o=parseFloat(n.tax_rate||0);n.tax=parseFloat((e*o/100).toFixed(2))}n.total=parseFloat((e+n.tax).toFixed(2)),this.calculateTotals()},removeFromCart(a){this.cartItems.splice(a,1),this.calculateTotals()},calculateTotals(){const a=this.cartItems.reduce((c,v)=>c+v.quantity*v.unit_price,0),t=this.cartItems.reduce((c,v)=>c+(v.discount||0),0),n=this.cartItems.reduce((c,v)=>c+(v.tax||0),0);this.form.subtotal=parseFloat(a.toFixed(2));const _=this.form.discount_amount>0||this.form.discount_amount===0&&t===0?parseFloat(this.form.discount_amount):t,e=this.form.tax_amount>0||this.form.tax_amount===0&&n===0?parseFloat(this.form.tax_amount):n,o=a-_+e+(parseFloat(this.form.shipping_cost)||0);this.form.total_amount=parseFloat(o.toFixed(2)),this.calculateBalance()},calculateBalance(){this.form.balance_amount=parseFloat((this.form.total_amount-(this.form.paid_amount||0)).toFixed(2))},async loadSaleForEdit(a){var t,n,_;if(a)try{const o=(await T.get(`/api/v1/sales/${a}`)).data;if(!o){this.showError("Sale not found");return}console.log("Loading sale for edit:",o),this.form={id:o.id,customer_id:o.customer_id,warehouse_id:o.warehouse_id,invoice_date:o.invoice_date?o.invoice_date.includes("T")?o.invoice_date.split("T")[0]:o.invoice_date:new Date().toISOString().split("T")[0],due_date:o.due_date?o.due_date.includes("T")?o.due_date.split("T")[0]:o.due_date:null,subtotal:parseFloat(o.subtotal||0),tax_amount:parseFloat(o.tax_amount||0),discount_amount:parseFloat(o.discount_amount||0),shipping_cost:parseFloat(o.shipping_cost||0),total_amount:parseFloat(o.total_amount||0),paid_amount:parseFloat(o.paid_amount||0),balance_amount:parseFloat(o.balance_amount||0),notes:o.notes||""},this.discountAmountManuallySet=!0,this.taxAmountManuallySet=!0,o.items&&Array.isArray(o.items)&&o.items.length>0?this.cartItems=o.items.map(c=>{var C,P;const v=(c.quantity||0)*(c.unit_price||0),b=parseFloat(c.discount||0),h=v-b;let y=0;((C=c.product)==null?void 0:C.tax_rate)!==void 0?y=parseFloat(c.product.tax_rate||0):h>0&&(y=parseFloat(c.tax||0)/h*100);const S=parseFloat((h*y/100).toFixed(2)),I=parseFloat((h+S).toFixed(2));return{product_id:c.product_id,product_name:((P=c.product)==null?void 0:P.name)||"Unknown",quantity:parseInt(c.quantity,10),unit_price:parseFloat(c.unit_price||0),discount:b,tax_rate:y,tax:S,total:I}}):this.cartItems=[],this.calculateTotals()}catch(e){console.error("Failed to load sale for edit:",e),console.error("Error response:",(t=e.response)==null?void 0:t.data),this.showError(((_=(n=e.response)==null?void 0:n.data)==null?void 0:_.message)||"Failed to load sale details")}},showSuccess(a){window.Toast?window.Toast.fire({icon:"success",title:a}):window.Swal?window.Swal.fire({icon:"success",title:a,timer:2e3,showConfirmButton:!1}):alert(a)},showError(a){window.Toast?window.Toast.fire({icon:"error",title:a}):window.Swal?window.Swal.fire({icon:"error",title:a}):alert(a)},async save(a=null){var t,n,_;if(this.cartItems.length===0){this.showError("Please add at least one product");return}if(this.$refs.formRef){const{valid:e}=await this.$refs.formRef.validate();if(!e){this.showError("Please fill in all required fields");return}}if(!this.form.customer_id){this.showError("Please select a customer");return}if(!this.form.warehouse_id){this.showError("Please select a warehouse");return}if(!this.form.invoice_date){this.showError("Please select an invoice date");return}this.saving=!0;try{const e=this.cartItems.reduce((y,S)=>y+(S.discount||0),0),o=this.cartItems.reduce((y,S)=>y+(S.tax||0),0),c={customer_id:Number(this.form.customer_id),warehouse_id:Number(this.form.warehouse_id),invoice_date:this.form.invoice_date,due_date:this.form.due_date||null,paid_amount:parseFloat(this.form.paid_amount)||0,shipping_cost:parseFloat(this.form.shipping_cost)||0,notes:this.form.notes||"",payment_method:this.paymentMethod||"cash",items:this.cartItems.map(y=>({product_id:Number(y.product_id),quantity:parseInt(y.quantity,10),unit_price:parseFloat(y.unit_price),discount:parseFloat(y.discount)||0,tax:parseFloat(y.tax)||0,notes:y.notes||""}))},v=parseFloat(this.form.discount_amount)||0;(v>0||this.discountAmountManuallySet||v===0&&e===0)&&(c.discount_amount=v);const b=parseFloat(this.form.tax_amount)||0;(b>0||this.taxAmountManuallySet||b===0&&o===0)&&(c.tax_amount=b),a&&typeof a=="string"&&(c.status=String(a)),console.log("Saving sale with payload:",JSON.stringify(c,null,2));let h;this.isEdit?(h=await T.put(`/api/v1/sales/${this.form.id}`,c),this.showSuccess(a==="draft"?"Sale draft updated successfully":"Sale updated successfully")):(h=await T.post("/api/v1/sales",c),this.showSuccess(a==="draft"?"Sale saved as draft successfully":"Sale created successfully")),console.log("Sale saved successfully:",h.data),this.$emit("saved"),this.close()}catch(e){console.error("Failed to save sale:",e),console.error("Error response:",(t=e.response)==null?void 0:t.data),console.error("Error status:",(n=e.response)==null?void 0:n.status);let o="Failed to save sale. Please check the console for details.";(_=e.response)!=null&&_.data?e.response.data.message?o=e.response.data.message:e.response.data.error?o=e.response.data.error:e.response.data.errors&&(o=Object.values(e.response.data.errors).flat().join(", ")):e.message&&(o=e.message),this.showError(o)}finally{this.saving=!1}},async saveAsDraft(){await this.save("draft")},close(){this.$emit("update:modelValue",!1),this.form=this.getEmptyForm(),this.cartItems=[],this.searchResults=[],this.discountAmountManuallySet=!1,this.taxAmountManuallySet=!1}}},at={class:"d-flex align-center gap-2"},st={class:"text-h6 text-white font-weight-medium"},ot={key:0,class:"mt-3"},lt={class:"text-caption text-grey mb-2"},it={class:"d-flex flex-wrap gap-2"},nt={class:"ml-1 text-caption"},rt={key:1,class:"search-results-container"},dt={class:"text-body-2 font-weight-medium"},ut={class:"text-body-2"},ct={class:"pa-1"},mt={class:"pa-1"},pt={class:"pa-1"},_t={class:"pa-1"},ft={class:"text-body-2 font-weight-bold text-end"},ht={class:"text-center"},vt={class:"mb-2"},gt={class:"mb-2"},yt={class:"totals-section"},xt={class:"d-flex justify-space-between mb-1"},wt={class:"text-body-2 font-weight-medium"},bt={key:0,class:"d-flex justify-space-between mb-1"},St={class:"text-body-2 text-error"},Dt={class:"d-flex justify-space-between mb-1"},Vt={key:1,class:"d-flex justify-space-between mb-1"},Ft={class:"text-body-2"},kt={class:"d-flex justify-space-between mb-1"},Tt={key:2,class:"d-flex justify-space-between mb-1"},It={class:"text-body-2 font-weight-medium"},Ct={class:"d-flex justify-space-between mb-2"},Mt={class:"d-flex justify-space-between mb-2 total-amount"},Pt={class:"text-h6 font-weight-bold text-primary"},Ut={class:"mb-2"},qt={class:"mb-2"},At={key:3,class:"mb-2"};function Et(a,t,n,_,e,o){const c=d("v-icon"),v=d("v-btn"),b=d("v-card-title"),h=d("v-text-field"),y=d("v-chip"),S=d("v-img"),I=d("v-avatar"),C=d("v-list-item-title"),P=d("v-list-item-subtitle"),E=d("v-list-item"),N=d("v-list"),U=d("v-card-text"),q=d("v-card"),M=d("v-divider"),w=d("v-table"),f=d("v-alert"),D=d("v-col"),k=d("v-autocomplete"),Y=d("v-select"),j=d("DatePickerVuetifyInput"),R=d("v-row"),J=d("v-textarea"),H=d("v-form"),Q=d("v-card-actions"),G=d("v-dialog");return m(),F(G,{"model-value":n.modelValue,"onUpdate:modelValue":t[16]||(t[16]=u=>a.$emit("update:modelValue",u)),"max-width":"1400px",persistent:"",scrollable:""},{default:i(()=>[l(q,{class:"pos-dialog"},{default:i(()=>[l(b,{class:"pos-header d-flex justify-space-between align-center pa-3"},{default:i(()=>[s("div",at,[l(c,{color:"white"},{default:i(()=>t[17]||(t[17]=[g("mdi-point-of-sale")])),_:1,__:[17]}),s("span",st,r(o.isEdit?"Edit Sale":"New Sale - POS"),1)]),l(v,{icon:"mdi-close",variant:"text",color:"white",size:"small",onClick:o.close},null,8,["onClick"])]),_:1}),l(U,{class:"pa-3"},{default:i(()=>[l(H,{ref:"formRef",modelValue:e.formValid,"onUpdate:modelValue":t[15]||(t[15]=u=>e.formValid=u)},{default:i(()=>[l(R,{dense:"",class:"ma-0"},{default:i(()=>[l(D,{cols:"12",lg:"8",class:"pa-2"},{default:i(()=>[l(q,{variant:"flat",class:"mb-3 search-card",elevation:"1"},{default:i(()=>[l(U,{class:"pa-3"},{default:i(()=>[l(h,{modelValue:e.productSearch,"onUpdate:modelValue":t[0]||(t[0]=u=>e.productSearch=u),label:"Search Product (Name/SKU/Barcode)","prepend-inner-icon":"mdi-magnify",clearable:"",autofocus:"",variant:"outlined","hide-details":"",onKeyup:X(o.searchProducts,["enter"]),"onClick:clear":t[1]||(t[1]=u=>e.searchResults=[])},null,8,["modelValue","onKeyup"]),e.mostSoldProducts.length>0&&e.searchResults.length===0?(m(),p("div",ot,[s("div",lt,[l(c,{size:"14",class:"mr-1"},{default:i(()=>t[18]||(t[18]=[g("mdi-fire")])),_:1,__:[18]}),t[19]||(t[19]=g(" Most Sold Products "))]),s("div",it,[(m(!0),p(z,null,O(e.mostSoldProducts,u=>(m(),F(y,{key:u.id,color:"primary",variant:"flat",size:"small",class:"product-chip",onClick:A=>o.addToCart(u),disabled:!u.stock_quantity||u.stock_quantity<=0},{default:i(()=>[l(c,{size:"14",class:"mr-1"},{default:i(()=>t[20]||(t[20]=[g("mdi-package-variant")])),_:1,__:[20]}),g(" "+r(u.name)+" ",1),s("span",nt,"(৳"+r(u.sale_price)+")",1)]),_:2},1032,["onClick","disabled"]))),128))])])):x("",!0),e.searchResults.length>0?(m(),p("div",rt,[l(N,{class:"search-results"},{default:i(()=>[(m(!0),p(z,null,O(e.searchResults,u=>(m(),F(E,{key:u.id,onClick:A=>o.addToCart(u),class:"search-item"},{prepend:i(()=>[l(I,{size:"40",color:"grey-lighten-4"},{default:i(()=>[u.image?(m(),F(S,{key:0,src:u.image},null,8,["src"])):(m(),F(c,{key:1},{default:i(()=>t[21]||(t[21]=[g("mdi-package-variant")])),_:1,__:[21]}))]),_:2},1024)]),append:i(()=>[l(y,{color:"primary",size:"small",variant:"flat"},{default:i(()=>[g("৳"+r(u.sale_price),1)]),_:2},1024)]),default:i(()=>[l(C,null,{default:i(()=>[g(r(u.name),1)]),_:2},1024),l(P,null,{default:i(()=>[g(" SKU: "+r(u.sku||"N/A")+" | Stock: "+r(u.stock_quantity||0),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})])):x("",!0)]),_:1})]),_:1}),l(q,{variant:"flat",class:"cart-card",elevation:"1"},{default:i(()=>[l(b,{class:"cart-header pa-2"},{default:i(()=>[l(c,{size:"18",class:"mr-1"},{default:i(()=>t[22]||(t[22]=[g("mdi-cart")])),_:1,__:[22]}),s("span",dt,"Cart Items ("+r(e.cartItems.length)+")",1)]),_:1}),l(M),l(U,{class:"pa-2"},{default:i(()=>[e.cartItems.length>0?(m(),F(w,{key:0,density:"compact",class:"cart-table"},{default:i(()=>[t[23]||(t[23]=s("thead",null,[s("tr",null,[s("th",{class:"text-caption"},"Product"),s("th",{class:"text-caption text-center",style:{width:"70px"}},"Qty"),s("th",{class:"text-caption text-end",style:{width:"90px"}},"Price"),s("th",{class:"text-caption text-end",style:{width:"80px"}},"Disc."),s("th",{class:"text-caption text-end",style:{width:"80px"}},"Tax"),s("th",{class:"text-caption text-end",style:{width:"100px"}},"Total"),s("th",{class:"text-caption",style:{width:"40px"}})])],-1)),s("tbody",null,[(m(!0),p(z,null,O(e.cartItems,(u,A)=>(m(),p("tr",{key:A,class:"cart-row"},[s("td",ut,r(u.product_name),1),s("td",ct,[l(h,{modelValue:u.quantity,"onUpdate:modelValue":[V=>u.quantity=V,V=>o.updateCartItem(A)],modelModifiers:{number:!0},type:"number",min:"1",density:"compact","hide-details":"",variant:"outlined",class:"cart-input"},null,8,["modelValue","onUpdate:modelValue"])]),s("td",mt,[l(h,{modelValue:u.unit_price,"onUpdate:modelValue":[V=>u.unit_price=V,V=>o.updateCartItem(A)],modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",density:"compact","hide-details":"",variant:"outlined",class:"cart-input"},null,8,["modelValue","onUpdate:modelValue"])]),s("td",pt,[l(h,{modelValue:u.discount,"onUpdate:modelValue":[V=>u.discount=V,V=>o.updateCartItem(A)],modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",density:"compact","hide-details":"",variant:"outlined",class:"cart-input"},null,8,["modelValue","onUpdate:modelValue"])]),s("td",_t,[l(h,{modelValue:u.tax,"onUpdate:modelValue":[V=>u.tax=V,V=>o.updateCartItem(A,!0)],modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",density:"compact","hide-details":"",variant:"outlined",class:"cart-input"},null,8,["modelValue","onUpdate:modelValue"])]),s("td",ft,"৳"+r(u.total.toFixed(2)),1),s("td",ht,[l(v,{icon:"mdi-delete",size:"x-small",variant:"text",color:"error",onClick:V=>o.removeFromCart(A)},null,8,["onClick"])])]))),128))])]),_:1,__:[23]})):(m(),F(f,{key:1,type:"info",variant:"tonal",density:"compact",class:"mt-2 mb-0"},{default:i(()=>t[24]||(t[24]=[s("span",{class:"text-caption"},"Cart is empty. Search and add products.",-1)])),_:1,__:[24]}))]),_:1})]),_:1})]),_:1}),l(D,{cols:"12",lg:"4",class:"pa-2"},{default:i(()=>[l(q,{variant:"flat",class:"details-card",elevation:"1"},{default:i(()=>[l(U,{class:"pa-2"},{default:i(()=>[s("div",vt,[l(k,{modelValue:e.form.customer_id,"onUpdate:modelValue":t[2]||(t[2]=u=>e.form.customer_id=u),items:e.customers,"item-value":"id","item-title":"name",label:"Customer *",clearable:"",density:"compact",variant:"outlined","hide-details":"",rules:[e.rules.required]},{"prepend-inner":i(()=>[l(c,{size:"18"},{default:i(()=>t[25]||(t[25]=[g("mdi-account")])),_:1,__:[25]})]),_:1},8,["modelValue","items","rules"])]),s("div",gt,[l(Y,{modelValue:e.form.warehouse_id,"onUpdate:modelValue":t[3]||(t[3]=u=>e.form.warehouse_id=u),items:e.warehouses,"item-value":"id","item-title":"name",label:"Warehouse *",density:"compact",variant:"outlined","hide-details":"",rules:[e.rules.required]},{"prepend-inner":i(()=>[l(c,{size:"18"},{default:i(()=>t[26]||(t[26]=[g("mdi-warehouse")])),_:1,__:[26]})]),_:1},8,["modelValue","items","rules"])]),l(R,{dense:"",class:"ma-0 mb-2"},{default:i(()=>[l(D,{cols:"6",class:"pa-1"},{default:i(()=>[l(j,{fieldLabel:"Invoice Date",required:"true",variant:"outlined",initialDate:e.form.invoice_date,onTrigerInputValue:t[4]||(t[4]=u=>{e.form.invoice_date=u})},null,8,["initialDate"])]),_:1}),l(D,{cols:"6",class:"pa-1"},{default:i(()=>[l(j,{fieldLabel:"Due Date",variant:"outlined",initialDate:e.form.due_date,onTrigerInputValue:t[5]||(t[5]=u=>{e.form.due_date=u})},null,8,["initialDate"])]),_:1})]),_:1}),l(M,{class:"my-2"}),s("div",yt,[s("div",xt,[t[27]||(t[27]=s("span",{class:"text-caption text-grey"},"Subtotal:",-1)),s("span",wt,"৳"+r(e.form.subtotal.toFixed(2)),1)]),o.calculatedItemsDiscount>0?(m(),p("div",bt,[t[28]||(t[28]=s("span",{class:"text-caption text-grey"},"Item Discounts:",-1)),s("span",St,"-৳"+r(o.calculatedItemsDiscount.toFixed(2)),1)])):x("",!0),s("div",Dt,[t[29]||(t[29]=s("span",{class:"text-caption text-grey"},"Order Discount:",-1)),l(h,{modelValue:e.form.discount_amount,"onUpdate:modelValue":[t[6]||(t[6]=u=>e.form.discount_amount=u),t[7]||(t[7]=()=>{e.discountAmountManuallySet=!0,o.calculateTotals()})],modelModifiers:{number:!0},type:"number",density:"compact",variant:"outlined","hide-details":"",min:"0",step:"0.01",class:"compact-input"},null,8,["modelValue"])]),o.calculatedItemsTax>0?(m(),p("div",Vt,[t[30]||(t[30]=s("span",{class:"text-caption text-grey"},"Item Tax:",-1)),s("span",Ft,"৳"+r(o.calculatedItemsTax.toFixed(2)),1)])):x("",!0),s("div",kt,[t[31]||(t[31]=s("span",{class:"text-caption text-grey"},"Order Tax:",-1)),l(h,{modelValue:e.form.tax_amount,"onUpdate:modelValue":[t[8]||(t[8]=u=>e.form.tax_amount=u),t[9]||(t[9]=()=>{e.taxAmountManuallySet=!0,o.calculateTotals()})],modelModifiers:{number:!0},type:"number",density:"compact",variant:"outlined","hide-details":"",min:"0",step:"0.01",class:"compact-input"},null,8,["modelValue"])]),o.calculatedTotalTax>0?(m(),p("div",Tt,[t[32]||(t[32]=s("span",{class:"text-caption text-grey font-weight-medium"},"Total Tax:",-1)),s("span",It,"৳"+r(o.calculatedTotalTax.toFixed(2)),1)])):x("",!0),s("div",Ct,[t[33]||(t[33]=s("span",{class:"text-caption text-grey"},"Shipping:",-1)),l(h,{modelValue:e.form.shipping_cost,"onUpdate:modelValue":[t[10]||(t[10]=u=>e.form.shipping_cost=u),o.calculateTotals],modelModifiers:{number:!0},type:"number",density:"compact",variant:"outlined","hide-details":"",min:"0",step:"0.01",class:"compact-input"},null,8,["modelValue","onUpdate:modelValue"])]),l(M,{class:"my-2"}),s("div",Mt,[t[34]||(t[34]=s("span",{class:"text-body-1 font-weight-bold"},"Total:",-1)),s("span",Pt,"৳"+r(e.form.total_amount.toFixed(2)),1)]),s("div",Ut,[l(h,{modelValue:e.form.paid_amount,"onUpdate:modelValue":[t[11]||(t[11]=u=>e.form.paid_amount=u),o.calculateBalance],modelModifiers:{number:!0},type:"number",label:"Paid Amount",density:"compact",variant:"outlined",min:"0",step:"0.01","prepend-inner-icon":"mdi-cash"},null,8,["modelValue","onUpdate:modelValue"])]),s("div",qt,[l(h,{modelValue:e.form.balance_amount,"onUpdate:modelValue":t[12]||(t[12]=u=>e.form.balance_amount=u),modelModifiers:{number:!0},label:"Balance (Due)",density:"compact",variant:"outlined",readonly:"",color:e.form.balance_amount>0?"error":"success",class:K(e.form.balance_amount>0?"text-error":"text-success")},null,8,["modelValue","color","class"])]),e.form.paid_amount>0?(m(),p("div",At,[l(Y,{modelValue:e.paymentMethod,"onUpdate:modelValue":t[13]||(t[13]=u=>e.paymentMethod=u),items:e.paymentMethods,label:"Payment Method",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue","items"])])):x("",!0)]),l(M,{class:"my-2"}),l(J,{modelValue:e.form.notes,"onUpdate:modelValue":t[14]||(t[14]=u=>e.form.notes=u),label:"Notes",rows:"2",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(M),l(Q,{class:"pa-2 justify-end"},{default:i(()=>[l(v,{variant:"text",size:"small",onClick:o.close},{default:i(()=>t[35]||(t[35]=[g("Cancel")])),_:1,__:[35]},8,["onClick"]),o.isEdit?x("",!0):(m(),F(v,{key:0,color:"grey",size:"small",loading:e.saving,disabled:e.cartItems.length===0,onClick:o.saveAsDraft},{default:i(()=>[l(c,{size:"18",class:"mr-1"},{default:i(()=>t[36]||(t[36]=[g("mdi-content-save-outline")])),_:1,__:[36]}),t[37]||(t[37]=g(" Save as Draft "))]),_:1,__:[37]},8,["loading","disabled","onClick"])),l(v,{color:"success",size:"small",loading:e.saving,disabled:e.cartItems.length===0,onClick:o.save},{default:i(()=>[l(c,{size:"18",class:"mr-1"},{default:i(()=>t[38]||(t[38]=[g("mdi-content-save")])),_:1,__:[38]}),g(" "+r(o.isEdit?"Update":"Save Sale"),1)]),_:1},8,["loading","disabled","onClick"])]),_:1})]),_:1})]),_:1},8,["model-value"])}const Nt=B(et,[["render",Et],["__scopeId","data-v-76236648"]]);function zt(a){if(!a)return"";try{const t=new Date(a);if(isNaN(t.getTime()))return"";const n=String(t.getDate()).padStart(2,"0"),e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()],o=t.getFullYear();return`${n}/${e}/${o}`}catch{return a}}function Ot(a){if(!a)return"";try{if(typeof a=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(a)){const[o,c,v]=a.split("-");return`${v}/${c}/${o}`}const t=new Date(a);if(isNaN(t.getTime()))return"";const n=String(t.getDate()).padStart(2,"0"),_=String(t.getMonth()+1).padStart(2,"0"),e=t.getFullYear();return`${n}/${_}/${e}`}catch{return a}}const Bt={name:"ViewSaleDialog",props:{modelValue:{type:Boolean,required:!0},sale:{type:Object,default:null}},emits:["update:modelValue"],data(){return{saleData:null,loading:!1,currentSaleId:null}},watch:{modelValue:{immediate:!0,handler(a){a&&this.sale&&this.sale.id?this.currentSaleId!==this.sale.id&&this.loadSaleDetails(this.sale.id):a||(this.saleData=null,this.currentSaleId=null)}},sale:{immediate:!0,handler(a){a&&a.id&&this.modelValue&&this.currentSaleId!==a.id&&this.loadSaleDetails(a.id)}}},computed:{calculatedItemsDiscount(){return!this.saleData||!this.saleData.items?0:this.saleData.items.reduce((a,t)=>a+parseFloat(t.discount||0),0)},calculatedItemsTax(){return!this.saleData||!this.saleData.items?0:this.saleData.items.reduce((a,t)=>a+parseFloat(t.tax||0),0)},calculatedTotalTax(){var n;const a=this.calculatedItemsTax,t=parseFloat(((n=this.saleData)==null?void 0:n.tax_amount)||0);return a+t},calculatedTotalAmount(){if(!this.saleData)return 0;const a=parseFloat(this.saleData.subtotal||0),t=parseFloat(this.saleData.discount_amount||0),n=parseFloat(this.saleData.shipping_cost||0),_=this.calculatedTotalTax,e=a-t+_+n;return parseFloat(e.toFixed(2))}},methods:{async loadSaleDetails(a){var t,n,_;if(!a){console.error("No sale ID provided");return}if(!(this.currentSaleId===a&&this.saleData)){this.currentSaleId=a,this.loading=!0,this.saleData=null;try{const{data:e}=await T.get(`/api/v1/sales/${a}`);this.saleData=e.data||e.sale||e,this.saleData||(this.showError("Sale data not found"),this.currentSaleId=null)}catch(e){console.error("Failed to load sale details:",e),console.error("Error response:",(t=e.response)==null?void 0:t.data),this.showError(((_=(n=e.response)==null?void 0:n.data)==null?void 0:_.message)||"Failed to load sale details"),this.currentSaleId=null}finally{this.loading=!1}}},formatDate:zt,getStatusColor(a){return{draft:"grey",pending:"warning",partial:"info",paid:"success",cancelled:"error"}[a]||"grey"},printInvoice(){this.$nextTick(()=>{let a=null;this.$el&&(this.$el.nodeType===1?a=this.$el.closest(".v-dialog"):this.$el.querySelector&&(a=this.$el.querySelector(".v-dialog"))),a||(a=document.querySelector(".v-dialog")),a&&(a.style.position="relative",a.style.margin="0"),setTimeout(()=>{window.print()},100)})},close(){this.$emit("update:modelValue",!1),this.saleData=null,this.currentSaleId=null},showError(a){window.Toast?window.Toast.fire({icon:"error",title:a}):window.Swal?window.Swal.fire({icon:"error",title:a}):alert(a)}}},Yt={class:"d-flex align-center gap-2"},jt={key:0,class:"text-caption text-white text-opacity-90"},Rt={key:0,class:"text-center py-8"},Lt={key:1,class:"text-center py-8"},Kt={key:2,class:"invoice-content"},Wt={class:"invoice-header-section pa-3"},Jt={class:"invoice-customer-info"},Ht={class:"text-body-2 font-weight-medium mb-0"},Qt={key:0,class:"text-caption text-grey"},Gt={key:1,class:"text-caption text-grey"},Xt={key:2,class:"text-caption text-grey"},Zt={class:"invoice-meta-item"},$t={class:"text-body-2 font-weight-medium"},te={class:"invoice-meta-item"},ee={class:"text-body-2 font-weight-medium"},ae={class:"invoice-meta-item"},se={class:"invoice-items-section pa-3"},oe={key:0},le={class:"text-grey text-caption"},ie={class:"text-body-2 font-weight-medium"},ne={key:0,class:"text-caption text-grey"},re={class:"text-center text-body-2"},de={class:"text-right text-body-2"},ue={class:"text-right text-body-2 text-error"},ce={class:"text-right text-body-2"},me={class:"text-right text-body-2 font-weight-bold"},pe={class:"invoice-totals-section pa-3"},_e={key:0,class:"invoice-notes"},fe={class:"text-body-2 text-caption"},he={key:1,class:"invoice-warehouse mt-2"},ve={class:"text-body-2 text-caption"},ge={class:"invoice-totals-box"},ye={class:"invoice-totals-row"},xe={class:"invoice-totals-value text-body-2"},we={key:0,class:"invoice-totals-row"},be={class:"invoice-totals-value text-body-2 text-error"},Se={key:1,class:"invoice-totals-row"},De={class:"invoice-totals-value text-body-2 text-error"},Ve={key:2,class:"invoice-totals-row"},Fe={class:"invoice-totals-value text-body-2"},ke={key:3,class:"invoice-totals-row"},Te={class:"invoice-totals-value text-body-2"},Ie={key:4,class:"invoice-totals-row invoice-totals-highlight"},Ce={class:"invoice-totals-value text-body-2 font-weight-medium"},Me={key:5,class:"invoice-totals-row"},Pe={class:"invoice-totals-value text-body-2"},Ue={class:"invoice-totals-row invoice-totals-total"},qe={class:"invoice-totals-value text-subtitle-1 font-weight-bold text-primary"},Ae={class:"invoice-totals-row invoice-totals-paid"},Ee={class:"invoice-totals-value text-body-2 font-weight-medium text-success"},Ne={class:"invoice-totals-value text-body-2 font-weight-bold"};function ze(a,t,n,_,e,o){const c=d("v-icon"),v=d("v-btn"),b=d("v-card-title"),h=d("v-progress-circular"),y=d("v-alert"),S=d("v-col"),I=d("v-row"),C=d("v-chip"),P=d("v-table"),E=d("v-divider"),N=d("v-card-text"),U=d("v-card-actions"),q=d("v-card"),M=d("v-dialog");return m(),F(M,{"model-value":n.modelValue,"onUpdate:modelValue":t[0]||(t[0]=w=>a.$emit("update:modelValue",w)),"max-width":"900px",persistent:"",scrollable:""},{default:i(()=>[l(q,{class:"invoice-card"},{default:i(()=>[l(b,{class:"invoice-header d-flex justify-space-between align-center pa-3"},{default:i(()=>[s("div",Yt,[l(c,{color:"white",size:"24"},{default:i(()=>t[1]||(t[1]=[g("mdi-file-document-outline")])),_:1,__:[1]}),s("div",null,[t[2]||(t[2]=s("div",{class:"text-h6 text-white font-weight-bold"},"INVOICE",-1)),e.saleData?(m(),p("div",jt," #"+r(e.saleData.invoice_number),1)):x("",!0)])]),l(v,{icon:"mdi-close",variant:"text",color:"white",size:"small",onClick:o.close},null,8,["onClick"])]),_:1}),l(N,{class:"pa-0"},{default:i(()=>[e.loading?(m(),p("div",Rt,[l(h,{indeterminate:"",color:"primary",size:"48"}),t[3]||(t[3]=s("div",{class:"mt-3 text-body-2"},"Loading invoice details...",-1))])):e.saleData?(m(),p("div",Kt,[s("div",Wt,[l(I,{dense:""},{default:i(()=>[l(S,{cols:"12",md:"6"},{default:i(()=>t[5]||(t[5]=[s("div",{class:"invoice-company-info"},[s("div",{class:"text-subtitle-2 font-weight-bold mb-1"},"From"),s("div",{class:"text-body-2 font-weight-medium mb-0"},"Your Company Name"),s("div",{class:"text-caption text-grey"},"Company Address, City, State"),s("div",{class:"text-caption text-grey"},"Phone: +1234567890 | Email: info@company.com ")],-1)])),_:1,__:[5]}),l(S,{cols:"12",md:"6"},{default:i(()=>{var w,f,D,k;return[s("div",Jt,[t[6]||(t[6]=s("div",{class:"text-subtitle-2 font-weight-bold mb-1"},"Bill To",-1)),s("div",Ht,r(((w=e.saleData.customer)==null?void 0:w.name)||"Walk-in Customer"),1),(f=e.saleData.customer)!=null&&f.phone?(m(),p("div",Qt," Phone: "+r(e.saleData.customer.phone),1)):x("",!0),(D=e.saleData.customer)!=null&&D.email?(m(),p("div",Gt," Email: "+r(e.saleData.customer.email),1)):x("",!0),(k=e.saleData.customer)!=null&&k.address?(m(),p("div",Xt,r(e.saleData.customer.address),1)):x("",!0)])]}),_:1})]),_:1}),l(I,{dense:"",class:"mt-2"},{default:i(()=>[l(S,{cols:"12",md:"4"},{default:i(()=>[s("div",Zt,[t[7]||(t[7]=s("div",{class:"text-caption text-grey mb-0"},"Invoice Date",-1)),s("div",$t,r(o.formatDate(e.saleData.invoice_date)),1)])]),_:1}),e.saleData.due_date?(m(),F(S,{key:0,cols:"12",md:"4"},{default:i(()=>[s("div",te,[t[8]||(t[8]=s("div",{class:"text-caption text-grey mb-0"},"Due Date",-1)),s("div",ee,r(o.formatDate(e.saleData.due_date)),1)])]),_:1})):x("",!0),l(S,{cols:"12",md:"4"},{default:i(()=>[s("div",ae,[t[9]||(t[9]=s("div",{class:"text-caption text-grey mb-0"},"Status",-1)),l(C,{color:o.getStatusColor(e.saleData.status),size:"x-small",variant:"flat",class:"font-weight-medium"},{default:i(()=>{var w;return[g(r(((w=e.saleData.status)==null?void 0:w.toUpperCase())||"PENDING"),1)]}),_:1},8,["color"])])]),_:1})]),_:1})]),s("div",se,[t[12]||(t[12]=s("div",{class:"text-subtitle-1 font-weight-bold mb-2"},"Items",-1)),l(P,{class:"invoice-table",density:"compact"},{default:i(()=>[t[11]||(t[11]=s("thead",null,[s("tr",{class:"invoice-table-header"},[s("th",{class:"text-left",style:{width:"30px"}},"#"),s("th",{class:"text-left"},"Product"),s("th",{class:"text-center",style:{width:"60px"}},"Qty"),s("th",{class:"text-right",style:{width:"90px"}},"Price"),s("th",{class:"text-right",style:{width:"80px"}},"Disc."),s("th",{class:"text-right",style:{width:"80px"}},"Tax"),s("th",{class:"text-right",style:{width:"100px"}},"Total")])],-1)),s("tbody",null,[!e.saleData.items||e.saleData.items.length===0?(m(),p("tr",oe,t[10]||(t[10]=[s("td",{colspan:"7",class:"text-center py-4 text-grey"},"No items found",-1)]))):x("",!0),(m(!0),p(z,null,O(e.saleData.items||[],(w,f)=>{var D,k;return m(),p("tr",{key:w.id||w.product_id,class:"invoice-table-row"},[s("td",le,r(f+1),1),s("td",null,[s("div",ie,r(((D=w.product)==null?void 0:D.name)||"Unknown"),1),(k=w.product)!=null&&k.sku?(m(),p("div",ne,"SKU: "+r(w.product.sku),1)):x("",!0)]),s("td",re,r(w.quantity),1),s("td",de,"৳"+r(parseFloat(w.unit_price||0).toFixed(2)),1),s("td",ue,"-৳"+r(parseFloat(w.discount||0).toFixed(2)),1),s("td",ce,"৳"+r(parseFloat(w.tax||0).toFixed(2)),1),s("td",me,"৳"+r(parseFloat(w.total||0).toFixed(2)),1)])}),128))])]),_:1,__:[11]})]),s("div",pe,[l(I,{dense:""},{default:i(()=>[l(S,{cols:"12",md:"7"},{default:i(()=>[e.saleData.notes?(m(),p("div",_e,[t[13]||(t[13]=s("div",{class:"text-subtitle-2 font-weight-bold mb-1"},"Notes",-1)),s("div",fe,r(e.saleData.notes),1)])):x("",!0),e.saleData.warehouse?(m(),p("div",he,[t[14]||(t[14]=s("div",{class:"text-subtitle-2 font-weight-bold mb-1"},"Warehouse",-1)),s("div",ve,r(e.saleData.warehouse.name),1)])):x("",!0)]),_:1}),l(S,{cols:"12",md:"5"},{default:i(()=>[s("div",ge,[s("div",ye,[t[15]||(t[15]=s("span",{class:"invoice-totals-label text-caption"},"Subtotal:",-1)),s("span",xe,"৳"+r(parseFloat(e.saleData.subtotal||0).toFixed(2)),1)]),o.calculatedItemsDiscount>0?(m(),p("div",we,[t[16]||(t[16]=s("span",{class:"invoice-totals-label text-caption"},"Item Discounts:",-1)),s("span",be,"-৳"+r(o.calculatedItemsDiscount.toFixed(2)),1)])):x("",!0),e.saleData.discount_amount>0?(m(),p("div",Se,[t[17]||(t[17]=s("span",{class:"invoice-totals-label text-caption"},"Order Discount:",-1)),s("span",De,"-৳"+r(parseFloat(e.saleData.discount_amount).toFixed(2)),1)])):x("",!0),o.calculatedItemsTax>0?(m(),p("div",Ve,[t[18]||(t[18]=s("span",{class:"invoice-totals-label text-caption"},"Item Tax:",-1)),s("span",Fe,"৳"+r(o.calculatedItemsTax.toFixed(2)),1)])):x("",!0),e.saleData.tax_amount>0?(m(),p("div",ke,[t[19]||(t[19]=s("span",{class:"invoice-totals-label text-caption"},"Order Tax:",-1)),s("span",Te,"৳"+r(parseFloat(e.saleData.tax_amount).toFixed(2)),1)])):x("",!0),o.calculatedTotalTax>0?(m(),p("div",Ie,[t[20]||(t[20]=s("span",{class:"invoice-totals-label text-body-2 font-weight-medium"},"Total Tax:",-1)),s("span",Ce,"৳"+r(o.calculatedTotalTax.toFixed(2)),1)])):x("",!0),e.saleData.shipping_cost>0?(m(),p("div",Me,[t[21]||(t[21]=s("span",{class:"invoice-totals-label text-caption"},"Shipping:",-1)),s("span",Pe,"৳"+r(parseFloat(e.saleData.shipping_cost).toFixed(2)),1)])):x("",!0),l(E,{class:"my-2"}),s("div",Ue,[t[22]||(t[22]=s("span",{class:"invoice-totals-label text-subtitle-1 font-weight-bold"},"Total:",-1)),s("span",qe,"৳"+r(o.calculatedTotalAmount.toFixed(2)),1)]),s("div",Ae,[t[23]||(t[23]=s("span",{class:"invoice-totals-label text-body-2 font-weight-medium text-success"},"Paid:",-1)),s("span",Ee,"৳"+r(parseFloat(e.saleData.paid_amount||0).toFixed(2)),1)]),s("div",{class:K(["invoice-totals-row invoice-totals-balance",e.saleData.balance_amount>0?"text-error":"text-success"])},[t[24]||(t[24]=s("span",{class:"invoice-totals-label text-body-2 font-weight-bold"},"Balance:",-1)),s("span",Ne,"৳"+r(parseFloat(e.saleData.balance_amount||0).toFixed(2)),1)],2)])]),_:1})]),_:1})]),t[25]||(t[25]=s("div",{class:"invoice-footer pa-2 text-center"},[s("div",{class:"text-caption text-grey"}," Thank you for your business! ")],-1))])):(m(),p("div",Lt,[l(y,{type:"error",variant:"tonal",class:"ma-3",density:"compact"},{default:i(()=>t[4]||(t[4]=[g(" Failed to load invoice details ")])),_:1,__:[4]})]))]),_:1}),l(E),l(U,{class:"justify-end pa-2 bg-grey-lighten-5"},{default:i(()=>[l(v,{color:"primary","prepend-icon":"mdi-printer",variant:"flat",size:"small",onClick:o.printInvoice},{default:i(()=>t[26]||(t[26]=[g(" Print Invoice ")])),_:1,__:[26]},8,["onClick"]),l(v,{variant:"text",size:"small",onClick:o.close},{default:i(()=>t[27]||(t[27]=[g("Close")])),_:1,__:[27]},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["model-value"])}const Oe=B(Bt,[["render",ze],["__scopeId","data-v-a2cde4c1"]]),Be={name:"DatePicker",props:{modelValue:{type:[String,Date],default:null},label:{type:String,default:"Date"},rules:{type:Array,default:()=>[]},required:{type:Boolean,default:!1},fieldClass:{type:String,default:""},density:{type:String,default:"default"},variant:{type:String,default:"outlined"}},emits:["update:modelValue"],data(){return{dateMenu:!1}},computed:{formattedDate(){if(!this.modelValue)return"";try{let a;if(typeof this.modelValue=="string")/^\d{4}-\d{2}-\d{2}$/.test(this.modelValue)?a=this.modelValue:this.modelValue.includes("T")?a=this.modelValue.split("T")[0]:a=this.modelValue;else{const e=this.modelValue.getFullYear(),o=String(this.modelValue.getMonth()+1).padStart(2,"0"),c=String(this.modelValue.getDate()).padStart(2,"0");a=`${e}-${o}-${c}`}const[t,n,_]=a.split("-").map(Number);return isNaN(t)||isNaN(n)||isNaN(_)?this.modelValue:`${String(_).padStart(2,"0")}/${String(n).padStart(2,"0")}/${t}`}catch{return this.modelValue}},datePickerValue(){if(!this.modelValue)return null;try{let a;if(typeof this.modelValue=="string"){if(/^\d{4}-\d{2}-\d{2}$/.test(this.modelValue))return this.modelValue;this.modelValue.includes("T")?a=this.modelValue.split("T")[0]:a=this.modelValue}else{const t=this.modelValue.getFullYear(),n=String(this.modelValue.getMonth()+1).padStart(2,"0"),_=String(this.modelValue.getDate()).padStart(2,"0");a=`${t}-${n}-${_}`}return/^\d{4}-\d{2}-\d{2}$/.test(a)?a:this.modelValue}catch{return this.modelValue}}},methods:{onDateSelected(a){if(a&&/^\d{4}-\d{2}-\d{2}$/.test(a))this.$emit("update:modelValue",String(a));else if(a)try{if(typeof a=="string"&&a.includes("T")){const t=a.split("T")[0];if(/^\d{4}-\d{2}-\d{2}$/.test(t))this.$emit("update:modelValue",t);else{const n=new Date(a),_=n.getFullYear(),e=String(n.getMonth()+1).padStart(2,"0"),o=String(n.getDate()).padStart(2,"0");this.$emit("update:modelValue",`${_}-${e}-${o}`)}}else{const t=new Date(a),n=t.getFullYear(),_=String(t.getMonth()+1).padStart(2,"0"),e=String(t.getDate()).padStart(2,"0");this.$emit("update:modelValue",`${n}-${_}-${e}`)}}catch{this.$emit("update:modelValue",a)}else this.$emit("update:modelValue",null);this.dateMenu=!1},clearDate(){this.$emit("update:modelValue",null)}}};function Ye(a,t,n,_,e,o){const c=d("v-text-field"),v=d("v-date-picker"),b=d("v-menu");return m(),F(b,{modelValue:e.dateMenu,"onUpdate:modelValue":t[1]||(t[1]=h=>e.dateMenu=h),"close-on-content-click":!1,location:"bottom",transition:"scale-transition"},{activator:i(({props:h})=>[l(c,L({"model-value":o.formattedDate,label:n.label,readonly:""},h,{rules:n.rules,required:n.required,class:n.fieldClass,"prepend-inner-icon":"mdi-calendar",density:n.density,variant:n.variant,clearable:"","onClick:clear":o.clearDate,"onUpdate:modelValue":t[0]||(t[0]=y=>a.$emit("update:modelValue",y))}),null,16,["model-value","label","rules","required","class","density","variant","onClick:clear"])]),default:i(()=>[l(v,{"model-value":o.datePickerValue,"onUpdate:modelValue":o.onDateSelected,color:"primary","show-adjacent-months":"","hide-header":""},null,8,["model-value","onUpdate:modelValue"])]),_:1},8,["modelValue"])}const je=B(Be,[["render",Ye],["__scopeId","data-v-c69c332a"]]),Re={name:"AdminSales",mixins:[W],components:{SaleDialog:Nt,ViewSaleDialog:Oe,DatePicker:je},data(){return{sales:[],loading:!1,dialog:!1,viewDialog:!1,selectedSale:null,filters:{search:"",status:null,date_from:"",date_to:""},pagination:{current_page:1,per_page:15,last_page:1,total:0},perPageOptions:[{title:"10",value:10},{title:"15",value:15},{title:"25",value:25},{title:"50",value:50},{title:"100",value:100}],statusOptions:[{title:"Draft",value:"draft"},{title:"Pending",value:"pending"},{title:"Partial",value:"partial"},{title:"Paid",value:"paid"},{title:"Cancelled",value:"cancelled"}]}},mounted(){this.fetchSales()},methods:{async fetchSales(){this.loading=!0;try{const a={page:this.pagination.current_page,per_page:this.pagination.per_page,search:this.filters.search||"",status:this.filters.status||null};this.filters.date_from&&String(this.filters.date_from).trim()!==""&&(a.from_date=this.filters.date_from),this.filters.date_to&&String(this.filters.date_to).trim()!==""&&(a.to_date=this.filters.date_to);const{data:t}=await T.get("/api/v1/sales",{params:a});this.sales=t.data||t.sales||[],this.pagination={current_page:t.current_page||1,per_page:t.per_page||15,last_page:t.last_page||1,total:t.total||0}}catch(a){console.error("Failed to fetch sales",a),this.showError("Failed to load sales")}finally{this.loading=!1}},openDialog(){this.selectedSale=null,this.dialog=!0},editSale(a){this.selectedSale=a,this.dialog=!0},viewSale(a){this.selectedSale=a,this.viewDialog=!0},async confirmDelete(a){var n,_;if(this.selectedSale=a,(await window.Swal.fire({title:"Are you sure?",text:`Do you want to delete sale ${a.invoice_number}?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"})).isConfirmed)try{await T.delete(`/api/v1/sales/${a.id}`),this.showSuccess("Sale deleted successfully"),this.fetchSales()}catch(e){console.error("Failed to delete sale",e),this.showError(((_=(n=e.response)==null?void 0:n.data)==null?void 0:_.message)||"Failed to delete sale")}},printInvoice(a){console.log("Print invoice:",a.invoice_number),this.showInfo("Print feature coming soon")},handleSaved(){this.fetchSales()},resetFilters(){this.filters={search:"",status:null,date_from:"",date_to:""},this.pagination.current_page=1,this.fetchSales()},onPerPageChange(){this.pagination.current_page=1,this.fetchSales()},onDateFromChange(a){this.filters.date_from=a||"",this.pagination.current_page=1,this.fetchSales()},onDateToChange(a){this.filters.date_to=a||"",this.pagination.current_page=1,this.fetchSales()},formatDateDDMMYYYY:Ot,getStatusColor(a){return{draft:"grey",pending:"warning",partial:"info",paid:"success",cancelled:"error"}[a]||"grey"},showSuccess(a){window.Toast?window.Toast.fire({icon:"success",title:a}):window.Swal?window.Swal.fire({icon:"success",title:a,timer:2e3,showConfirmButton:!1}):alert(a)},showError(a){window.Toast?window.Toast.fire({icon:"error",title:a}):window.Swal?window.Swal.fire({icon:"error",title:a}):alert(a)},showInfo(a){window.Toast?window.Toast.fire({icon:"info",title:a}):window.Swal?window.Swal.fire({icon:"info",title:a,timer:2e3,showConfirmButton:!1}):alert(a)}}},Le={class:"page-header"},Ke={class:"text-caption text-grey"},We={key:0},Je={key:0,class:"text-center py-4"},He={class:"font-weight-bold"},Qe={class:"text-end"},Ge={class:"text-end"},Xe={class:"text-end"},Ze={key:0},$e={class:"d-flex flex-column flex-md-row justify-space-between align-center align-md-start gap-3 mt-4"},ta={class:"text-caption text-grey"},ea={key:0},aa={key:0,class:"ml-2"},sa={key:1},oa={key:0,class:"d-flex align-center gap-2"};function la(a,t,n,_,e,o){const c=d("v-btn"),v=d("v-select"),b=d("v-col"),h=d("DatePicker"),y=d("v-text-field"),S=d("v-row"),I=d("v-card-text"),C=d("v-card"),P=d("v-card-title"),E=d("v-progress-circular"),N=d("v-chip"),U=d("v-table"),q=d("v-pagination"),M=d("SaleDialog"),w=d("ViewSaleDialog");return m(),p("div",null,[s("div",Le,[t[9]||(t[9]=s("h1",{class:"text-h4 page-title"},"Sales / POS",-1)),l(c,{color:"primary","prepend-icon":"mdi-plus",onClick:o.openDialog,class:"add-button"},{default:i(()=>t[8]||(t[8]=[g(" New Sale ")])),_:1,__:[8]},8,["onClick"])]),l(C,{class:"mb-4"},{default:i(()=>[l(I,null,{default:i(()=>[l(S,null,{default:i(()=>[l(b,{cols:"12",md:"3"},{default:i(()=>[l(v,{modelValue:e.pagination.per_page,"onUpdate:modelValue":[t[0]||(t[0]=f=>e.pagination.per_page=f),o.onPerPageChange],items:e.perPageOptions,label:"Items per page","prepend-inner-icon":"mdi-format-list-numbered",variant:"outlined",density:"compact"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),l(b,{cols:"12",md:"2"},{default:i(()=>[l(v,{modelValue:e.filters.status,"onUpdate:modelValue":[t[1]||(t[1]=f=>e.filters.status=f),o.fetchSales],items:e.statusOptions,label:"Status","prepend-inner-icon":"mdi-filter",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),l(b,{cols:"12",md:"2"},{default:i(()=>[l(h,{modelValue:e.filters.date_from,"onUpdate:modelValue":[t[2]||(t[2]=f=>e.filters.date_from=f),o.onDateFromChange],label:"From Date",density:"compact"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(b,{cols:"12",md:"2"},{default:i(()=>[l(h,{modelValue:e.filters.date_to,"onUpdate:modelValue":[t[3]||(t[3]=f=>e.filters.date_to=f),o.onDateToChange],label:"To Date",density:"compact"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(b,{cols:"12",md:"3"},{default:i(()=>[l(y,{modelValue:e.filters.search,"onUpdate:modelValue":[t[4]||(t[4]=f=>e.filters.search=f),o.fetchSales],label:"Search Invoice/Customer","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),l(C,null,{default:i(()=>[l(P,{class:"d-flex justify-space-between align-center"},{default:i(()=>[t[11]||(t[11]=s("span",null,"Sales",-1)),s("span",Ke,[t[10]||(t[10]=g(" Total Records: ")),s("strong",null,r(e.pagination.total||0),1),e.sales.length>0?(m(),p("span",We," | Showing "+r((e.pagination.current_page-1)*e.pagination.per_page+1)+" to "+r(Math.min(e.pagination.current_page*e.pagination.per_page,e.pagination.total))+" of "+r(e.pagination.total),1)):x("",!0)])]),_:1,__:[11]}),l(I,null,{default:i(()=>[e.loading?(m(),p("div",Je,[l(E,{indeterminate:"",color:"primary"})])):(m(),F(U,{key:1},{default:i(()=>[t[13]||(t[13]=s("thead",null,[s("tr",null,[s("th",null,"Invoice #"),s("th",null,"Customer"),s("th",null,"Date"),s("th",{class:"text-end"},"Total"),s("th",{class:"text-end"},"Paid"),s("th",{class:"text-end"},"Due"),s("th",null,"Status"),s("th",null,"Actions")])],-1)),s("tbody",null,[(m(!0),p(z,null,O(e.sales,f=>{var D;return m(),p("tr",{key:f.id},[s("td",null,[s("span",He,r(f.invoice_number),1)]),s("td",null,r(((D=f.customer)==null?void 0:D.name)||"Walk-in"),1),s("td",null,r(o.formatDateDDMMYYYY(f.invoice_date)),1),s("td",Qe," ৳"+r(parseFloat(f.total_amount).toFixed(2)),1),s("td",Ge," ৳"+r(parseFloat(f.paid_amount).toFixed(2)),1),s("td",Xe,[l(N,{color:f.balance_amount>0?"error":"success",size:"small"},{default:i(()=>[g(" ৳"+r(parseFloat(f.balance_amount).toFixed(2)),1)]),_:2},1032,["color"])]),s("td",null,[l(N,{color:o.getStatusColor(f.status),size:"small"},{default:i(()=>[g(r(f.status),1)]),_:2},1032,["color"])]),s("td",null,[l(c,{icon:"mdi-eye",size:"small",variant:"text",onClick:k=>o.viewSale(f)},null,8,["onClick"]),l(c,{icon:"mdi-pencil",size:"small",variant:"text",onClick:k=>o.editSale(f)},null,8,["onClick"]),l(c,{icon:"mdi-printer",size:"small",variant:"text",onClick:k=>o.printInvoice(f)},null,8,["onClick"]),l(c,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:k=>o.confirmDelete(f)},null,8,["onClick"])])])}),128)),e.sales.length===0?(m(),p("tr",Ze,t[12]||(t[12]=[s("td",{colspan:"8",class:"text-center py-4"},"No sales found",-1)]))):x("",!0)])]),_:1,__:[13]})),s("div",$e,[s("div",ta,[e.sales.length>0&&e.pagination.total>0?(m(),p("span",ea,[t[14]||(t[14]=g(" Showing ")),s("strong",null,r((e.pagination.current_page-1)*e.pagination.per_page+1),1),t[15]||(t[15]=g(" to ")),s("strong",null,r(Math.min(e.pagination.current_page*e.pagination.per_page,e.pagination.total)),1),t[16]||(t[16]=g(" of ")),s("strong",null,r(e.pagination.total.toLocaleString()),1),t[17]||(t[17]=g(" records ")),e.pagination.last_page>1?(m(),p("span",aa," (Page "+r(e.pagination.current_page)+" of "+r(e.pagination.last_page)+") ",1)):x("",!0)])):(m(),p("span",sa," No records found "))]),e.pagination.last_page>1?(m(),p("div",oa,[l(q,{modelValue:e.pagination.current_page,"onUpdate:modelValue":[t[5]||(t[5]=f=>e.pagination.current_page=f),o.fetchSales],length:e.pagination.last_page,"total-visible":7,density:"comfortable"},null,8,["modelValue","length","onUpdate:modelValue"])])):x("",!0)])]),_:1})]),_:1}),l(M,{"model-value":e.dialog,"onUpdate:modelValue":t[6]||(t[6]=f=>e.dialog=f),sale:e.selectedSale,onSaved:o.handleSaved},null,8,["model-value","sale","onSaved"]),l(w,{"model-value":e.viewDialog,"onUpdate:modelValue":t[7]||(t[7]=f=>e.viewDialog=f),sale:e.selectedSale},null,8,["model-value","sale"])])}const ra=B(Re,[["render",la],["__scopeId","data-v-3cdd5a0a"]]);export{ra as default};
