import{a as G}from"./adminPaginationMixin-BpksgI63.js";import{r as R,n as W}from"./uploads-CnEkgyD_.js";import{_ as H,c,b as i,a as o,w as s,f as d,r as n,t as p,d as y,F as I,h as U,e as z,g as J,k as K,o as m}from"./app-VZD65mVg.js";const Q={mixins:[G],data(){return{categories:[],activeFilter:null,activeOptions:[{title:"Active",value:!0},{title:"Inactive",value:!1}],dialog:!1,editingCategory:null,saving:!1,form:{name:"",slug:"",description:"",image:"",order:0,is_active:!0},rules:{required:t=>!!t||"This field is required"},imageFile:null,uploadingImage:!1}},async mounted(){await this.loadCategories()},watch:{"form.name"(t){t?this.form.slug=this.generateSlug(t):this.form.slug=""}},methods:{generateSlug(t){return t.toString().toLowerCase().trim().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")},async loadCategories(){try{this.loading=!0;const t=this.buildPaginationParams();this.search&&(t.search=this.search),this.activeFilter!==null&&(t.is_active=this.activeFilter);const e=await this.$axios.get("/api/v1/categories",{params:t,headers:this.getAuthHeaders()});this.categories=e.data.data||[],this.updatePagination(e.data)}catch(t){this.handleApiError(t,"Failed to load categories")}finally{this.loading=!1}},openDialog(t){if(this.imageFile=null,t){this.editingCategory=t;const e=this.normalizeImageInput(t.image||"");this.form={name:t.name||"",slug:t.slug||"",description:t.description||"",image:e,order:t.order||0,is_active:t.is_active!==void 0?t.is_active:!0}}else this.editingCategory=null,this.form={name:"",slug:"",description:"",image:"",order:0,is_active:!0};this.dialog=!0},closeDialog(){this.dialog=!1,this.editingCategory=null,this.form={name:"",slug:"",description:"",image:"",order:0,is_active:!0},this.imageFile=null,this.$refs.form&&this.$refs.form.resetValidation()},async handleImageUpload(){var _;if(!this.imageFile)return;const t=Array.isArray(this.imageFile)?this.imageFile[0]:this.imageFile;if(!t)return;if(!t.type.startsWith("image/")){this.showError("Please select a valid image file"),this.imageFile=null;return}const e=5*1024*1024;if(t.size>e){this.showError("File size must be less than 5MB"),this.imageFile=null;return}this.uploadingImage=!0;try{const u=new FormData;u.append("image",t),u.append("folder","products/categories"),this.form.name&&u.append("prefix",this.form.name);const l=localStorage.getItem("admin_token"),r=await this.$axios.post("/api/v1/upload/image",u,{headers:{Authorization:`Bearer ${l}`,"Content-Type":"multipart/form-data"}});if(r.data.success){const g=this.normalizeImageInput(r.data.path||r.data.url);this.form.image=g,this.imageFile=null,this.showSuccess("Image uploaded successfully")}else throw new Error(r.data.message||"Failed to upload image")}catch(u){console.error("Error uploading image:",u);let l="Failed to upload image";u.response?l=((_=u.response.data)==null?void 0:_.message)||u.response.statusText||l:u.message&&(l=u.message),this.showError(l),this.imageFile=null}finally{this.uploadingImage=!1}},clearImage(){this.form.image="",this.imageFile=null},async saveCategory(){var t,e,_,u;if(this.$refs.form.validate()){this.saving=!0;try{const l=localStorage.getItem("admin_token"),r=this.editingCategory?`/api/v1/categories/${this.editingCategory.id}`:"/api/v1/categories",g={...this.form};g.image=this.normalizeImageInput(g.image);const f=this.editingCategory?"put":"post";await axios[f](r,g,{headers:{Authorization:`Bearer ${l}`}}),this.showSuccess(this.editingCategory?"Category updated successfully":"Category created successfully"),this.closeDialog(),await this.loadCategories()}catch(l){console.error("Error saving category:",l);let r="Error saving category";if((e=(t=l.response)==null?void 0:t.data)!=null&&e.errors){const g=l.response.data.errors,f=[];Object.keys(g).forEach(C=>{f.push(g[C][0])}),r=f.join(", ")}else(u=(_=l.response)==null?void 0:_.data)!=null&&u.message&&(r=l.response.data.message);this.showError(r)}finally{this.saving=!1}}},async deleteCategory(t){if(confirm(`Are you sure you want to delete ${t.name}?`))try{const e=localStorage.getItem("admin_token");await this.$axios.delete(`/api/v1/categories/${t.id}`,{headers:{Authorization:`Bearer ${e}`}}),this.showSuccess("Category deleted successfully"),await this.loadCategories()}catch(e){this.handleApiError(e,"Error deleting category")}},onPerPageChange(){this.resetPagination(),this.loadCategories()},onSort(t){this.handleSort(t),this.loadCategories()},isSortingBy(t){return this.sortBy===t},getSortDirection(t){return this.sortBy===t?this.sortDirection:null},normalizeImageInput(t){return W(t)},resolveImageUrl(t){return R(t)}}},X={class:"page-header"},Y={class:"text-caption text-grey"},Z={class:"sortable-header"},$={class:"sortable-header"},ee={class:"sortable-header"},te={class:"d-flex"},oe={class:"d-flex align-center"},ie={key:1,class:"text-caption text-grey"},le={key:0},ae={class:"d-flex flex-column flex-md-row justify-space-between align-center align-md-start gap-3 mt-4"},se={class:"text-caption text-grey"},re={key:0},ne={key:1},de={key:0,class:"d-flex align-center gap-2"},me={class:"pa-6"},ue={class:"mb-4"},ge={key:0,class:"mb-3 text-center"};function pe(t,e,_,u,l,r){const g=n("v-btn"),f=n("v-select"),C=n("v-col"),b=n("v-text-field"),x=n("v-row"),w=n("v-card-text"),k=n("v-card"),F=n("v-card-title"),v=n("v-icon"),h=n("v-skeleton-loader"),V=n("v-chip"),S=n("v-img"),P=n("v-avatar"),A=n("v-table"),D=n("v-pagination"),B=n("v-textarea"),E=n("v-progress-circular"),M=n("v-file-input"),N=n("v-switch"),O=n("v-form"),T=n("v-spacer"),j=n("v-card-actions"),q=n("v-dialog");return m(),c("div",null,[i("div",X,[e[16]||(e[16]=i("h1",{class:"text-h4 page-title"},"Category Management",-1)),o(g,{color:"primary","prepend-icon":"mdi-plus",onClick:e[0]||(e[0]=a=>r.openDialog(null)),class:"add-button"},{default:s(()=>e[15]||(e[15]=[d(" Add New Category ")])),_:1,__:[15]})]),o(k,{class:"mb-4"},{default:s(()=>[o(w,null,{default:s(()=>[o(x,null,{default:s(()=>[o(C,{cols:"12",md:"3"},{default:s(()=>[o(f,{modelValue:t.perPage,"onUpdate:modelValue":[e[1]||(e[1]=a=>t.perPage=a),r.onPerPageChange],items:t.perPageOptions,label:"Items per page","prepend-inner-icon":"mdi-format-list-numbered",variant:"outlined",density:"compact"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),o(C,{cols:"12",md:"3"},{default:s(()=>[o(f,{modelValue:l.activeFilter,"onUpdate:modelValue":[e[2]||(e[2]=a=>l.activeFilter=a),r.loadCategories],items:l.activeOptions,label:"Filter by Status",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),o(C,{cols:"12",md:"3"},{default:s(()=>[o(b,{modelValue:t.search,"onUpdate:modelValue":e[3]||(e[3]=a=>t.search=a),label:"Search by name, slug","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"",onInput:r.loadCategories},null,8,["modelValue","onInput"])]),_:1})]),_:1})]),_:1})]),_:1}),o(k,null,{default:s(()=>[o(F,{class:"d-flex justify-space-between align-center"},{default:s(()=>[e[18]||(e[18]=i("span",null,"Categories",-1)),i("span",Y,[e[17]||(e[17]=d(" Total Records: ")),i("strong",null,p(t.pagination.total||0),1)])]),_:1,__:[18]}),o(w,null,{default:s(()=>[o(A,null,{default:s(()=>[i("thead",null,[i("tr",null,[i("th",{class:"sortable",onClick:e[4]||(e[4]=a=>r.onSort("name"))},[i("div",Z,[e[20]||(e[20]=i("span",null,"Name",-1)),t.sortBy==="name"?(m(),y(v,{key:0,size:"18",class:"sort-icon active"},{default:s(()=>[d(p(t.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(m(),y(v,{key:1,size:"18",class:"sort-icon inactive"},{default:s(()=>e[19]||(e[19]=[d(" mdi-unfold-more-horizontal ")])),_:1,__:[19]}))])]),i("th",{class:"sortable",onClick:e[5]||(e[5]=a=>r.onSort("slug"))},[i("div",$,[e[22]||(e[22]=i("span",null,"Slug",-1)),t.sortBy==="slug"?(m(),y(v,{key:0,size:"18",class:"sort-icon active"},{default:s(()=>[d(p(t.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(m(),y(v,{key:1,size:"18",class:"sort-icon inactive"},{default:s(()=>e[21]||(e[21]=[d(" mdi-unfold-more-horizontal ")])),_:1,__:[21]}))])]),e[25]||(e[25]=i("th",null,"Image",-1)),i("th",{class:"sortable",onClick:e[6]||(e[6]=a=>r.onSort("order"))},[i("div",ee,[e[24]||(e[24]=i("span",null,"Order",-1)),t.sortBy==="order"?(m(),y(v,{key:0,size:"18",class:"sort-icon active"},{default:s(()=>[d(p(t.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(m(),y(v,{key:1,size:"18",class:"sort-icon inactive"},{default:s(()=>e[23]||(e[23]=[d(" mdi-unfold-more-horizontal ")])),_:1,__:[23]}))])]),e[26]||(e[26]=i("th",null,"Status",-1)),e[27]||(e[27]=i("th",null,"Actions",-1))])]),i("tbody",null,[t.loading?(m(),c(I,{key:0},U(5,a=>i("tr",{key:`skeleton-${a}`},[i("td",null,[o(h,{type:"text",width:"150"})]),i("td",null,[o(h,{type:"text",width:"120"})]),i("td",null,[o(h,{type:"image",width:"50",height:"50"})]),i("td",null,[o(h,{type:"text",width:"40"})]),i("td",null,[o(h,{type:"chip",width:"80",height:"24"})]),i("td",null,[i("div",te,[o(h,{type:"button",width:"32",height:"32",class:"mr-1"}),o(h,{type:"button",width:"32",height:"32"})])])])),64)):(m(),c(I,{key:1},[(m(!0),c(I,null,U(l.categories,a=>(m(),c("tr",{key:a.id},[i("td",null,[i("div",oe,[o(v,{size:"small",color:"primary",class:"mr-2"},{default:s(()=>e[28]||(e[28]=[d(" mdi-folder ")])),_:1,__:[28]}),d(" "+p(a.name),1)])]),i("td",null,[o(V,{size:"small",variant:"outlined"},{default:s(()=>[d(p(a.slug),1)]),_:2},1024)]),i("td",null,[a.image?(m(),y(P,{key:0,size:"50"},{default:s(()=>[o(S,{src:a.image,alt:a.name},null,8,["src","alt"])]),_:2},1024)):(m(),c("span",ie,"-"))]),i("td",null,[o(V,{size:"small",color:"grey-lighten-2"},{default:s(()=>[d(p(a.order||0),1)]),_:2},1024)]),i("td",null,[o(V,{color:a.is_active?"success":"error",size:"small"},{default:s(()=>[d(p(a.is_active?"Active":"Inactive"),1)]),_:2},1032,["color"])]),i("td",null,[o(g,{size:"small",icon:"mdi-pencil",onClick:L=>r.openDialog(a),variant:"text",title:"Edit Category"},null,8,["onClick"]),o(g,{size:"small",icon:"mdi-delete",onClick:L=>r.deleteCategory(a),variant:"text",color:"error",title:"Delete Category"},null,8,["onClick"])])]))),128)),l.categories.length===0?(m(),c("tr",le,e[29]||(e[29]=[i("td",{colspan:"6",class:"text-center py-4"},"No categories found",-1)]))):z("",!0)],64))])]),_:1}),i("div",ae,[i("div",se,[l.categories.length>0&&t.pagination.total>0?(m(),c("span",re,[e[30]||(e[30]=d(" Showing ")),i("strong",null,p((t.currentPage-1)*t.perPage+1),1),e[31]||(e[31]=d(" to ")),i("strong",null,p(Math.min(t.currentPage*t.perPage,t.pagination.total)),1),e[32]||(e[32]=d(" of ")),i("strong",null,p(t.pagination.total.toLocaleString()),1),e[33]||(e[33]=d(" records "))])):(m(),c("span",ne,"No records found"))]),t.pagination.last_page>1?(m(),c("div",de,[o(D,{modelValue:t.currentPage,"onUpdate:modelValue":[e[7]||(e[7]=a=>t.currentPage=a),r.loadCategories],length:t.pagination.last_page,"total-visible":7,density:"comfortable"},null,8,["modelValue","length","onUpdate:modelValue"])])):z("",!0)])]),_:1})]),_:1}),o(q,{modelValue:l.dialog,"onUpdate:modelValue":e[14]||(e[14]=a=>l.dialog=a),"max-width":"700",scrollable:"",persistent:""},{default:s(()=>[o(k,null,{default:s(()=>[o(F,null,{default:s(()=>[d(p(l.editingCategory?"Edit Category":"Add New Category"),1)]),_:1}),o(w,{class:"pa-0"},{default:s(()=>[o(O,{ref:"form",onSubmit:J(r.saveCategory,["prevent"])},{default:s(()=>[i("div",me,[o(b,{modelValue:l.form.name,"onUpdate:modelValue":e[8]||(e[8]=a=>l.form.name=a),rules:[l.rules.required],required:"",class:"mb-4"},{label:s(()=>e[34]||(e[34]=[d(" Category Name "),i("span",{class:"text-error"},"*",-1)])),_:1},8,["modelValue","rules"]),o(b,{modelValue:l.form.slug,"onUpdate:modelValue":e[9]||(e[9]=a=>l.form.slug=a),label:"Slug",hint:"Auto-generated from category name","persistent-hint":"",class:"mb-4",readonly:""},null,8,["modelValue"]),o(b,{modelValue:l.form.order,"onUpdate:modelValue":e[10]||(e[10]=a=>l.form.order=a),modelModifiers:{number:!0},label:"Display Order",type:"number",min:"0",hint:"Lower numbers appear first","persistent-hint":"",class:"mb-4"},null,8,["modelValue"]),o(B,{modelValue:l.form.description,"onUpdate:modelValue":e[11]||(e[11]=a=>l.form.description=a),label:"Description",variant:"outlined",rows:"3",hint:"Brief description about the category","persistent-hint":"",class:"mb-4"},null,8,["modelValue"]),i("div",ue,[e[36]||(e[36]=i("div",{class:"text-subtitle-2 font-weight-medium mb-2"},"Category Image",-1)),l.form.image?(m(),c("div",ge,[o(P,{size:"120",class:"mb-2"},{default:s(()=>[o(S,{src:l.form.image?r.resolveImageUrl(l.form.image):"",alt:"Category Preview"},null,8,["src"])]),_:1}),i("div",null,[o(g,{size:"small",variant:"text",color:"error","prepend-icon":"mdi-delete",onClick:r.clearImage},{default:s(()=>e[35]||(e[35]=[d("Remove Image")])),_:1,__:[35]},8,["onClick"])])])):z("",!0),o(M,{modelValue:l.imageFile,"onUpdate:modelValue":[e[12]||(e[12]=a=>l.imageFile=a),r.handleImageUpload],label:"Upload Image",variant:"outlined",density:"comfortable",color:"primary",accept:"image/*","prepend-icon":"mdi-image",hint:"Upload a category image (JPG, PNG, GIF, WebP - Max 5MB)","persistent-hint":"","show-size":""},K({_:2},[l.uploadingImage?{name:"append-inner",fn:s(()=>[o(E,{indeterminate:"",size:"20",color:"primary"})]),key:"0"}:void 0]),1032,["modelValue","onUpdate:modelValue"])]),o(N,{modelValue:l.form.is_active,"onUpdate:modelValue":e[13]||(e[13]=a=>l.form.is_active=a),label:"Active Category",color:"success",class:"mb-4"},null,8,["modelValue"])])]),_:1},8,["onSubmit"])]),_:1}),o(j,null,{default:s(()=>[o(T),o(g,{onClick:r.closeDialog,variant:"text"},{default:s(()=>e[37]||(e[37]=[d("Cancel")])),_:1,__:[37]},8,["onClick"]),o(g,{onClick:r.saveCategory,color:"primary",loading:l.saving},{default:s(()=>[d(p(l.editingCategory?"Update":"Create"),1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const he=H(Q,[["render",pe],["__scopeId","data-v-4f46bc4c"]]);export{he as default};
