import{_ as B,i as y,d as E,w as i,a as l,r as s,b as n,t as d,f,o as p,c as _,l as D,e as P,F as T,h as K}from"./app-CiFPWy5I.js";const M={name:"ProductDialog",props:{modelValue:{type:Boolean,required:!0},product:{type:Object,default:null}},emits:["update:modelValue","saved"],data(){return{form:this.getEmptyForm(),formValid:!1,saving:!1,categoryOptions:[],unitOptions:[],rules:{required:o=>!!o||"Required"}}},computed:{isEdit(){return!!this.form.id}},watch:{product:{immediate:!0,handler(o){this.form=o?{...this.getEmptyForm(),...o}:this.getEmptyForm()}}},created(){this.fetchOptions()},methods:{getEmptyForm(){return{id:null,name:"",sku:"",barcode:"",brand:"",category_id:null,unit_id:null,description:"",image:"",purchase_price:0,sale_price:0,tax_rate:0,minimum_stock_level:0,is_active:!0}},async fetchOptions(){try{const[o,e]=await Promise.all([y.get("/api/v1/products/categories"),y.get("/api/v1/products/units")]);this.categoryOptions=o.data.categories||[],this.unitOptions=e.data.units||[]}catch(o){console.error("Failed to load options",o)}},generateSKU(){let o="";if(this.form.name&&this.form.name.trim()){const m=this.form.name.trim().toUpperCase().split(/\s+/).map(t=>t.substring(0,2)).join("").substring(0,4),V=Date.now().toString().slice(-6);o=`${m}-${V}`}else{const e="PROD",m=Math.random().toString(36).substring(2,8).toUpperCase();o=`${e}-${m}`}this.form.sku=o},close(){this.$emit("update:modelValue",!1)},async save(){var e;if(await this.$refs.formRef.validate()){this.saving=!0;try{const m={...this.form};this.isEdit?await y.put(`/api/v1/products/${this.form.id}`,m):await y.post("/api/v1/products",m),this.$emit("saved"),this.close()}catch(m){console.error("Failed to save product",m),(e=this.$toast)==null||e.error("Failed to save product")}finally{this.saving=!1}}}}},z={class:"text-h6 font-weight-medium"};function N(o,e,m,V,t,u){const v=s("v-btn"),b=s("v-card-title"),h=s("v-divider"),g=s("v-text-field"),c=s("v-col"),x=s("v-switch"),w=s("v-select"),k=s("v-textarea"),U=s("v-row"),C=s("v-form"),F=s("v-card-text"),S=s("v-card-actions"),O=s("v-card"),r=s("v-dialog");return p(),E(r,{"model-value":m.modelValue,"onUpdate:modelValue":e[14]||(e[14]=a=>o.$emit("update:modelValue",a)),"max-width":"700px",persistent:"",scrollable:""},{default:i(()=>[l(O,{class:"product-dialog"},{default:i(()=>[l(b,{class:"dialog-header d-flex justify-space-between align-center pa-3"},{default:i(()=>[n("span",z,d(u.isEdit?"Edit Product":"Add Product"),1),l(v,{icon:"mdi-close",variant:"text",size:"small",onClick:u.close},null,8,["onClick"])]),_:1}),l(h),l(F,{class:"pa-3"},{default:i(()=>[l(C,{ref:"formRef",modelValue:t.formValid,"onUpdate:modelValue":e[13]||(e[13]=a=>t.formValid=a),"lazy-validation":""},{default:i(()=>[l(U,{dense:"",class:"ma-0"},{default:i(()=>[l(c,{cols:"12",sm:"8",class:"pa-2"},{default:i(()=>[l(g,{modelValue:t.form.name,"onUpdate:modelValue":e[0]||(e[0]=a=>t.form.name=a),label:"Product Name",rules:[t.rules.required],density:"compact",variant:"outlined","hide-details":"auto"},null,8,["modelValue","rules"])]),_:1}),l(c,{cols:"12",sm:"4",class:"pa-2 d-flex align-center"},{default:i(()=>[l(x,{modelValue:t.form.is_active,"onUpdate:modelValue":e[1]||(e[1]=a=>t.form.is_active=a),inset:"",label:"Active",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),l(c,{cols:"12",sm:"6",class:"pa-2"},{default:i(()=>[l(g,{modelValue:t.form.sku,"onUpdate:modelValue":e[2]||(e[2]=a=>t.form.sku=a),label:"SKU",density:"compact",variant:"outlined","hide-details":""},{"append-inner":i(()=>[l(v,{icon:"mdi-refresh",size:"x-small",variant:"text",onClick:u.generateSKU,title:"Generate SKU"},null,8,["onClick"])]),_:1},8,["modelValue"])]),_:1}),l(c,{cols:"12",sm:"6",class:"pa-2"},{default:i(()=>[l(g,{modelValue:t.form.barcode,"onUpdate:modelValue":e[3]||(e[3]=a=>t.form.barcode=a),label:"Barcode",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),l(c,{cols:"12",sm:"6",class:"pa-2"},{default:i(()=>[l(g,{modelValue:t.form.brand,"onUpdate:modelValue":e[4]||(e[4]=a=>t.form.brand=a),label:"Brand",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),l(c,{cols:"12",sm:"6",class:"pa-2"},{default:i(()=>[l(g,{modelValue:t.form.image,"onUpdate:modelValue":e[5]||(e[5]=a=>t.form.image=a),label:"Image URL",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),l(c,{cols:"12",sm:"6",class:"pa-2"},{default:i(()=>[l(w,{modelValue:t.form.category_id,"onUpdate:modelValue":e[6]||(e[6]=a=>t.form.category_id=a),items:t.categoryOptions,"item-value":"value","item-title":"label",label:"Category",clearable:"",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1}),l(c,{cols:"12",sm:"6",class:"pa-2"},{default:i(()=>[l(w,{modelValue:t.form.unit_id,"onUpdate:modelValue":e[7]||(e[7]=a=>t.form.unit_id=a),items:t.unitOptions,"item-value":"value","item-title":"label",label:"Unit",clearable:"",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1}),l(c,{cols:"12",sm:"6",class:"pa-2"},{default:i(()=>[l(g,{modelValue:t.form.purchase_price,"onUpdate:modelValue":e[8]||(e[8]=a=>t.form.purchase_price=a),modelModifiers:{number:!0},label:"Purchase Price",type:"number",min:"0",step:"0.01",rules:[t.rules.required],density:"compact",variant:"outlined","hide-details":"auto"},null,8,["modelValue","rules"])]),_:1}),l(c,{cols:"12",sm:"6",class:"pa-2"},{default:i(()=>[l(g,{modelValue:t.form.sale_price,"onUpdate:modelValue":e[9]||(e[9]=a=>t.form.sale_price=a),modelModifiers:{number:!0},label:"Sale Price",type:"number",min:"0",step:"0.01",rules:[t.rules.required],density:"compact",variant:"outlined","hide-details":"auto"},null,8,["modelValue","rules"])]),_:1}),l(c,{cols:"12",sm:"6",class:"pa-2"},{default:i(()=>[l(g,{modelValue:t.form.tax_rate,"onUpdate:modelValue":e[10]||(e[10]=a=>t.form.tax_rate=a),modelModifiers:{number:!0},label:"VAT/Tax (%)",type:"number",min:"0",step:"0.01",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),l(c,{cols:"12",sm:"6",class:"pa-2"},{default:i(()=>[l(g,{modelValue:t.form.minimum_stock_level,"onUpdate:modelValue":e[11]||(e[11]=a=>t.form.minimum_stock_level=a),modelModifiers:{number:!0},label:"Minimum Stock Alert",type:"number",min:"0",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),l(c,{cols:"12",class:"pa-2"},{default:i(()=>[l(k,{modelValue:t.form.description,"onUpdate:modelValue":e[12]||(e[12]=a=>t.form.description=a),label:"Description",rows:"2",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(h),l(S,{class:"pa-2 justify-end"},{default:i(()=>[l(v,{variant:"text",size:"small",onClick:u.close},{default:i(()=>e[15]||(e[15]=[f("Cancel")])),_:1,__:[15]},8,["onClick"]),l(v,{color:"primary",size:"small",loading:t.saving,onClick:u.save},{default:i(()=>[f(d(u.isEdit?"Update":"Save"),1)]),_:1},8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["model-value"])}const R=B(M,[["render",N],["__scopeId","data-v-dca803cf"]]),j={name:"AdminProducts",components:{ProductDialog:R},data(){return{products:[],loading:!1,search:"",categoryOptions:[],categoryFilter:null,activeOptions:[{title:"Active",value:!0},{title:"Inactive",value:!1}],activeFilter:null,dialog:!1,editingProduct:null,pagination:{current_page:1,per_page:15,last_page:1,total:0},perPageOptions:[{title:"10",value:10},{title:"15",value:15},{title:"25",value:25},{title:"50",value:50},{title:"100",value:100}]}},mounted(){this.loadOptions(),this.loadProducts()},methods:{async loadOptions(){try{const{data:o}=await y.get("/api/v1/products/categories");this.categoryOptions=o.categories||[]}catch(o){console.error("Failed to load categories",o)}},async loadProducts(){this.loading=!0;try{const o={page:this.pagination.current_page,per_page:this.pagination.per_page};this.search&&(o.search=this.search),this.categoryFilter&&(o.category_id=this.categoryFilter),this.activeFilter!==null&&(o.is_active=this.activeFilter);const{data:e}=await y.get("/api/v1/products",{params:o});this.products=e.data||[],this.pagination={current_page:e.current_page||1,per_page:e.per_page||15,last_page:e.last_page||1,total:e.total||0}}catch(o){console.error("Failed to load products",o),this.showError("Failed to load products")}finally{this.loading=!1}},openDialog(o){this.editingProduct=o,this.dialog=!0},async deleteProduct(o){var m,V;if((await window.Swal.fire({title:"Are you sure?",text:`Do you want to delete product ${o.name}?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"})).isConfirmed)try{await y.delete(`/api/v1/products/${o.id}`),this.showSuccess("Product deleted successfully"),this.loadProducts()}catch(t){console.error("Failed to delete product",t),this.showError(((V=(m=t.response)==null?void 0:m.data)==null?void 0:V.message)||"Failed to delete product")}},onPerPageChange(){this.pagination.current_page=1,this.loadProducts()},resetFilters(){this.search="",this.categoryFilter=null,this.activeFilter=null,this.pagination.current_page=1,this.loadProducts()},onSearchChange(){this.pagination.current_page=1,this.loadProducts()},onFilterChange(){this.pagination.current_page=1,this.loadProducts()},showSuccess(o){window.Toast?window.Toast.fire({icon:"success",title:o}):window.Swal?window.Swal.fire({icon:"success",title:o,timer:2e3,showConfirmButton:!1}):alert(o)},showError(o){window.Toast?window.Toast.fire({icon:"error",title:o}):window.Swal?window.Swal.fire({icon:"error",title:o}):alert(o)}}},q={class:"page-header"},I={class:"text-caption text-grey"},L={key:0},G={key:0,class:"text-center py-4"},Y={class:"font-weight-medium"},H={class:"text-end"},J={class:"text-end"},Q={class:"text-end"},W={key:0},X={class:"d-flex flex-column flex-md-row justify-space-between align-center align-md-start gap-3 mt-4"},Z={class:"text-caption text-grey"},$={key:0},ee={key:0,class:"ml-2"},te={key:1},le={key:0,class:"d-flex align-center gap-2"};function oe(o,e,m,V,t,u){const v=s("v-btn"),b=s("v-select"),h=s("v-col"),g=s("v-text-field"),c=s("v-row"),x=s("v-card-text"),w=s("v-card"),k=s("v-card-title"),U=s("v-progress-circular"),C=s("v-chip"),F=s("v-table"),S=s("v-pagination"),O=s("product-dialog");return p(),_("div",null,[n("div",q,[e[8]||(e[8]=n("h1",{class:"text-h4 page-title"},"Products",-1)),l(v,{color:"primary","prepend-icon":"mdi-plus",onClick:e[0]||(e[0]=r=>u.openDialog(null)),class:"add-button"},{default:i(()=>e[7]||(e[7]=[f(" Add Product ")])),_:1,__:[7]})]),l(w,{class:"mb-4"},{default:i(()=>[l(x,null,{default:i(()=>[l(c,null,{default:i(()=>[l(h,{cols:"12",md:"3"},{default:i(()=>[l(b,{modelValue:t.pagination.per_page,"onUpdate:modelValue":[e[1]||(e[1]=r=>t.pagination.per_page=r),u.onPerPageChange],items:t.perPageOptions,label:"Items per page","prepend-inner-icon":"mdi-format-list-numbered",variant:"outlined",density:"compact"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),l(h,{cols:"12",md:"2"},{default:i(()=>[l(b,{modelValue:t.categoryFilter,"onUpdate:modelValue":[e[2]||(e[2]=r=>t.categoryFilter=r),u.onFilterChange],items:t.categoryOptions,"item-value":"value","item-title":"label",label:"Category",clearable:"",variant:"outlined",density:"compact"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),l(h,{cols:"12",md:"3"},{default:i(()=>[l(b,{modelValue:t.activeFilter,"onUpdate:modelValue":[e[3]||(e[3]=r=>t.activeFilter=r),u.onFilterChange],items:t.activeOptions,label:"Status",clearable:"",variant:"outlined",density:"compact"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),l(h,{cols:"12",md:"4"},{default:i(()=>[l(g,{modelValue:t.search,"onUpdate:modelValue":[e[4]||(e[4]=r=>t.search=r),u.onSearchChange],label:"Search by name, SKU, barcode","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"",onKeyup:D(u.loadProducts,["enter"])},null,8,["modelValue","onKeyup","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),l(w,null,{default:i(()=>[l(k,{class:"d-flex justify-space-between align-center"},{default:i(()=>[e[10]||(e[10]=n("span",null,"Products",-1)),n("span",I,[e[9]||(e[9]=f(" Total Records: ")),n("strong",null,d(t.pagination.total||0),1),t.products.length>0?(p(),_("span",L," | Showing "+d((t.pagination.current_page-1)*t.pagination.per_page+1)+" to "+d(Math.min(t.pagination.current_page*t.pagination.per_page,t.pagination.total))+" of "+d(t.pagination.total),1)):P("",!0)])]),_:1,__:[10]}),l(x,null,{default:i(()=>[t.loading?(p(),_("div",G,[l(U,{indeterminate:"",color:"primary"})])):(p(),E(F,{key:1},{default:i(()=>[e[12]||(e[12]=n("thead",null,[n("tr",null,[n("th",null,"Name"),n("th",null,"SKU"),n("th",null,"Category"),n("th",{class:"text-end"},"Purchase"),n("th",{class:"text-end"},"Sale"),n("th",{class:"text-end"},"Min Stock"),n("th",null,"Status"),n("th",null,"Actions")])],-1)),n("tbody",null,[(p(!0),_(T,null,K(t.products,r=>{var a;return p(),_("tr",{key:r.id},[n("td",null,[n("span",Y,d(r.name),1)]),n("td",null,d(r.sku||"-"),1),n("td",null,d(((a=r.category)==null?void 0:a.name)||"-"),1),n("td",H,"৳"+d(parseFloat(r.purchase_price||0).toFixed(2)),1),n("td",J,"৳"+d(parseFloat(r.sale_price||0).toFixed(2)),1),n("td",Q,d(r.minimum_stock_level||0),1),n("td",null,[l(C,{size:"small",color:r.is_active?"success":"error",variant:"tonal"},{default:i(()=>[f(d(r.is_active?"Active":"Inactive"),1)]),_:2},1032,["color"])]),n("td",null,[l(v,{icon:"mdi-pencil",variant:"text",size:"small",onClick:A=>u.openDialog(r)},null,8,["onClick"]),l(v,{icon:"mdi-delete",variant:"text",size:"small",color:"error",onClick:A=>u.deleteProduct(r)},null,8,["onClick"])])])}),128)),t.products.length===0?(p(),_("tr",W,e[11]||(e[11]=[n("td",{colspan:"8",class:"text-center py-4"},"No products found",-1)]))):P("",!0)])]),_:1,__:[12]})),n("div",X,[n("div",Z,[t.products.length>0&&t.pagination.total>0?(p(),_("span",$,[e[13]||(e[13]=f(" Showing ")),n("strong",null,d((t.pagination.current_page-1)*t.pagination.per_page+1),1),e[14]||(e[14]=f(" to ")),n("strong",null,d(Math.min(t.pagination.current_page*t.pagination.per_page,t.pagination.total)),1),e[15]||(e[15]=f(" of ")),n("strong",null,d(t.pagination.total.toLocaleString()),1),e[16]||(e[16]=f(" records ")),t.pagination.last_page>1?(p(),_("span",ee," (Page "+d(t.pagination.current_page)+" of "+d(t.pagination.last_page)+") ",1)):P("",!0)])):(p(),_("span",te," No records found "))]),t.pagination.last_page>1?(p(),_("div",le,[l(S,{modelValue:t.pagination.current_page,"onUpdate:modelValue":[e[5]||(e[5]=r=>t.pagination.current_page=r),u.loadProducts],length:t.pagination.last_page,"total-visible":7,density:"comfortable"},null,8,["modelValue","length","onUpdate:modelValue"])])):P("",!0)])]),_:1})]),_:1}),l(O,{modelValue:t.dialog,"onUpdate:modelValue":e[6]||(e[6]=r=>t.dialog=r),product:t.editingProduct,onSaved:u.loadProducts},null,8,["modelValue","product","onSaved"])])}const ae=B(j,[["render",oe],["__scopeId","data-v-c0f0eb8c"]]);export{ae as default};
