import{c as M}from"./commonMixin-BwIVv23E.js";import{_ as E,d as v,w as s,a as o,r as u,f as p,t as r,g as H,b as t,c as h,e as b,h as B,F as A,o as c,p as L}from"./app-C4LtncxF.js";import{P as R,p as j}from"./PaginationControls-bn3QRFAz.js";const W={name:"PurchaseDialog",props:{modelValue:{type:Boolean,default:!1},editingPurchase:{type:Object,default:null},supplierOptions:{type:Array,default:()=>[]},warehouseOptions:{type:Array,default:()=>[]},grnOptions:{type:Array,default:()=>[]},productOptions:{type:Array,default:()=>[]},saving:{type:Boolean,default:!1}},emits:["update:modelValue","save","cancel"],data(){return{activeTab:"basic",localForm:{supplier_id:null,warehouse_id:null,grn_id:null,invoice_date:new Date().toISOString().split("T")[0],due_date:null,shipping_cost:0,notes:"",items:[]},rules:{required:l=>!!l||"This field is required",minValue:l=>l>0||"Quantity must be greater than 0"}}},computed:{calculatedSubtotal(){return this.localForm.items.reduce((l,e)=>{const i=(e.quantity||0)*(e.unit_price||0)-(e.discount||0);return l+i},0)},calculatedTax(){return this.localForm.items.reduce((l,e)=>l+(e.tax||0),0)},calculatedDiscount(){return this.localForm.items.reduce((l,e)=>l+(e.discount||0),0)},calculatedTotal(){return this.calculatedSubtotal+this.calculatedTax+(this.localForm.shipping_cost||0)-this.calculatedDiscount}},watch:{modelValue(l){l&&this.editingPurchase?this.initializeForm(this.editingPurchase):l&&this.resetForm()},editingPurchase:{handler(l){l&&this.modelValue&&this.initializeForm(l)},deep:!0}},methods:{initializeForm(l){var e;this.activeTab="basic",this.localForm={supplier_id:l.supplier_id,warehouse_id:l.warehouse_id,grn_id:l.grn_id,invoice_date:l.invoice_date,due_date:l.due_date,shipping_cost:l.shipping_cost||0,notes:l.notes||"",items:((e=l.items)==null?void 0:e.map(i=>({product_id:i.product_id,quantity:i.quantity,unit_price:i.unit_price,discount:i.discount||0,tax:i.tax||0,total:i.total||0})))||[]}},resetForm(){this.activeTab="basic",this.localForm={supplier_id:null,warehouse_id:null,grn_id:null,invoice_date:new Date().toISOString().split("T")[0],due_date:null,shipping_cost:0,notes:"",items:[]},this.$refs.form&&this.$refs.form.resetValidation()},calculateItemTotal(l){const e=this.localForm.items[l];if(e.quantity&&e.unit_price){const i=e.quantity*e.unit_price-(e.discount||0)+(e.tax||0);this.$set(this.localForm.items[l],"total",i)}},calculateTotals(){},addPurchaseItem(){this.localForm.items.push({product_id:null,quantity:1,unit_price:0,discount:0,tax:0,total:0})},removePurchaseItem(l){this.localForm.items.splice(l,1)},handleSave(){if(this.$refs.form.validate()){if(this.localForm.items.length===0){this.$emit("save",{...this.localForm},"Please add at least one item");return}this.$emit("save",{...this.localForm},null)}},handleCancel(){this.resetForm(),this.$emit("cancel")},formatCurrency(l){return l==null?"৳0.00":"৳"+new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(l)}}},Q={class:"pa-6"},G={class:"pa-6"},K={class:"d-flex justify-space-between align-center mb-2"},J={key:0},X={key:1},Y={class:"font-weight-bold"},Z={key:2},$={key:3},ee={key:4},te={key:5},le={class:"font-weight-bold"};function oe(l,e,i,O,a,n){const k=u("v-card-title"),C=u("v-tab"),w=u("v-tabs"),P=u("v-select"),V=u("v-col"),x=u("v-text-field"),F=u("v-textarea"),D=u("v-row"),g=u("v-window-item"),f=u("v-btn"),I=u("v-table"),T=u("v-window"),_=u("v-form"),z=u("v-card-text"),U=u("v-spacer"),d=u("v-card-actions"),N=u("v-card"),q=u("v-dialog");return c(),v(q,{"model-value":i.modelValue,"onUpdate:modelValue":e[9]||(e[9]=m=>l.$emit("update:modelValue",m)),"max-width":"1000",scrollable:"",persistent:""},{default:s(()=>[o(N,null,{default:s(()=>[o(k,null,{default:s(()=>[p(r(i.editingPurchase?"Edit Purchase Invoice":"New Purchase Invoice"),1)]),_:1}),o(z,{class:"pa-0"},{default:s(()=>[o(_,{ref:"form",onSubmit:H(n.handleSave,["prevent"])},{default:s(()=>[o(w,{modelValue:a.activeTab,"onUpdate:modelValue":e[0]||(e[0]=m=>a.activeTab=m),"bg-color":"grey-lighten-4"},{default:s(()=>[o(C,{value:"basic"},{default:s(()=>e[10]||(e[10]=[p("Basic Information")])),_:1,__:[10]}),o(C,{value:"items"},{default:s(()=>e[11]||(e[11]=[p("Items")])),_:1,__:[11]})]),_:1},8,["modelValue"]),o(T,{modelValue:a.activeTab,"onUpdate:modelValue":e[8]||(e[8]=m=>a.activeTab=m)},{default:s(()=>[o(g,{value:"basic"},{default:s(()=>[t("div",Q,[o(D,null,{default:s(()=>[o(V,{cols:"12",md:"6"},{default:s(()=>[o(P,{modelValue:a.localForm.supplier_id,"onUpdate:modelValue":e[1]||(e[1]=m=>a.localForm.supplier_id=m),items:i.supplierOptions,"item-title":"label","item-value":"value",label:"Supplier",rules:[a.rules.required],required:""},null,8,["modelValue","items","rules"])]),_:1}),o(V,{cols:"12",md:"6"},{default:s(()=>[o(P,{modelValue:a.localForm.warehouse_id,"onUpdate:modelValue":e[2]||(e[2]=m=>a.localForm.warehouse_id=m),items:i.warehouseOptions,"item-title":"label","item-value":"value",label:"Warehouse",rules:[a.rules.required],required:""},null,8,["modelValue","items","rules"])]),_:1}),o(V,{cols:"12",md:"6"},{default:s(()=>[o(P,{modelValue:a.localForm.grn_id,"onUpdate:modelValue":e[3]||(e[3]=m=>a.localForm.grn_id=m),items:i.grnOptions,"item-title":"label","item-value":"value",label:"GRN (Optional)",clearable:""},null,8,["modelValue","items"])]),_:1}),o(V,{cols:"12",md:"6"},{default:s(()=>[o(x,{modelValue:a.localForm.invoice_date,"onUpdate:modelValue":e[4]||(e[4]=m=>a.localForm.invoice_date=m),label:"Invoice Date",type:"date",rules:[a.rules.required],required:""},null,8,["modelValue","rules"])]),_:1}),o(V,{cols:"12",md:"6"},{default:s(()=>[o(x,{modelValue:a.localForm.due_date,"onUpdate:modelValue":e[5]||(e[5]=m=>a.localForm.due_date=m),label:"Due Date",type:"date"},null,8,["modelValue"])]),_:1}),o(V,{cols:"12",md:"6"},{default:s(()=>[o(x,{modelValue:a.localForm.shipping_cost,"onUpdate:modelValue":e[6]||(e[6]=m=>a.localForm.shipping_cost=m),modelModifiers:{number:!0},label:"Shipping Cost",type:"number",min:"0",step:"0.01",prefix:"৳",onInput:n.calculateTotals},null,8,["modelValue","onInput"])]),_:1}),o(V,{cols:"12"},{default:s(()=>[o(F,{modelValue:a.localForm.notes,"onUpdate:modelValue":e[7]||(e[7]=m=>a.localForm.notes=m),label:"Notes",variant:"outlined",rows:"2"},null,8,["modelValue"])]),_:1})]),_:1})])]),_:1}),o(g,{value:"items"},{default:s(()=>[t("div",G,[t("div",K,[e[13]||(e[13]=t("h3",{class:"text-h6"},"Invoice Items",-1)),o(f,{size:"small",color:"primary","prepend-icon":"mdi-plus",onClick:n.addPurchaseItem},{default:s(()=>e[12]||(e[12]=[p("Add Item")])),_:1,__:[12]},8,["onClick"])]),o(I,null,{default:s(()=>[e[25]||(e[25]=t("thead",null,[t("tr",null,[t("th",null,"Product"),t("th",null,"Quantity"),t("th",null,"Unit Price"),t("th",null,"Discount"),t("th",null,"Tax"),t("th",null,"Total"),t("th",null,"Actions")])],-1)),t("tbody",null,[(c(!0),h(A,null,B(a.localForm.items,(m,S)=>(c(),h("tr",{key:S},[t("td",null,[o(P,{modelValue:m.product_id,"onUpdate:modelValue":[y=>m.product_id=y,y=>n.calculateItemTotal(S)],items:i.productOptions,"item-title":"label","item-value":"value",density:"compact",rules:[a.rules.required]},null,8,["modelValue","onUpdate:modelValue","items","rules"])]),t("td",null,[o(x,{modelValue:m.quantity,"onUpdate:modelValue":y=>m.quantity=y,modelModifiers:{number:!0},type:"number",min:"1",density:"compact",onInput:y=>n.calculateItemTotal(S),rules:[a.rules.required,a.rules.minValue]},null,8,["modelValue","onUpdate:modelValue","onInput","rules"])]),t("td",null,[o(x,{modelValue:m.unit_price,"onUpdate:modelValue":y=>m.unit_price=y,modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",density:"compact",onInput:y=>n.calculateItemTotal(S),rules:[a.rules.required]},null,8,["modelValue","onUpdate:modelValue","onInput","rules"])]),t("td",null,[o(x,{modelValue:m.discount,"onUpdate:modelValue":y=>m.discount=y,modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",density:"compact",onInput:y=>n.calculateItemTotal(S)},null,8,["modelValue","onUpdate:modelValue","onInput"])]),t("td",null,[o(x,{modelValue:m.tax,"onUpdate:modelValue":y=>m.tax=y,modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",density:"compact",onInput:y=>n.calculateItemTotal(S)},null,8,["modelValue","onUpdate:modelValue","onInput"])]),t("td",null,r(n.formatCurrency(m.total||0)),1),t("td",null,[o(f,{size:"small",icon:"mdi-delete",variant:"text",color:"error",onClick:y=>n.removePurchaseItem(S)},null,8,["onClick"])])]))),128)),a.localForm.items.length===0?(c(),h("tr",J,e[14]||(e[14]=[t("td",{colspan:"7",class:"text-center py-4 text-grey"},"No items added",-1)]))):b("",!0),a.localForm.items.length>0?(c(),h("tr",X,[e[15]||(e[15]=t("td",{colspan:"5",class:"text-right font-weight-bold"},"Subtotal:",-1)),t("td",Y,r(n.formatCurrency(n.calculatedSubtotal)),1),e[16]||(e[16]=t("td",null,null,-1))])):b("",!0),a.localForm.items.length>0?(c(),h("tr",Z,[e[17]||(e[17]=t("td",{colspan:"5",class:"text-right"},"Tax:",-1)),t("td",null,r(n.formatCurrency(n.calculatedTax)),1),e[18]||(e[18]=t("td",null,null,-1))])):b("",!0),a.localForm.items.length>0?(c(),h("tr",$,[e[19]||(e[19]=t("td",{colspan:"5",class:"text-right"},"Shipping:",-1)),t("td",null,r(n.formatCurrency(a.localForm.shipping_cost||0)),1),e[20]||(e[20]=t("td",null,null,-1))])):b("",!0),a.localForm.items.length>0?(c(),h("tr",ee,[e[21]||(e[21]=t("td",{colspan:"5",class:"text-right"},"Discount:",-1)),t("td",null,r(n.formatCurrency(n.calculatedDiscount)),1),e[22]||(e[22]=t("td",null,null,-1))])):b("",!0),a.localForm.items.length>0?(c(),h("tr",te,[e[23]||(e[23]=t("td",{colspan:"5",class:"text-right font-weight-bold"},"Total:",-1)),t("td",le,r(n.formatCurrency(n.calculatedTotal)),1),e[24]||(e[24]=t("td",null,null,-1))])):b("",!0)])]),_:1,__:[25]})])]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["onSubmit"])]),_:1}),o(d,null,{default:s(()=>[o(U),o(f,{onClick:n.handleCancel,variant:"text"},{default:s(()=>e[26]||(e[26]=[p("Cancel")])),_:1,__:[26]},8,["onClick"]),o(f,{onClick:n.handleSave,color:"primary",loading:i.saving},{default:s(()=>[p(r(i.editingPurchase?"Update":"Create"),1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["model-value"])}const se=E(W,[["render",oe]]),ae={name:"ViewPurchaseDialog",props:{modelValue:{type:Boolean,default:!1},purchase:{type:Object,default:null}},emits:["update:modelValue"],methods:{formatCurrency(l){return l==null?"৳0.00":"৳"+new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(l)},formatDate(l){return l?new Date(l).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"N/A"},getStatusColor(l){return{draft:"grey",pending:"warning",partial:"info",paid:"success",cancelled:"error"}[l]||"default"}}},ne={class:"pa-6"},ie={class:"text-h6 font-weight-bold"},re={class:"text-body-1"},ue={class:"text-body-1 font-weight-medium"},de={class:"text-body-1 font-weight-medium"},ce={class:"text-body-1"},me={class:"text-body-1"},pe={class:"text-body-1"},_e={class:"mt-4"},ve={class:"font-weight-medium"},he={key:0},ge={class:"d-flex justify-space-between mb-2"},fe={class:"text-body-2 font-weight-medium"},ye={class:"d-flex justify-space-between mb-2"},be={class:"text-body-2"},we={class:"d-flex justify-space-between mb-2"},Pe={class:"text-body-2"},xe={class:"d-flex justify-space-between mb-2"},Ve={class:"text-body-2"},ke={class:"d-flex justify-space-between mb-2"},Ce={class:"text-h6 font-weight-bold"},Fe={class:"d-flex justify-space-between mb-2"},Se={class:"text-body-2"},De={class:"d-flex justify-space-between"};function Ie(l,e,i,O,a,n){const k=u("v-chip"),C=u("v-card-title"),w=u("v-col"),P=u("v-row"),V=u("v-table"),x=u("v-divider"),F=u("v-card-text"),D=u("v-card"),g=u("v-spacer"),f=u("v-btn"),I=u("v-card-actions"),T=u("v-dialog");return c(),v(T,{"model-value":i.modelValue,"onUpdate:modelValue":e[1]||(e[1]=_=>l.$emit("update:modelValue",_)),"max-width":"1000",scrollable:""},{default:s(()=>[i.purchase?(c(),v(D,{key:0},{default:s(()=>[o(C,{class:"d-flex justify-space-between align-center"},{default:s(()=>[e[2]||(e[2]=t("span",null,"Purchase Invoice Details",-1)),o(k,{color:n.getStatusColor(i.purchase.status),size:"small"},{default:s(()=>[p(r(i.purchase.status),1)]),_:1},8,["color"])]),_:1,__:[2]}),o(F,{class:"pa-0"},{default:s(()=>[t("div",ne,[o(P,{class:"mb-4"},{default:s(()=>[o(w,{cols:"12",md:"6"},{default:s(()=>[e[3]||(e[3]=t("div",{class:"text-caption text-grey mb-1"},"Invoice Number",-1)),t("div",ie,r(i.purchase.invoice_number),1)]),_:1,__:[3]}),o(w,{cols:"12",md:"6"},{default:s(()=>[e[4]||(e[4]=t("div",{class:"text-caption text-grey mb-1"},"Invoice Date",-1)),t("div",re,r(n.formatDate(i.purchase.invoice_date)),1)]),_:1,__:[4]})]),_:1}),o(P,{class:"mb-4"},{default:s(()=>[o(w,{cols:"12",md:"6"},{default:s(()=>{var _;return[e[5]||(e[5]=t("div",{class:"text-caption text-grey mb-1"},"Supplier",-1)),t("div",ue,r(((_=i.purchase.supplier)==null?void 0:_.name)||"N/A"),1)]}),_:1,__:[5]}),o(w,{cols:"12",md:"6"},{default:s(()=>{var _;return[e[6]||(e[6]=t("div",{class:"text-caption text-grey mb-1"},"Warehouse",-1)),t("div",de,r(((_=i.purchase.warehouse)==null?void 0:_.name)||"N/A"),1)]}),_:1,__:[6]})]),_:1}),o(P,{class:"mb-4"},{default:s(()=>[i.purchase.grn?(c(),v(w,{key:0,cols:"12",md:"6"},{default:s(()=>{var _;return[e[7]||(e[7]=t("div",{class:"text-caption text-grey mb-1"},"GRN",-1)),t("div",ce,r(((_=i.purchase.grn)==null?void 0:_.grn_number)||"N/A"),1)]}),_:1,__:[7]})):b("",!0),i.purchase.due_date?(c(),v(w,{key:1,cols:"12",md:"6"},{default:s(()=>[e[8]||(e[8]=t("div",{class:"text-caption text-grey mb-1"},"Due Date",-1)),t("div",me,r(n.formatDate(i.purchase.due_date)),1)]),_:1,__:[8]})):b("",!0)]),_:1}),i.purchase.notes?(c(),v(P,{key:0,class:"mb-4"},{default:s(()=>[o(w,{cols:"12"},{default:s(()=>[e[9]||(e[9]=t("div",{class:"text-caption text-grey mb-1"},"Notes",-1)),t("div",pe,r(i.purchase.notes),1)]),_:1,__:[9]})]),_:1})):b("",!0),t("div",_e,[e[19]||(e[19]=t("h3",{class:"text-h6 mb-3"},"Invoice Items",-1)),o(V,null,{default:s(()=>[e[11]||(e[11]=t("thead",null,[t("tr",null,[t("th",null,"Product"),t("th",null,"SKU"),t("th",null,"Quantity"),t("th",null,"Unit Price"),t("th",null,"Discount"),t("th",null,"Tax"),t("th",null,"Total")])],-1)),t("tbody",null,[(c(!0),h(A,null,B(i.purchase.items,(_,z)=>{var U,d;return c(),h("tr",{key:z},[t("td",null,r(((U=_.product)==null?void 0:U.name)||"N/A"),1),t("td",null,r(((d=_.product)==null?void 0:d.sku)||"N/A"),1),t("td",null,r(_.quantity),1),t("td",null,r(n.formatCurrency(_.unit_price)),1),t("td",null,r(n.formatCurrency(_.discount||0)),1),t("td",null,r(n.formatCurrency(_.tax||0)),1),t("td",ve,r(n.formatCurrency(_.total||0)),1)])}),128)),!i.purchase.items||i.purchase.items.length===0?(c(),h("tr",he,e[10]||(e[10]=[t("td",{colspan:"7",class:"text-center py-4 text-grey"},"No items found",-1)]))):b("",!0)])]),_:1,__:[11]}),o(P,{class:"mt-4"},{default:s(()=>[o(w,{cols:"12",md:"6","offset-md":"6"},{default:s(()=>[o(D,{variant:"outlined"},{default:s(()=>[o(F,null,{default:s(()=>[t("div",ge,[e[12]||(e[12]=t("span",{class:"text-body-2"},"Subtotal:",-1)),t("span",fe,r(n.formatCurrency(i.purchase.subtotal||0)),1)]),t("div",ye,[e[13]||(e[13]=t("span",{class:"text-body-2"},"Tax:",-1)),t("span",be,r(n.formatCurrency(i.purchase.tax_amount||0)),1)]),t("div",we,[e[14]||(e[14]=t("span",{class:"text-body-2"},"Shipping:",-1)),t("span",Pe,r(n.formatCurrency(i.purchase.shipping_cost||0)),1)]),t("div",xe,[e[15]||(e[15]=t("span",{class:"text-body-2"},"Discount:",-1)),t("span",Ve,r(n.formatCurrency(i.purchase.discount_amount||0)),1)]),o(x,{class:"my-2"}),t("div",ke,[e[16]||(e[16]=t("span",{class:"text-h6 font-weight-bold"},"Total:",-1)),t("span",Ce,r(n.formatCurrency(i.purchase.total_amount||0)),1)]),t("div",Fe,[e[17]||(e[17]=t("span",{class:"text-body-2"},"Paid:",-1)),t("span",Se,r(n.formatCurrency(i.purchase.paid_amount||0)),1)]),t("div",De,[e[18]||(e[18]=t("span",{class:"text-body-2 font-weight-medium"},"Balance:",-1)),t("span",{class:L(["text-body-2 font-weight-medium",i.purchase.balance_amount>0?"text-warning":"text-success"])},r(n.formatCurrency(i.purchase.balance_amount||0)),3)])]),_:1})]),_:1})]),_:1})]),_:1})])])]),_:1}),o(I,null,{default:s(()=>[o(g),o(f,{onClick:e[0]||(e[0]=_=>l.$emit("update:modelValue",!1)),variant:"text"},{default:s(()=>e[20]||(e[20]=[p("Close")])),_:1,__:[20]})]),_:1})]),_:1})):b("",!0)]),_:1},8,["model-value"])}const Ue=E(ae,[["render",Ie]]),Te={components:{PurchaseDialog:se,ViewPurchaseDialog:Ue,PaginationControls:R},mixins:[M],data(){return{purchases:[],suppliers:[],supplierOptions:[],warehouses:[],warehouseOptions:[],products:[],productOptions:[],statusFilter:null,statusOptions:[{title:"Draft",value:"draft"},{title:"Pending",value:"pending"},{title:"Partial",value:"partial"},{title:"Paid",value:"paid"},{title:"Cancelled",value:"cancelled"}],supplierFilter:null,dialog:!1,editingPurchase:null,saving:!1,viewDialog:!1,viewingPurchase:null,currentPage:1,perPage:10,perPageOptions:[{title:"10",value:10,description:"Quick view"},{title:"25",value:25,description:"Standard"},{title:"50",value:50,description:"Comfortable"},{title:"100",value:100,description:"Extended"},{title:"500",value:500,description:"Large dataset"},{title:"Show All",value:"all",description:"All records"}],pagination:{current_page:1,last_page:1,per_page:10,total:0}}},async mounted(){await this.loadSuppliers(),await this.loadWarehouses(),await this.loadProducts(),await this.loadPurchases()},methods:{async loadPurchases(){try{this.loading=!0;const l=this.buildPaginationParams();this.perPage==="all"&&(l.per_page=999999),this.search&&(l.search=this.search),this.statusFilter&&(l.status=this.statusFilter),this.supplierFilter&&(l.supplier_id=this.supplierFilter);const e=await this.$axios.get("/api/v1/purchases",{params:l,headers:this.getAuthHeaders()});this.purchases=e.data.data||[],this.updatePagination(e.data)}catch(l){this.handleApiError(l,"Failed to load purchases")}finally{this.loading=!1}},async loadSuppliers(){try{const l=await this.$axios.get("/api/v1/suppliers",{params:{per_page:1e3},headers:this.getAuthHeaders()}),e=l.data.data||l.data||[];this.suppliers=e,this.supplierOptions=e.map(i=>({label:i.name,value:i.id}))}catch(l){console.error("Error loading suppliers:",l)}},async loadWarehouses(){try{const l=await this.$axios.get("/api/v1/stock-ledger/warehouses",{headers:this.getAuthHeaders()});this.warehouses=l.data.warehouses||[],this.warehouseOptions=this.warehouses}catch(l){console.error("Error loading warehouses:",l)}},async loadProducts(){try{const l=await this.$axios.get("/api/v1/products",{params:{per_page:1e3,is_active:!0},headers:this.getAuthHeaders()});this.products=l.data.data||[],this.productOptions=this.products.map(e=>({label:`${e.name} (${e.sku})`,value:e.id}))}catch(l){console.error("Error loading products:",l)}},openDialog(l){this.editingPurchase=l||null,this.dialog=!0},closeDialog(){this.dialog=!1,this.editingPurchase=null},async handleSavePurchase(l,e){if(e){this.showError(e);return}this.saving=!0;try{const i=localStorage.getItem("admin_token"),O=this.editingPurchase?`/api/v1/purchases/${this.editingPurchase.id}`:"/api/v1/purchases",a=this.editingPurchase?"put":"post";await axios[a](O,l,{headers:{Authorization:`Bearer ${i}`}}),this.showSuccess(this.editingPurchase?"Purchase updated successfully":"Purchase created successfully"),this.closeDialog(),await this.loadPurchases()}catch(i){this.handleApiError(i,"Error saving purchase")}finally{this.saving=!1}},async receivePurchase(l){if(confirm(`Receive stock for purchase ${l.invoice_number}? This will update stock levels.`))try{const e=localStorage.getItem("admin_token");await this.$axios.post(`/api/v1/purchases/${l.id}/receive`,{},{headers:{Authorization:`Bearer ${e}`}}),this.showSuccess("Purchase received and stock updated successfully"),await this.loadPurchases()}catch(e){this.handleApiError(e,"Error receiving purchase")}},async deletePurchase(l){if(confirm(`Delete purchase ${l.invoice_number}?`))try{const e=localStorage.getItem("admin_token");await this.$axios.delete(`/api/v1/purchases/${l.id}`,{headers:{Authorization:`Bearer ${e}`}}),this.showSuccess("Purchase deleted successfully"),await this.loadPurchases()}catch(e){this.handleApiError(e,"Error deleting purchase")}},async viewPurchase(l){try{const e=await this.$axios.get(`/api/v1/purchases/${l.id}`,{headers:this.getAuthHeaders()});this.viewingPurchase=e.data,this.viewDialog=!0}catch(e){this.handleApiError(e,"Failed to load purchase details")}},formatCurrency(l){return l==null?"৳0.00":"৳"+new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(l)},getStatusColor(l){return{draft:"grey",pending:"warning",partial:"info",paid:"success",cancelled:"error"}[l]||"default"},buildPaginationParams(l={}){return j.buildPaginationParams(this.currentPage,this.perPage,l,this.sortBy,this.sortDirection)},updatePagination(l){j.updatePagination(this,l)},resetPagination(){j.resetPagination(this)},onPerPageUpdate(l){this.perPage=l,this.onPerPageChange()},onPageChange(l){this.currentPage=l,this.loadPurchases()},onPerPageChange(){this.resetPagination(),this.loadPurchases()},onSort(l){this.handleSort(l),this.currentPage=1,this.loadPurchases()}}},ze={class:"page-header"},Ae={class:"text-caption text-grey"},Oe={class:"sortable-header"},Ne={class:"sortable-header"},qe={class:"sortable-header"},Be={class:"sortable-header justify-end"},je={class:"sortable-header justify-end"},Ee={class:"sortable-header justify-end"},Me={key:0},He={class:"d-flex flex-column flex-md-row justify-space-between align-center align-md-start gap-3 mt-4"},Le={class:"text-caption text-grey"},Re={key:0},We={key:0},Qe={key:1},Ge={key:1};function Ke(l,e,i,O,a,n){const k=u("v-btn"),C=u("v-select"),w=u("v-col"),P=u("v-text-field"),V=u("v-row"),x=u("v-card-text"),F=u("v-card"),D=u("v-card-title"),g=u("v-icon"),f=u("v-skeleton-loader"),I=u("v-chip"),T=u("v-table"),_=u("PaginationControls"),z=u("PurchaseDialog"),U=u("ViewPurchaseDialog");return c(),h("div",null,[t("div",ze,[e[14]||(e[14]=t("h1",{class:"text-h4 page-title"},"Supplier Invoices (Purchases)",-1)),o(k,{color:"primary","prepend-icon":"mdi-plus",onClick:e[0]||(e[0]=d=>n.openDialog(null)),class:"add-button"},{default:s(()=>e[13]||(e[13]=[p(" New Purchase Invoice ")])),_:1,__:[13]})]),o(F,{class:"mb-4"},{default:s(()=>[o(x,null,{default:s(()=>[o(V,null,{default:s(()=>[o(w,{cols:"12",md:"4"},{default:s(()=>[o(C,{modelValue:a.statusFilter,"onUpdate:modelValue":[e[1]||(e[1]=d=>a.statusFilter=d),n.loadPurchases],items:a.statusOptions,label:"Filter by Status",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),o(w,{cols:"12",md:"4"},{default:s(()=>[o(C,{modelValue:a.supplierFilter,"onUpdate:modelValue":[e[2]||(e[2]=d=>a.supplierFilter=d),n.loadPurchases],items:a.supplierOptions,label:"Filter by Supplier",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),o(w,{cols:"12",md:"4"},{default:s(()=>[o(P,{modelValue:l.search,"onUpdate:modelValue":e[3]||(e[3]=d=>l.search=d),label:"Search by invoice number","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"",onInput:n.loadPurchases},null,8,["modelValue","onInput"])]),_:1})]),_:1})]),_:1})]),_:1}),o(F,null,{default:s(()=>[o(D,{class:"d-flex justify-space-between align-center"},{default:s(()=>[e[16]||(e[16]=t("span",null,"Supplier Invoices",-1)),t("span",Ae,[e[15]||(e[15]=p(" Total Records: ")),t("strong",null,r(a.pagination.total||0),1)])]),_:1,__:[16]}),o(x,null,{default:s(()=>[o(T,null,{default:s(()=>[t("thead",null,[t("tr",null,[t("th",{class:"sortable",onClick:e[4]||(e[4]=d=>n.onSort("invoice_number"))},[t("div",Oe,[e[18]||(e[18]=t("span",null,"Invoice #",-1)),l.sortBy==="invoice_number"?(c(),v(g,{key:0,size:"18",class:"sort-icon active"},{default:s(()=>[p(r(l.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(c(),v(g,{key:1,size:"18",class:"sort-icon inactive"},{default:s(()=>e[17]||(e[17]=[p(" mdi-unfold-more-horizontal ")])),_:1,__:[17]}))])]),e[29]||(e[29]=t("th",null,"Supplier",-1)),e[30]||(e[30]=t("th",null,"Warehouse",-1)),t("th",{class:"sortable",onClick:e[5]||(e[5]=d=>n.onSort("invoice_date"))},[t("div",Ne,[e[20]||(e[20]=t("span",null,"Invoice Date",-1)),l.sortBy==="invoice_date"?(c(),v(g,{key:0,size:"18",class:"sort-icon active"},{default:s(()=>[p(r(l.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(c(),v(g,{key:1,size:"18",class:"sort-icon inactive"},{default:s(()=>e[19]||(e[19]=[p(" mdi-unfold-more-horizontal ")])),_:1,__:[19]}))])]),t("th",{class:"sortable",onClick:e[6]||(e[6]=d=>n.onSort("status"))},[t("div",qe,[e[22]||(e[22]=t("span",null,"Status",-1)),l.sortBy==="status"?(c(),v(g,{key:0,size:"18",class:"sort-icon active"},{default:s(()=>[p(r(l.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(c(),v(g,{key:1,size:"18",class:"sort-icon inactive"},{default:s(()=>e[21]||(e[21]=[p(" mdi-unfold-more-horizontal ")])),_:1,__:[21]}))])]),t("th",{class:"text-end sortable",onClick:e[7]||(e[7]=d=>n.onSort("total_amount"))},[t("div",Be,[e[24]||(e[24]=t("span",null,"Total Amount",-1)),l.sortBy==="total_amount"?(c(),v(g,{key:0,size:"18",class:"sort-icon active"},{default:s(()=>[p(r(l.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(c(),v(g,{key:1,size:"18",class:"sort-icon inactive"},{default:s(()=>e[23]||(e[23]=[p(" mdi-unfold-more-horizontal ")])),_:1,__:[23]}))])]),t("th",{class:"text-end sortable",onClick:e[8]||(e[8]=d=>n.onSort("paid_amount"))},[t("div",je,[e[26]||(e[26]=t("span",null,"Paid",-1)),l.sortBy==="paid_amount"?(c(),v(g,{key:0,size:"18",class:"sort-icon active"},{default:s(()=>[p(r(l.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(c(),v(g,{key:1,size:"18",class:"sort-icon inactive"},{default:s(()=>e[25]||(e[25]=[p(" mdi-unfold-more-horizontal ")])),_:1,__:[25]}))])]),t("th",{class:"text-end sortable",onClick:e[9]||(e[9]=d=>n.onSort("balance_amount"))},[t("div",Ee,[e[28]||(e[28]=t("span",null,"Balance",-1)),l.sortBy==="balance_amount"?(c(),v(g,{key:0,size:"18",class:"sort-icon active"},{default:s(()=>[p(r(l.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(c(),v(g,{key:1,size:"18",class:"sort-icon inactive"},{default:s(()=>e[27]||(e[27]=[p(" mdi-unfold-more-horizontal ")])),_:1,__:[27]}))])]),e[31]||(e[31]=t("th",null,"Actions",-1))])]),t("tbody",null,[l.loading?(c(),h(A,{key:0},B(5,d=>t("tr",{key:`skeleton-${d}`},[t("td",null,[o(f,{type:"text",width:"120"})]),t("td",null,[o(f,{type:"text",width:"150"})]),t("td",null,[o(f,{type:"text",width:"100"})]),t("td",null,[o(f,{type:"text",width:"100"})]),t("td",null,[o(f,{type:"chip",width:"80",height:"24"})]),t("td",null,[o(f,{type:"text",width:"100"})]),t("td",null,[o(f,{type:"text",width:"100"})]),t("td",null,[o(f,{type:"text",width:"100"})]),t("td",null,[o(f,{type:"button",width:"32",height:"32"})])])),64)):(c(),h(A,{key:1},[(c(!0),h(A,null,B(a.purchases,d=>{var N,q;return c(),h("tr",{key:d.id},[t("td",null,r(d.invoice_number),1),t("td",null,r((N=d.supplier)==null?void 0:N.name),1),t("td",null,r((q=d.warehouse)==null?void 0:q.name),1),t("td",null,r(l.formatDate(d.invoice_date)),1),t("td",null,[o(I,{color:n.getStatusColor(d.status),size:"small"},{default:s(()=>[p(r(d.status),1)]),_:2},1032,["color"])]),t("td",null,r(n.formatCurrency(d.total_amount)),1),t("td",null,r(n.formatCurrency(d.paid_amount)),1),t("td",null,[o(I,{color:d.balance_amount>0?"warning":"success",size:"small"},{default:s(()=>[p(r(n.formatCurrency(d.balance_amount)),1)]),_:2},1032,["color"])]),t("td",null,[o(k,{size:"small",icon:"mdi-eye",onClick:m=>n.viewPurchase(d),variant:"text",title:"View"},null,8,["onClick"]),d.status==="draft"?(c(),v(k,{key:0,size:"small",icon:"mdi-pencil",onClick:m=>n.openDialog(d),variant:"text",title:"Edit"},null,8,["onClick"])):b("",!0),d.status==="draft"?(c(),v(k,{key:1,size:"small",icon:"mdi-package-variant",onClick:m=>n.receivePurchase(d),variant:"text",color:"success",title:"Receive Stock"},null,8,["onClick"])):b("",!0),d.status==="draft"?(c(),v(k,{key:2,size:"small",icon:"mdi-delete",onClick:m=>n.deletePurchase(d),variant:"text",color:"error",title:"Delete"},null,8,["onClick"])):b("",!0)])])}),128)),a.purchases.length===0?(c(),h("tr",Me,e[32]||(e[32]=[t("td",{colspan:"9",class:"text-center py-4"},"No purchases found",-1)]))):b("",!0)],64))])]),_:1}),t("div",He,[t("div",Le,[a.purchases.length>0&&a.pagination.total>0?(c(),h("span",Re,[a.perPage==="all"?(c(),h("span",We,[e[33]||(e[33]=p(" Showing ")),t("strong",null,"all "+r(a.pagination.total.toLocaleString()),1),e[34]||(e[34]=p(" records "))])):(c(),h("span",Qe,[e[35]||(e[35]=p(" Showing ")),t("strong",null,r((a.currentPage-1)*a.perPage+1),1),e[36]||(e[36]=p(" to ")),t("strong",null,r(Math.min(a.currentPage*a.perPage,a.pagination.total)),1),e[37]||(e[37]=p(" of ")),t("strong",null,r(a.pagination.total.toLocaleString()),1),e[38]||(e[38]=p(" records "))]))])):(c(),h("span",Ge,"No records found"))]),o(_,{modelValue:a.currentPage,"onUpdate:modelValue":e[10]||(e[10]=d=>a.currentPage=d),pagination:a.pagination,"per-page-value":a.perPage,"per-page-options":a.perPageOptions,"onUpdate:perPage":n.onPerPageUpdate,onPageChange:n.onPageChange},null,8,["modelValue","pagination","per-page-value","per-page-options","onUpdate:perPage","onPageChange"])])]),_:1})]),_:1}),o(z,{modelValue:a.dialog,"onUpdate:modelValue":e[11]||(e[11]=d=>a.dialog=d),"editing-purchase":a.editingPurchase,"supplier-options":a.supplierOptions,"warehouse-options":a.warehouseOptions,"product-options":a.productOptions,saving:a.saving,onSave:n.handleSavePurchase,onCancel:n.closeDialog},null,8,["modelValue","editing-purchase","supplier-options","warehouse-options","product-options","saving","onSave","onCancel"]),o(U,{modelValue:a.viewDialog,"onUpdate:modelValue":e[12]||(e[12]=d=>a.viewDialog=d),purchase:a.viewingPurchase},null,8,["modelValue","purchase"])])}const Ze=E(Te,[["render",Ke],["__scopeId","data-v-debb24fa"]]);export{Ze as default};
