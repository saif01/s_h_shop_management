import{_ as Y,c as _,a as l,w as n,r as c,m as L,o as h,i as I,d as C,b as s,f as x,t as d,e as b,l as Z,F as O,h as B,p as W}from"./app-VZD65mVg.js";import{a as K}from"./adminPaginationMixin-BpksgI63.js";const $={props:["fieldLabel","required","variant","min","initialDate"],data(){return{isMenuOpen:null,selectedDate:this.initialDate==null?null:new Date(this.initialDate),dbFormatDate:null,dateFieldLavel:this.fieldLabel??"Selected date",fieldPlaceHolder:"Enter "+this.fieldLabel,yesterdayIso:new Date(new Date().setDate(new Date().getDate()-1))}},computed:{computedCustomValue(){if(this.selectedDate)return this.frmtInsideDate(this.selectedDate)}},watch:{computedCustomValue:function(a){a&&this.dbFormatDate!==null&&this.$emit("trigerInputValue",this.dbFormatDate)},initialDate:function(a){a?(this.selectedDate=new Date(a),this.$nextTick(()=>{this.computedCustomValue&&this.dbFormatDate&&this.$emit("trigerInputValue",this.dbFormatDate)})):(this.selectedDate=null,this.dbFormatDate=null,this.$emit("trigerInputValue",null))}},mounted(){this.initialDate&&this.selectedDate&&this.$nextTick(()=>{this.computedCustomValue&&this.dbFormatDate&&this.$emit("trigerInputValue",this.dbFormatDate)})},methods:{onClear(){this.selectedDate=null,this.dbFormatDate=null,this.$emit("trigerInputValue",null)},frmtInsideDate(a){const t=new Date(a),i=t.getDate(),f=t.getMonth()+1,e=t.getFullYear(),o=i.toString().padStart(2,"0"),u=f.toString().padStart(2,"0"),v=`${o}/${u}/${e}`;return this.dbFormatDate=`${e}-${u}-${o}`,v}}};function tt(a,t,i,f,e,o){const u=c("v-text-field"),v=c("v-date-picker"),y=c("v-menu");return h(),_("div",null,[l(y,{modelValue:e.isMenuOpen,"onUpdate:modelValue":t[3]||(t[3]=r=>e.isMenuOpen=r),"close-on-content-click":!1},{activator:n(({props:r})=>[l(u,L({label:e.dateFieldLavel,placeholder:e.fieldPlaceHolder,"model-value":o.computedCustomValue,readonly:""},r,{clearable:"","onClick:clear":t[0]||(t[0]=g=>o.onClear()),density:"compact",class:i.required?"required":null,variant:i.variant?i.variant:"outlined",rules:[i.required?g=>!!g||`This ${e.dateFieldLavel} is required`:null]}),null,16,["label","placeholder","model-value","class","variant","rules"])]),default:n(()=>[l(v,{"show-adjacent-months":"","hide-header":"","hide-actions":"",position:"sticky",modelValue:e.selectedDate,"onUpdate:modelValue":[t[1]||(t[1]=r=>e.selectedDate=r),t[2]||(t[2]=r=>(e.isMenuOpen=!1,i.initialDate=null))],min:i.min?e.yesterdayIso:null},null,8,["modelValue","min"])]),_:1},8,["modelValue"])])}const et=Y($,[["render",tt]]),at={name:"SaleDialog",mixins:[K],components:{DatePickerVuetifyInput:et},props:{modelValue:{type:Boolean,required:!0},sale:{type:Object,default:null}},emits:["update:modelValue","saved"],data(){return{form:this.getEmptyForm(),formValid:!1,cartItems:[],productSearch:"",searchResults:[],mostSoldProducts:[],customers:[],warehouses:[],saving:!1,paymentMethod:"cash",paymentMethods:[{title:"Cash",value:"cash"},{title:"Card",value:"card"},{title:"Mobile Banking",value:"mobile_banking"},{title:"Bank Transfer",value:"bank_transfer"},{title:"Cheque",value:"cheque"}],rules:{required:a=>!!a||"Required"},discountAmountManuallySet:!1,taxAmountManuallySet:!1}},computed:{isEdit(){return!!this.form.id},calculatedItemsDiscount(){return this.cartItems.reduce((a,t)=>a+(t.discount||0),0)},calculatedItemsTax(){return this.cartItems.reduce((a,t)=>a+(t.tax||0),0)},calculatedTotalTax(){const a=this.calculatedItemsTax,t=parseFloat(this.form.tax_amount)||0,i=this.form.tax_amount>0||this.taxAmountManuallySet||this.form.tax_amount===0&&a===0?t:0;return a+i}},watch:{sale:{immediate:!0,async handler(a){a&&a.id?await this.loadSaleForEdit(a.id):(this.form=this.getEmptyForm(),this.cartItems=[],this.discountAmountManuallySet=!1,this.taxAmountManuallySet=!1)}},modelValue(a){a?(this.fetchOptions(),this.fetchMostSoldProducts(),(!this.sale||!this.sale.id)&&(this.form=this.getEmptyForm(),this.cartItems=[],this.discountAmountManuallySet=!1,this.taxAmountManuallySet=!1)):(this.form=this.getEmptyForm(),this.cartItems=[],this.discountAmountManuallySet=!1,this.taxAmountManuallySet=!1)}},methods:{getEmptyForm(){return{id:null,customer_id:null,warehouse_id:null,invoice_date:new Date().toISOString().split("T")[0],due_date:null,subtotal:0,tax_amount:0,discount_amount:0,shipping_cost:0,total_amount:0,paid_amount:0,balance_amount:0,notes:""}},async fetchOptions(){try{const[a,t]=await Promise.all([I.get("/api/v1/customers"),I.get("/api/v1/warehouses")]);this.customers=a.data.data||a.data.customers||[],this.warehouses=t.data.data||t.data.warehouses||[]}catch(a){console.error("Failed to load options",a)}},async fetchMostSoldProducts(){try{const{data:a}=await I.get("/api/v1/products",{params:{per_page:10,is_active:1,sort:"most_sold",order:"desc"}});let t=a.data||a.products||[];if(t.length===0){const{data:i}=await I.get("/api/v1/products",{params:{per_page:10,is_active:1,has_stock:1}});t=i.data||i.products||[]}this.mostSoldProducts=t.filter(i=>i.stock_quantity>0).slice(0,10)}catch(a){console.error("Failed to load most sold products",a)}},async searchProducts(){if(this.productSearch)try{const{data:a}=await I.get("/api/v1/products",{params:{search:this.productSearch,per_page:10}});this.searchResults=a.data||a.products||[]}catch(a){console.error("Failed to search products",a)}},addToCart(a){const t=this.cartItems.findIndex(i=>i.product_id===a.id);if(t>=0)this.cartItems[t].quantity++,this.updateCartItem(t);else{const i=parseFloat(a.tax_rate||0);this.cartItems.push({product_id:a.id,product_name:a.name,quantity:1,unit_price:parseFloat(a.sale_price),discount:0,tax_rate:i,tax:0,total:0}),this.updateCartItem(this.cartItems.length-1)}if(!this.form.warehouse_id&&a.stock_by_warehouse&&a.stock_by_warehouse.length>0){const i=a.stock_by_warehouse.filter(f=>f.quantity>0).sort((f,e)=>(e.quantity||0)-(f.quantity||0))[0];i&&i.warehouse_id?this.form.warehouse_id=i.warehouse_id:a.stock_by_warehouse[0]&&a.stock_by_warehouse[0].warehouse_id&&(this.form.warehouse_id=a.stock_by_warehouse[0].warehouse_id)}this.productSearch="",this.searchResults=[],this.calculateTotals()},updateCartItem(a,t=!1){const i=this.cartItems[a];if(!i)return;const e=i.quantity*i.unit_price-(i.discount||0);if(t)e>0&&i.tax>0&&(i.tax_rate=parseFloat((i.tax/e*100).toFixed(2)));else{const o=parseFloat(i.tax_rate||0);i.tax=parseFloat((e*o/100).toFixed(2))}i.total=parseFloat((e+i.tax).toFixed(2)),this.calculateTotals()},removeFromCart(a){this.cartItems.splice(a,1),this.calculateTotals()},calculateTotals(){const a=this.cartItems.reduce((u,v)=>u+v.quantity*v.unit_price,0),t=this.cartItems.reduce((u,v)=>u+(v.discount||0),0),i=this.cartItems.reduce((u,v)=>u+(v.tax||0),0);this.form.subtotal=parseFloat(a.toFixed(2));const f=this.form.discount_amount>0||this.form.discount_amount===0&&t===0?parseFloat(this.form.discount_amount):t,e=this.form.tax_amount>0||this.form.tax_amount===0&&i===0?parseFloat(this.form.tax_amount):i,o=a-f+e+(parseFloat(this.form.shipping_cost)||0);this.form.total_amount=parseFloat(o.toFixed(2)),this.calculateBalance()},calculateBalance(){this.form.balance_amount=parseFloat((this.form.total_amount-(this.form.paid_amount||0)).toFixed(2))},async loadSaleForEdit(a){var t,i,f;if(a)try{const o=(await I.get(`/api/v1/sales/${a}`)).data;if(!o){this.showError("Sale not found");return}console.log("Loading sale for edit:",o),this.form={id:o.id,customer_id:o.customer_id,warehouse_id:o.warehouse_id,invoice_date:o.invoice_date?o.invoice_date.includes("T")?o.invoice_date.split("T")[0]:o.invoice_date:new Date().toISOString().split("T")[0],due_date:o.due_date?o.due_date.includes("T")?o.due_date.split("T")[0]:o.due_date:null,subtotal:parseFloat(o.subtotal||0),tax_amount:parseFloat(o.tax_amount||0),discount_amount:parseFloat(o.discount_amount||0),shipping_cost:parseFloat(o.shipping_cost||0),total_amount:parseFloat(o.total_amount||0),paid_amount:parseFloat(o.paid_amount||0),balance_amount:parseFloat(o.balance_amount||0),notes:o.notes||""},this.discountAmountManuallySet=!0,this.taxAmountManuallySet=!0,o.items&&Array.isArray(o.items)&&o.items.length>0?this.cartItems=o.items.map(u=>{var k,M;const v=(u.quantity||0)*(u.unit_price||0),y=parseFloat(u.discount||0),r=v-y;let g=0;((k=u.product)==null?void 0:k.tax_rate)!==void 0?g=parseFloat(u.product.tax_rate||0):r>0&&(g=parseFloat(u.tax||0)/r*100);const D=parseFloat((r*g/100).toFixed(2)),F=parseFloat((r+D).toFixed(2));return{product_id:u.product_id,product_name:((M=u.product)==null?void 0:M.name)||"Unknown",quantity:parseInt(u.quantity,10),unit_price:parseFloat(u.unit_price||0),discount:y,tax_rate:g,tax:D,total:F}}):this.cartItems=[],this.calculateTotals()}catch(e){console.error("Failed to load sale for edit:",e),console.error("Error response:",(t=e.response)==null?void 0:t.data),this.showError(((f=(i=e.response)==null?void 0:i.data)==null?void 0:f.message)||"Failed to load sale details")}},showSuccess(a){window.Toast?window.Toast.fire({icon:"success",title:a}):window.Swal?window.Swal.fire({icon:"success",title:a,timer:2e3,showConfirmButton:!1}):alert(a)},showError(a){window.Toast?window.Toast.fire({icon:"error",title:a}):window.Swal?window.Swal.fire({icon:"error",title:a}):alert(a)},async save(a=null){var t,i,f;if(this.cartItems.length===0){this.showError("Please add at least one product");return}if(this.$refs.formRef){const{valid:e}=await this.$refs.formRef.validate();if(!e){this.showError("Please fill in all required fields");return}}if(!this.form.customer_id){this.showError("Please select a customer");return}if(!this.form.warehouse_id){this.showError("Please select a warehouse");return}if(!this.form.invoice_date){this.showError("Please select an invoice date");return}this.saving=!0;try{const e=this.cartItems.reduce((g,D)=>g+(D.discount||0),0),o=this.cartItems.reduce((g,D)=>g+(D.tax||0),0),u={customer_id:Number(this.form.customer_id),warehouse_id:Number(this.form.warehouse_id),invoice_date:this.form.invoice_date,due_date:this.form.due_date||null,paid_amount:parseFloat(this.form.paid_amount)||0,shipping_cost:parseFloat(this.form.shipping_cost)||0,notes:this.form.notes||"",payment_method:this.paymentMethod||"cash",items:this.cartItems.map(g=>({product_id:Number(g.product_id),quantity:parseInt(g.quantity,10),unit_price:parseFloat(g.unit_price),discount:parseFloat(g.discount)||0,tax:parseFloat(g.tax)||0,notes:g.notes||""}))},v=parseFloat(this.form.discount_amount)||0;(v>0||this.discountAmountManuallySet||v===0&&e===0)&&(u.discount_amount=v);const y=parseFloat(this.form.tax_amount)||0;(y>0||this.taxAmountManuallySet||y===0&&o===0)&&(u.tax_amount=y),a&&typeof a=="string"&&(u.status=String(a)),console.log("Saving sale with payload:",JSON.stringify(u,null,2));let r;this.isEdit?(r=await I.put(`/api/v1/sales/${this.form.id}`,u),this.showSuccess(a==="draft"?"Sale draft updated successfully":"Sale updated successfully")):(r=await I.post("/api/v1/sales",u),this.showSuccess(a==="draft"?"Sale saved as draft successfully":"Sale created successfully")),console.log("Sale saved successfully:",r.data),this.$emit("saved"),this.close()}catch(e){console.error("Failed to save sale:",e),console.error("Error response:",(t=e.response)==null?void 0:t.data),console.error("Error status:",(i=e.response)==null?void 0:i.status);let o="Failed to save sale. Please check the console for details.";(f=e.response)!=null&&f.data?e.response.data.message?o=e.response.data.message:e.response.data.error?o=e.response.data.error:e.response.data.errors&&(o=Object.values(e.response.data.errors).flat().join(", ")):e.message&&(o=e.message),this.showError(o)}finally{this.saving=!1}},async saveAsDraft(){await this.save("draft")},close(){this.$emit("update:modelValue",!1),this.form=this.getEmptyForm(),this.cartItems=[],this.searchResults=[],this.discountAmountManuallySet=!1,this.taxAmountManuallySet=!1}}},st={class:"d-flex align-center gap-2"},ot={class:"text-h6 text-white font-weight-medium"},lt={key:0,class:"mt-3"},it={class:"text-caption text-grey mb-2"},nt={class:"d-flex flex-wrap gap-2"},rt={class:"ml-1 text-caption"},dt={key:1,class:"search-results-container"},ct={class:"text-body-2 font-weight-medium"},ut={class:"text-body-2"},mt={class:"pa-1"},pt={class:"pa-1"},ht={class:"pa-1"},ft={class:"pa-1"},_t={class:"text-body-2 font-weight-bold text-end"},vt={class:"text-center"},gt={class:"mb-2"},xt={class:"mb-2"},yt={class:"totals-section"},bt={class:"d-flex justify-space-between mb-1"},wt={class:"text-body-2 font-weight-medium"},Dt={key:0,class:"d-flex justify-space-between mb-1"},St={class:"text-body-2 text-error"},Ft={class:"d-flex justify-space-between mb-1"},Vt={key:1,class:"d-flex justify-space-between mb-1"},kt={class:"text-body-2"},Tt={class:"d-flex justify-space-between mb-1"},It={key:2,class:"d-flex justify-space-between mb-1"},Ct={class:"text-body-2 font-weight-medium"},Mt={class:"d-flex justify-space-between mb-2"},Pt={class:"d-flex justify-space-between mb-2 total-amount"},Ut={class:"text-h6 font-weight-bold text-primary"},zt={class:"mb-2"},At={class:"mb-2"},Et={key:3,class:"mb-2"};function qt(a,t,i,f,e,o){const u=c("v-icon"),v=c("v-btn"),y=c("v-card-title"),r=c("v-text-field"),g=c("v-chip"),D=c("v-img"),F=c("v-avatar"),k=c("v-list-item-title"),M=c("v-list-item-subtitle"),P=c("v-list-item"),z=c("v-list"),A=c("v-card-text"),U=c("v-card"),E=c("v-divider"),w=c("v-table"),p=c("v-alert"),S=c("v-col"),V=c("v-autocomplete"),N=c("v-select"),j=c("DatePickerVuetifyInput"),R=c("v-row"),H=c("v-textarea"),Q=c("v-form"),G=c("v-card-actions"),X=c("v-dialog");return h(),C(X,{"model-value":i.modelValue,"onUpdate:modelValue":t[16]||(t[16]=m=>a.$emit("update:modelValue",m)),"max-width":"1400px",persistent:"",scrollable:""},{default:n(()=>[l(U,{class:"pos-dialog"},{default:n(()=>[l(y,{class:"pos-header d-flex justify-space-between align-center pa-3"},{default:n(()=>[s("div",st,[l(u,{color:"white"},{default:n(()=>t[17]||(t[17]=[x("mdi-point-of-sale")])),_:1,__:[17]}),s("span",ot,d(o.isEdit?"Edit Sale":"New Sale - POS"),1)]),l(v,{icon:"mdi-close",variant:"text",color:"white",size:"small",onClick:o.close},null,8,["onClick"])]),_:1}),l(A,{class:"pa-3"},{default:n(()=>[l(Q,{ref:"formRef",modelValue:e.formValid,"onUpdate:modelValue":t[15]||(t[15]=m=>e.formValid=m)},{default:n(()=>[l(R,{dense:"",class:"ma-0"},{default:n(()=>[l(S,{cols:"12",lg:"8",class:"pa-2"},{default:n(()=>[l(U,{variant:"flat",class:"mb-3 search-card",elevation:"1"},{default:n(()=>[l(A,{class:"pa-3"},{default:n(()=>[l(r,{modelValue:e.productSearch,"onUpdate:modelValue":t[0]||(t[0]=m=>e.productSearch=m),label:"Search Product (Name/SKU/Barcode)","prepend-inner-icon":"mdi-magnify",clearable:"",autofocus:"",variant:"outlined","hide-details":"",onKeyup:Z(o.searchProducts,["enter"]),"onClick:clear":t[1]||(t[1]=m=>e.searchResults=[])},null,8,["modelValue","onKeyup"]),e.mostSoldProducts.length>0&&e.searchResults.length===0?(h(),_("div",lt,[s("div",it,[l(u,{size:"14",class:"mr-1"},{default:n(()=>t[18]||(t[18]=[x("mdi-fire")])),_:1,__:[18]}),t[19]||(t[19]=x(" Most Sold Products "))]),s("div",nt,[(h(!0),_(O,null,B(e.mostSoldProducts,m=>(h(),C(g,{key:m.id,color:"primary",variant:"flat",size:"small",class:"product-chip",onClick:q=>o.addToCart(m),disabled:!m.stock_quantity||m.stock_quantity<=0},{default:n(()=>[l(u,{size:"14",class:"mr-1"},{default:n(()=>t[20]||(t[20]=[x("mdi-package-variant")])),_:1,__:[20]}),x(" "+d(m.name)+" ",1),s("span",rt,"(৳"+d(m.sale_price)+")",1)]),_:2},1032,["onClick","disabled"]))),128))])])):b("",!0),e.searchResults.length>0?(h(),_("div",dt,[l(z,{class:"search-results"},{default:n(()=>[(h(!0),_(O,null,B(e.searchResults,m=>(h(),C(P,{key:m.id,onClick:q=>o.addToCart(m),class:"search-item"},{prepend:n(()=>[l(F,{size:"40",color:"grey-lighten-4"},{default:n(()=>[m.image?(h(),C(D,{key:0,src:m.image},null,8,["src"])):(h(),C(u,{key:1},{default:n(()=>t[21]||(t[21]=[x("mdi-package-variant")])),_:1,__:[21]}))]),_:2},1024)]),append:n(()=>[l(g,{color:"primary",size:"small",variant:"flat"},{default:n(()=>[x("৳"+d(m.sale_price),1)]),_:2},1024)]),default:n(()=>[l(k,null,{default:n(()=>[x(d(m.name),1)]),_:2},1024),l(M,null,{default:n(()=>[x(" SKU: "+d(m.sku||"N/A")+" | Stock: "+d(m.stock_quantity||0),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})])):b("",!0)]),_:1})]),_:1}),l(U,{variant:"flat",class:"cart-card",elevation:"1"},{default:n(()=>[l(y,{class:"cart-header pa-2"},{default:n(()=>[l(u,{size:"18",class:"mr-1"},{default:n(()=>t[22]||(t[22]=[x("mdi-cart")])),_:1,__:[22]}),s("span",ct,"Cart Items ("+d(e.cartItems.length)+")",1)]),_:1}),l(E),l(A,{class:"pa-2"},{default:n(()=>[e.cartItems.length>0?(h(),C(w,{key:0,density:"compact",class:"cart-table"},{default:n(()=>[t[23]||(t[23]=s("thead",null,[s("tr",null,[s("th",{class:"text-caption"},"Product"),s("th",{class:"text-caption text-center",style:{width:"70px"}},"Qty"),s("th",{class:"text-caption text-end",style:{width:"90px"}},"Price"),s("th",{class:"text-caption text-end",style:{width:"80px"}},"Disc."),s("th",{class:"text-caption text-end",style:{width:"80px"}},"Tax"),s("th",{class:"text-caption text-end",style:{width:"100px"}},"Total"),s("th",{class:"text-caption",style:{width:"40px"}})])],-1)),s("tbody",null,[(h(!0),_(O,null,B(e.cartItems,(m,q)=>(h(),_("tr",{key:q,class:"cart-row"},[s("td",ut,d(m.product_name),1),s("td",mt,[l(r,{modelValue:m.quantity,"onUpdate:modelValue":[T=>m.quantity=T,T=>o.updateCartItem(q)],modelModifiers:{number:!0},type:"number",min:"1",density:"compact","hide-details":"",variant:"outlined",class:"cart-input"},null,8,["modelValue","onUpdate:modelValue"])]),s("td",pt,[l(r,{modelValue:m.unit_price,"onUpdate:modelValue":[T=>m.unit_price=T,T=>o.updateCartItem(q)],modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",density:"compact","hide-details":"",variant:"outlined",class:"cart-input"},null,8,["modelValue","onUpdate:modelValue"])]),s("td",ht,[l(r,{modelValue:m.discount,"onUpdate:modelValue":[T=>m.discount=T,T=>o.updateCartItem(q)],modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",density:"compact","hide-details":"",variant:"outlined",class:"cart-input"},null,8,["modelValue","onUpdate:modelValue"])]),s("td",ft,[l(r,{modelValue:m.tax,"onUpdate:modelValue":[T=>m.tax=T,T=>o.updateCartItem(q,!0)],modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",density:"compact","hide-details":"",variant:"outlined",class:"cart-input"},null,8,["modelValue","onUpdate:modelValue"])]),s("td",_t,"৳"+d(m.total.toFixed(2)),1),s("td",vt,[l(v,{icon:"mdi-delete",size:"x-small",variant:"text",color:"error",onClick:T=>o.removeFromCart(q)},null,8,["onClick"])])]))),128))])]),_:1,__:[23]})):(h(),C(p,{key:1,type:"info",variant:"tonal",density:"compact",class:"mt-2 mb-0"},{default:n(()=>t[24]||(t[24]=[s("span",{class:"text-caption"},"Cart is empty. Search and add products.",-1)])),_:1,__:[24]}))]),_:1})]),_:1})]),_:1}),l(S,{cols:"12",lg:"4",class:"pa-2"},{default:n(()=>[l(U,{variant:"flat",class:"details-card",elevation:"1"},{default:n(()=>[l(A,{class:"pa-2"},{default:n(()=>[s("div",gt,[l(V,{modelValue:e.form.customer_id,"onUpdate:modelValue":t[2]||(t[2]=m=>e.form.customer_id=m),items:e.customers,"item-value":"id","item-title":"name",label:"Customer *",clearable:"",density:"compact",variant:"outlined","hide-details":"",rules:[e.rules.required]},{"prepend-inner":n(()=>[l(u,{size:"18"},{default:n(()=>t[25]||(t[25]=[x("mdi-account")])),_:1,__:[25]})]),_:1},8,["modelValue","items","rules"])]),s("div",xt,[l(N,{modelValue:e.form.warehouse_id,"onUpdate:modelValue":t[3]||(t[3]=m=>e.form.warehouse_id=m),items:e.warehouses,"item-value":"id","item-title":"name",label:"Warehouse *",density:"compact",variant:"outlined","hide-details":"",rules:[e.rules.required]},{"prepend-inner":n(()=>[l(u,{size:"18"},{default:n(()=>t[26]||(t[26]=[x("mdi-warehouse")])),_:1,__:[26]})]),_:1},8,["modelValue","items","rules"])]),l(R,{dense:"",class:"ma-0 mb-2"},{default:n(()=>[l(S,{cols:"6",class:"pa-1"},{default:n(()=>[l(j,{fieldLabel:"Invoice Date",required:"true",variant:"outlined",initialDate:e.form.invoice_date,onTrigerInputValue:t[4]||(t[4]=m=>{e.form.invoice_date=m})},null,8,["initialDate"])]),_:1}),l(S,{cols:"6",class:"pa-1"},{default:n(()=>[l(j,{fieldLabel:"Due Date",variant:"outlined",initialDate:e.form.due_date,onTrigerInputValue:t[5]||(t[5]=m=>{e.form.due_date=m})},null,8,["initialDate"])]),_:1})]),_:1}),l(E,{class:"my-2"}),s("div",yt,[s("div",bt,[t[27]||(t[27]=s("span",{class:"text-caption text-grey"},"Subtotal:",-1)),s("span",wt,"৳"+d(e.form.subtotal.toFixed(2)),1)]),o.calculatedItemsDiscount>0?(h(),_("div",Dt,[t[28]||(t[28]=s("span",{class:"text-caption text-grey"},"Item Discounts:",-1)),s("span",St,"-৳"+d(o.calculatedItemsDiscount.toFixed(2)),1)])):b("",!0),s("div",Ft,[t[29]||(t[29]=s("span",{class:"text-caption text-grey"},"Order Discount:",-1)),l(r,{modelValue:e.form.discount_amount,"onUpdate:modelValue":[t[6]||(t[6]=m=>e.form.discount_amount=m),t[7]||(t[7]=()=>{e.discountAmountManuallySet=!0,o.calculateTotals()})],modelModifiers:{number:!0},type:"number",density:"compact",variant:"outlined","hide-details":"",min:"0",step:"0.01",class:"compact-input"},null,8,["modelValue"])]),o.calculatedItemsTax>0?(h(),_("div",Vt,[t[30]||(t[30]=s("span",{class:"text-caption text-grey"},"Item Tax:",-1)),s("span",kt,"৳"+d(o.calculatedItemsTax.toFixed(2)),1)])):b("",!0),s("div",Tt,[t[31]||(t[31]=s("span",{class:"text-caption text-grey"},"Order Tax:",-1)),l(r,{modelValue:e.form.tax_amount,"onUpdate:modelValue":[t[8]||(t[8]=m=>e.form.tax_amount=m),t[9]||(t[9]=()=>{e.taxAmountManuallySet=!0,o.calculateTotals()})],modelModifiers:{number:!0},type:"number",density:"compact",variant:"outlined","hide-details":"",min:"0",step:"0.01",class:"compact-input"},null,8,["modelValue"])]),o.calculatedTotalTax>0?(h(),_("div",It,[t[32]||(t[32]=s("span",{class:"text-caption text-grey font-weight-medium"},"Total Tax:",-1)),s("span",Ct,"৳"+d(o.calculatedTotalTax.toFixed(2)),1)])):b("",!0),s("div",Mt,[t[33]||(t[33]=s("span",{class:"text-caption text-grey"},"Shipping:",-1)),l(r,{modelValue:e.form.shipping_cost,"onUpdate:modelValue":[t[10]||(t[10]=m=>e.form.shipping_cost=m),o.calculateTotals],modelModifiers:{number:!0},type:"number",density:"compact",variant:"outlined","hide-details":"",min:"0",step:"0.01",class:"compact-input"},null,8,["modelValue","onUpdate:modelValue"])]),l(E,{class:"my-2"}),s("div",Pt,[t[34]||(t[34]=s("span",{class:"text-body-1 font-weight-bold"},"Total:",-1)),s("span",Ut,"৳"+d(e.form.total_amount.toFixed(2)),1)]),s("div",zt,[l(r,{modelValue:e.form.paid_amount,"onUpdate:modelValue":[t[11]||(t[11]=m=>e.form.paid_amount=m),o.calculateBalance],modelModifiers:{number:!0},type:"number",label:"Paid Amount",density:"compact",variant:"outlined",min:"0",step:"0.01","prepend-inner-icon":"mdi-cash"},null,8,["modelValue","onUpdate:modelValue"])]),s("div",At,[l(r,{modelValue:e.form.balance_amount,"onUpdate:modelValue":t[12]||(t[12]=m=>e.form.balance_amount=m),modelModifiers:{number:!0},label:"Balance (Due)",density:"compact",variant:"outlined",readonly:"",color:e.form.balance_amount>0?"error":"success",class:W(e.form.balance_amount>0?"text-error":"text-success")},null,8,["modelValue","color","class"])]),e.form.paid_amount>0?(h(),_("div",Et,[l(N,{modelValue:e.paymentMethod,"onUpdate:modelValue":t[13]||(t[13]=m=>e.paymentMethod=m),items:e.paymentMethods,label:"Payment Method",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue","items"])])):b("",!0)]),l(E,{class:"my-2"}),l(H,{modelValue:e.form.notes,"onUpdate:modelValue":t[14]||(t[14]=m=>e.form.notes=m),label:"Notes",rows:"2",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(E),l(G,{class:"pa-2 justify-end"},{default:n(()=>[l(v,{variant:"text",size:"small",onClick:o.close},{default:n(()=>t[35]||(t[35]=[x("Cancel")])),_:1,__:[35]},8,["onClick"]),o.isEdit?b("",!0):(h(),C(v,{key:0,color:"grey",size:"small",loading:e.saving,disabled:e.cartItems.length===0,onClick:o.saveAsDraft},{default:n(()=>[l(u,{size:"18",class:"mr-1"},{default:n(()=>t[36]||(t[36]=[x("mdi-content-save-outline")])),_:1,__:[36]}),t[37]||(t[37]=x(" Save as Draft "))]),_:1,__:[37]},8,["loading","disabled","onClick"])),l(v,{color:"success",size:"small",loading:e.saving,disabled:e.cartItems.length===0,onClick:o.save},{default:n(()=>[l(u,{size:"18",class:"mr-1"},{default:n(()=>t[38]||(t[38]=[x("mdi-content-save")])),_:1,__:[38]}),x(" "+d(o.isEdit?"Update":"Save Sale"),1)]),_:1},8,["loading","disabled","onClick"])]),_:1})]),_:1})]),_:1},8,["model-value"])}const Nt=Y(at,[["render",qt],["__scopeId","data-v-76236648"]]);function Ot(a){if(!a)return"";try{const t=new Date(a);if(isNaN(t.getTime()))return"";const i=String(t.getDate()).padStart(2,"0"),e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()],o=t.getFullYear();return`${i}/${e}/${o}`}catch{return a}}function Bt(a){if(!a)return"";try{if(typeof a=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(a)){const[o,u,v]=a.split("-");return`${v}/${u}/${o}`}const t=new Date(a);if(isNaN(t.getTime()))return"";const i=String(t.getDate()).padStart(2,"0"),f=String(t.getMonth()+1).padStart(2,"0"),e=t.getFullYear();return`${i}/${f}/${e}`}catch{return a}}const J={async printInvoice(a,t){var i,f,e,o,u,v;try{const{data:y}=await I.get(`/api/v1/sales/${a.id}`),r=y.data||y.sale||y;if(!r){t&&t("Sale data not found");return}const g=window.open("","_blank","width=800,height=600");if(!g){t&&t("Please allow popups to print invoice");return}const D=(r.items||[]).reduce((p,S)=>p+parseFloat(S.discount||0),0),F=(r.items||[]).reduce((p,S)=>p+parseFloat(S.tax||0),0),k=F+parseFloat(r.tax_amount||0),M=parseFloat(r.subtotal||0),P=parseFloat(r.discount_amount||0),z=parseFloat(r.shipping_cost||0),A=M-P+k+z,U=p=>p?new Date(p).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):"",w=`<!DOCTYPE html>
<html>
<head>
    <title>Invoice #${r.invoice_number}</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; padding: 20px; color: #000; }
        .invoice-container { max-width: 800px; margin: 0 auto; background: white; }
        .invoice-header { background: #1976d2; color: white; padding: 20px; text-align: center; }
        .invoice-header h1 { font-size: 24px; margin-bottom: 5px; }
        .invoice-header .invoice-number { font-size: 14px; opacity: 0.9; }
        .invoice-section { padding: 20px; border-bottom: 1px solid #ddd; }
        .invoice-row { display: flex; margin-bottom: 20px; }
        .invoice-col { flex: 1; }
        .invoice-col h3 { font-size: 14px; margin-bottom: 10px; color: #666; }
        .invoice-col p { margin: 3px 0; font-size: 13px; }
        .invoice-meta { display: flex; gap: 30px; margin-top: 15px; }
        .invoice-meta-item { flex: 1; }
        .invoice-meta-item label { font-size: 12px; color: #666; display: block; }
        .invoice-meta-item span { font-size: 14px; font-weight: bold; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th { background: #f5f5f5; padding: 10px; text-align: left; border: 1px solid #ddd; font-size: 12px; font-weight: bold; }
        td { padding: 10px; border: 1px solid #ddd; font-size: 12px; }
        .text-right { text-align: right; }
        .text-center { text-align: center; }
        .totals-box { background: #f9f9f9; padding: 15px; border: 2px solid #1976d2; margin-top: 20px; }
        .totals-row { display: flex; justify-content: space-between; padding: 5px 0; }
        .totals-row.total { border-top: 2px solid #1976d2; border-bottom: 2px solid #1976d2; padding: 10px 0; margin: 10px 0; background: rgba(25, 118, 210, 0.05); font-weight: bold; }
        .totals-row.balance { border-top: 1px dashed #999; padding-top: 10px; margin-top: 10px; font-weight: bold; }
        .invoice-footer { text-align: center; padding: 20px; color: #666; font-size: 12px; }
        .status-badge { display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: bold; text-transform: uppercase; }
        .status-draft { background: #9e9e9e; color: white; }
        .status-pending { background: #ff9800; color: white; }
        .status-partial { background: #2196f3; color: white; }
        .status-paid { background: #4caf50; color: white; }
        .status-cancelled { background: #f44336; color: white; }
        @media print {
            body { padding: 0; }
            .invoice-container { box-shadow: none; }
            @page { margin: 1.5cm; size: A4; }
        }
    </style>
</head>
<body>
    <div class="invoice-container">
        <div class="invoice-header">
            <h1>INVOICE</h1>
            <div class="invoice-number">#${r.invoice_number}</div>
        </div>

        <div class="invoice-section">
            <div class="invoice-row">
                <div class="invoice-col">
                    <h3>From</h3>
                    <p><strong>Your Company Name</strong></p>
                    <p>Company Address, City, State</p>
                    <p>Phone: +1234567890 | Email: info@company.com</p>
                </div>
                <div class="invoice-col">
                    <h3>Bill To</h3>
                    <p><strong>${((i=r.customer)==null?void 0:i.name)||"Walk-in Customer"}</strong></p>
                    ${(f=r.customer)!=null&&f.phone?`<p>Phone: ${r.customer.phone}</p>`:""}
                    ${(e=r.customer)!=null&&e.email?`<p>Email: ${r.customer.email}</p>`:""}
                    ${(o=r.customer)!=null&&o.address?`<p>${r.customer.address}</p>`:""}
                </div>
            </div>
            <div class="invoice-meta">
                <div class="invoice-meta-item">
                    <label>Invoice Date</label>
                    <span>${U(r.invoice_date)}</span>
                </div>
                ${r.due_date?`
                <div class="invoice-meta-item">
                    <label>Due Date</label>
                    <span>${U(r.due_date)}</span>
                </div>
                `:""}
                <div class="invoice-meta-item">
                    <label>Status</label>
                    <span class="status-badge status-${r.status||"pending"}">${(r.status||"pending").toUpperCase()}</span>
                </div>
            </div>
        </div>

        <div class="invoice-section">
            <h3 style="margin-bottom: 15px;">Items</h3>
            <table>
                <thead>
                    <tr>
                        <th style="width: 30px;">#</th>
                        <th>Product</th>
                        <th class="text-center" style="width: 60px;">Qty</th>
                        <th class="text-right" style="width: 90px;">Price</th>
                        <th class="text-right" style="width: 80px;">Disc.</th>
                        <th class="text-right" style="width: 80px;">Tax</th>
                        <th class="text-right" style="width: 100px;">Total</th>
                    </tr>
                </thead>
                <tbody>
                    ${(r.items||[]).map((p,S)=>{var V,N;return`
                    <tr>
                        <td>${S+1}</td>
                        <td>
                            <strong>${((V=p.product)==null?void 0:V.name)||"Unknown"}</strong>
                            ${(N=p.product)!=null&&N.sku?`<br><small style="color: #666;">SKU: ${p.product.sku}</small>`:""}
                        </td>
                        <td class="text-center">${p.quantity}</td>
                        <td class="text-right">৳${parseFloat(p.unit_price||0).toFixed(2)}</td>
                        <td class="text-right" style="color: #f44336;">-৳${parseFloat(p.discount||0).toFixed(2)}</td>
                        <td class="text-right">৳${parseFloat(p.tax||0).toFixed(2)}</td>
                        <td class="text-right"><strong>৳${parseFloat(p.total||0).toFixed(2)}</strong></td>
                    </tr>
                    `}).join("")}
                </tbody>
            </table>
        </div>

        <div class="invoice-section">
            <div class="invoice-row">
                <div class="invoice-col">
                    ${r.notes?`
                    <div style="background: #f9f9f9; padding: 10px; border-radius: 4px; margin-bottom: 15px;">
                        <h3 style="margin-bottom: 5px; font-size: 13px;">Notes</h3>
                        <p style="font-size: 12px;">${r.notes}</p>
                    </div>
                    `:""}
                    ${r.warehouse?`
                    <div style="background: #f9f9f9; padding: 10px; border-radius: 4px;">
                        <h3 style="margin-bottom: 5px; font-size: 13px;">Warehouse</h3>
                        <p style="font-size: 12px;">${r.warehouse.name}</p>
                    </div>
                    `:""}
                </div>
                <div class="invoice-col">
                    <div class="totals-box">
                        <div class="totals-row">
                            <span>Subtotal:</span>
                            <span>৳${M.toFixed(2)}</span>
                        </div>
                        ${D>0?`
                        <div class="totals-row">
                            <span>Item Discounts:</span>
                            <span style="color: #f44336;">-৳${D.toFixed(2)}</span>
                        </div>
                        `:""}
                        ${P>0?`
                        <div class="totals-row">
                            <span>Order Discount:</span>
                            <span style="color: #f44336;">-৳${P.toFixed(2)}</span>
                        </div>
                        `:""}
                        ${F>0?`
                        <div class="totals-row">
                            <span>Item Tax:</span>
                            <span>৳${F.toFixed(2)}</span>
                        </div>
                        `:""}
                        ${r.tax_amount>0?`
                        <div class="totals-row">
                            <span>Order Tax:</span>
                            <span>৳${parseFloat(r.tax_amount).toFixed(2)}</span>
                        </div>
                        `:""}
                        ${k>0?`
                        <div class="totals-row">
                            <span><strong>Total Tax:</strong></span>
                            <span><strong>৳${k.toFixed(2)}</strong></span>
                        </div>
                        `:""}
                        ${z>0?`
                        <div class="totals-row">
                            <span>Shipping:</span>
                            <span>৳${z.toFixed(2)}</span>
                        </div>
                        `:""}
                        <div class="totals-row total">
                            <span>Total:</span>
                            <span style="color: #1976d2;">৳${A.toFixed(2)}</span>
                        </div>
                        <div class="totals-row" style="color: #4caf50;">
                            <span><strong>Paid:</strong></span>
                            <span><strong>৳${parseFloat(r.paid_amount||0).toFixed(2)}</strong></span>
                        </div>
                        <div class="totals-row balance" style="color: ${r.balance_amount>0?"#f44336":"#4caf50"};">
                            <span><strong>Balance:</strong></span>
                            <span><strong>৳${parseFloat(r.balance_amount||0).toFixed(2)}</strong></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="invoice-footer">
            <p>Thank you for your business!</p>
        </div>
    </div>
    <script>
        window.onload = function() {
            window.print();
            window.onafterprint = function() {
                window.close();
            };
        };
    <\/script>
`+`</body>
</html>`;g.document.write(w),g.document.close()}catch(y){console.error("Failed to print invoice",y),t&&t(((v=(u=y.response)==null?void 0:u.data)==null?void 0:v.message)||"Failed to print invoice")}}},Yt={name:"ViewSaleDialog",props:{modelValue:{type:Boolean,required:!0},sale:{type:Object,default:null}},emits:["update:modelValue"],data(){return{saleData:null,loading:!1,currentSaleId:null}},watch:{modelValue:{immediate:!0,handler(a){a&&this.sale&&this.sale.id?this.currentSaleId!==this.sale.id&&this.loadSaleDetails(this.sale.id):a||(this.saleData=null,this.currentSaleId=null)}},sale:{immediate:!0,handler(a){a&&a.id&&this.modelValue&&this.currentSaleId!==a.id&&this.loadSaleDetails(a.id)}}},computed:{calculatedItemsDiscount(){return!this.saleData||!this.saleData.items?0:this.saleData.items.reduce((a,t)=>a+parseFloat(t.discount||0),0)},calculatedItemsTax(){return!this.saleData||!this.saleData.items?0:this.saleData.items.reduce((a,t)=>a+parseFloat(t.tax||0),0)},calculatedTotalTax(){var i;const a=this.calculatedItemsTax,t=parseFloat(((i=this.saleData)==null?void 0:i.tax_amount)||0);return a+t},calculatedTotalAmount(){if(!this.saleData)return 0;const a=parseFloat(this.saleData.subtotal||0),t=parseFloat(this.saleData.discount_amount||0),i=parseFloat(this.saleData.shipping_cost||0),f=this.calculatedTotalTax,e=a-t+f+i;return parseFloat(e.toFixed(2))}},methods:{async loadSaleDetails(a){var t,i,f;if(!a){console.error("No sale ID provided");return}if(!(this.currentSaleId===a&&this.saleData)){this.currentSaleId=a,this.loading=!0,this.saleData=null;try{const{data:e}=await I.get(`/api/v1/sales/${a}`);this.saleData=e.data||e.sale||e,this.saleData||(this.showError("Sale data not found"),this.currentSaleId=null)}catch(e){console.error("Failed to load sale details:",e),console.error("Error response:",(t=e.response)==null?void 0:t.data),this.showError(((f=(i=e.response)==null?void 0:i.data)==null?void 0:f.message)||"Failed to load sale details"),this.currentSaleId=null}finally{this.loading=!1}}},formatDate:Ot,getStatusColor(a){return{draft:"grey",pending:"warning",partial:"info",paid:"success",cancelled:"error"}[a]||"grey"},printInvoice(){if(!this.sale||!this.sale.id){this.showError("Sale information not available");return}J.printInvoice(this.sale,a=>{this.showError(a)})},close(){this.$emit("update:modelValue",!1),this.saleData=null,this.currentSaleId=null},showError(a){window.Toast?window.Toast.fire({icon:"error",title:a}):window.Swal?window.Swal.fire({icon:"error",title:a}):alert(a)}}},jt={class:"d-flex align-center gap-2"},Rt={key:0,class:"text-caption text-white text-opacity-90"},Lt={key:0,class:"text-center py-8"},Wt={key:1,class:"text-center py-8"},Kt={key:2,class:"invoice-content"},Jt={class:"invoice-header-section pa-3"},Ht={class:"invoice-customer-info"},Qt={class:"text-body-2 font-weight-medium mb-0"},Gt={key:0,class:"text-caption text-grey"},Xt={key:1,class:"text-caption text-grey"},Zt={key:2,class:"text-caption text-grey"},$t={class:"invoice-meta-item"},te={class:"text-body-2 font-weight-medium"},ee={class:"invoice-meta-item"},ae={class:"text-body-2 font-weight-medium"},se={class:"invoice-meta-item"},oe={class:"invoice-items-section pa-3"},le={key:0},ie={class:"text-grey text-caption"},ne={class:"text-body-2 font-weight-medium"},re={key:0,class:"text-caption text-grey"},de={class:"text-center text-body-2"},ce={class:"text-right text-body-2"},ue={class:"text-right text-body-2 text-error"},me={class:"text-right text-body-2"},pe={class:"text-right text-body-2 font-weight-bold"},he={class:"invoice-totals-section pa-3"},fe={key:0,class:"invoice-notes"},_e={class:"text-body-2 text-caption"},ve={key:1,class:"invoice-warehouse mt-2"},ge={class:"text-body-2 text-caption"},xe={class:"invoice-totals-box"},ye={class:"invoice-totals-row"},be={class:"invoice-totals-value text-body-2"},we={key:0,class:"invoice-totals-row"},De={class:"invoice-totals-value text-body-2 text-error"},Se={key:1,class:"invoice-totals-row"},Fe={class:"invoice-totals-value text-body-2 text-error"},Ve={key:2,class:"invoice-totals-row"},ke={class:"invoice-totals-value text-body-2"},Te={key:3,class:"invoice-totals-row"},Ie={class:"invoice-totals-value text-body-2"},Ce={key:4,class:"invoice-totals-row invoice-totals-highlight"},Me={class:"invoice-totals-value text-body-2 font-weight-medium"},Pe={key:5,class:"invoice-totals-row"},Ue={class:"invoice-totals-value text-body-2"},ze={class:"invoice-totals-row invoice-totals-total"},Ae={class:"invoice-totals-value text-subtitle-1 font-weight-bold text-primary"},Ee={class:"invoice-totals-row invoice-totals-paid"},qe={class:"invoice-totals-value text-body-2 font-weight-medium text-success"},Ne={class:"invoice-totals-value text-body-2 font-weight-bold"};function Oe(a,t,i,f,e,o){const u=c("v-icon"),v=c("v-btn"),y=c("v-card-title"),r=c("v-progress-circular"),g=c("v-alert"),D=c("v-col"),F=c("v-row"),k=c("v-chip"),M=c("v-table"),P=c("v-divider"),z=c("v-card-text"),A=c("v-card-actions"),U=c("v-card"),E=c("v-dialog");return h(),C(E,{"model-value":i.modelValue,"onUpdate:modelValue":t[0]||(t[0]=w=>a.$emit("update:modelValue",w)),"max-width":"900px",persistent:"",scrollable:""},{default:n(()=>[l(U,{class:"invoice-card"},{default:n(()=>[l(y,{class:"invoice-header d-flex justify-space-between align-center pa-3"},{default:n(()=>[s("div",jt,[l(u,{color:"white",size:"24"},{default:n(()=>t[1]||(t[1]=[x("mdi-file-document-outline")])),_:1,__:[1]}),s("div",null,[t[2]||(t[2]=s("div",{class:"text-h6 text-white font-weight-bold"},"INVOICE",-1)),e.saleData?(h(),_("div",Rt," #"+d(e.saleData.invoice_number),1)):b("",!0)])]),l(v,{icon:"mdi-close",variant:"text",color:"white",size:"small",onClick:o.close},null,8,["onClick"])]),_:1}),l(z,{class:"pa-0"},{default:n(()=>[e.loading?(h(),_("div",Lt,[l(r,{indeterminate:"",color:"primary",size:"48"}),t[3]||(t[3]=s("div",{class:"mt-3 text-body-2"},"Loading invoice details...",-1))])):e.saleData?(h(),_("div",Kt,[s("div",Jt,[l(F,{dense:""},{default:n(()=>[l(D,{cols:"12",md:"6"},{default:n(()=>t[5]||(t[5]=[s("div",{class:"invoice-company-info"},[s("div",{class:"text-subtitle-2 font-weight-bold mb-1"},"From"),s("div",{class:"text-body-2 font-weight-medium mb-0"},"Your Company Name"),s("div",{class:"text-caption text-grey"},"Company Address, City, State"),s("div",{class:"text-caption text-grey"},"Phone: +1234567890 | Email: info@company.com ")],-1)])),_:1,__:[5]}),l(D,{cols:"12",md:"6"},{default:n(()=>{var w,p,S,V;return[s("div",Ht,[t[6]||(t[6]=s("div",{class:"text-subtitle-2 font-weight-bold mb-1"},"Bill To",-1)),s("div",Qt,d(((w=e.saleData.customer)==null?void 0:w.name)||"Walk-in Customer"),1),(p=e.saleData.customer)!=null&&p.phone?(h(),_("div",Gt," Phone: "+d(e.saleData.customer.phone),1)):b("",!0),(S=e.saleData.customer)!=null&&S.email?(h(),_("div",Xt," Email: "+d(e.saleData.customer.email),1)):b("",!0),(V=e.saleData.customer)!=null&&V.address?(h(),_("div",Zt,d(e.saleData.customer.address),1)):b("",!0)])]}),_:1})]),_:1}),l(F,{dense:"",class:"mt-2"},{default:n(()=>[l(D,{cols:"12",md:"4"},{default:n(()=>[s("div",$t,[t[7]||(t[7]=s("div",{class:"text-caption text-grey mb-0"},"Invoice Date",-1)),s("div",te,d(o.formatDate(e.saleData.invoice_date)),1)])]),_:1}),e.saleData.due_date?(h(),C(D,{key:0,cols:"12",md:"4"},{default:n(()=>[s("div",ee,[t[8]||(t[8]=s("div",{class:"text-caption text-grey mb-0"},"Due Date",-1)),s("div",ae,d(o.formatDate(e.saleData.due_date)),1)])]),_:1})):b("",!0),l(D,{cols:"12",md:"4"},{default:n(()=>[s("div",se,[t[9]||(t[9]=s("div",{class:"text-caption text-grey mb-0"},"Status",-1)),l(k,{color:o.getStatusColor(e.saleData.status),size:"x-small",variant:"flat",class:"font-weight-medium"},{default:n(()=>{var w;return[x(d(((w=e.saleData.status)==null?void 0:w.toUpperCase())||"PENDING"),1)]}),_:1},8,["color"])])]),_:1})]),_:1})]),s("div",oe,[t[12]||(t[12]=s("div",{class:"text-subtitle-1 font-weight-bold mb-2"},"Items",-1)),l(M,{class:"invoice-table",density:"compact"},{default:n(()=>[t[11]||(t[11]=s("thead",null,[s("tr",{class:"invoice-table-header"},[s("th",{class:"text-left",style:{width:"30px"}},"#"),s("th",{class:"text-left"},"Product"),s("th",{class:"text-center",style:{width:"60px"}},"Qty"),s("th",{class:"text-right",style:{width:"90px"}},"Price"),s("th",{class:"text-right",style:{width:"80px"}},"Disc."),s("th",{class:"text-right",style:{width:"80px"}},"Tax"),s("th",{class:"text-right",style:{width:"100px"}},"Total")])],-1)),s("tbody",null,[!e.saleData.items||e.saleData.items.length===0?(h(),_("tr",le,t[10]||(t[10]=[s("td",{colspan:"7",class:"text-center py-4 text-grey"},"No items found",-1)]))):b("",!0),(h(!0),_(O,null,B(e.saleData.items||[],(w,p)=>{var S,V;return h(),_("tr",{key:w.id||w.product_id,class:"invoice-table-row"},[s("td",ie,d(p+1),1),s("td",null,[s("div",ne,d(((S=w.product)==null?void 0:S.name)||"Unknown"),1),(V=w.product)!=null&&V.sku?(h(),_("div",re,"SKU: "+d(w.product.sku),1)):b("",!0)]),s("td",de,d(w.quantity),1),s("td",ce,"৳"+d(parseFloat(w.unit_price||0).toFixed(2)),1),s("td",ue,"-৳"+d(parseFloat(w.discount||0).toFixed(2)),1),s("td",me,"৳"+d(parseFloat(w.tax||0).toFixed(2)),1),s("td",pe,"৳"+d(parseFloat(w.total||0).toFixed(2)),1)])}),128))])]),_:1,__:[11]})]),s("div",he,[l(F,{dense:""},{default:n(()=>[l(D,{cols:"12",md:"7"},{default:n(()=>[e.saleData.notes?(h(),_("div",fe,[t[13]||(t[13]=s("div",{class:"text-subtitle-2 font-weight-bold mb-1"},"Notes",-1)),s("div",_e,d(e.saleData.notes),1)])):b("",!0),e.saleData.warehouse?(h(),_("div",ve,[t[14]||(t[14]=s("div",{class:"text-subtitle-2 font-weight-bold mb-1"},"Warehouse",-1)),s("div",ge,d(e.saleData.warehouse.name),1)])):b("",!0)]),_:1}),l(D,{cols:"12",md:"5"},{default:n(()=>[s("div",xe,[s("div",ye,[t[15]||(t[15]=s("span",{class:"invoice-totals-label text-caption"},"Subtotal:",-1)),s("span",be,"৳"+d(parseFloat(e.saleData.subtotal||0).toFixed(2)),1)]),o.calculatedItemsDiscount>0?(h(),_("div",we,[t[16]||(t[16]=s("span",{class:"invoice-totals-label text-caption"},"Item Discounts:",-1)),s("span",De,"-৳"+d(o.calculatedItemsDiscount.toFixed(2)),1)])):b("",!0),e.saleData.discount_amount>0?(h(),_("div",Se,[t[17]||(t[17]=s("span",{class:"invoice-totals-label text-caption"},"Order Discount:",-1)),s("span",Fe,"-৳"+d(parseFloat(e.saleData.discount_amount).toFixed(2)),1)])):b("",!0),o.calculatedItemsTax>0?(h(),_("div",Ve,[t[18]||(t[18]=s("span",{class:"invoice-totals-label text-caption"},"Item Tax:",-1)),s("span",ke,"৳"+d(o.calculatedItemsTax.toFixed(2)),1)])):b("",!0),e.saleData.tax_amount>0?(h(),_("div",Te,[t[19]||(t[19]=s("span",{class:"invoice-totals-label text-caption"},"Order Tax:",-1)),s("span",Ie,"৳"+d(parseFloat(e.saleData.tax_amount).toFixed(2)),1)])):b("",!0),o.calculatedTotalTax>0?(h(),_("div",Ce,[t[20]||(t[20]=s("span",{class:"invoice-totals-label text-body-2 font-weight-medium"},"Total Tax:",-1)),s("span",Me,"৳"+d(o.calculatedTotalTax.toFixed(2)),1)])):b("",!0),e.saleData.shipping_cost>0?(h(),_("div",Pe,[t[21]||(t[21]=s("span",{class:"invoice-totals-label text-caption"},"Shipping:",-1)),s("span",Ue,"৳"+d(parseFloat(e.saleData.shipping_cost).toFixed(2)),1)])):b("",!0),l(P,{class:"my-2"}),s("div",ze,[t[22]||(t[22]=s("span",{class:"invoice-totals-label text-subtitle-1 font-weight-bold"},"Total:",-1)),s("span",Ae,"৳"+d(o.calculatedTotalAmount.toFixed(2)),1)]),s("div",Ee,[t[23]||(t[23]=s("span",{class:"invoice-totals-label text-body-2 font-weight-medium text-success"},"Paid:",-1)),s("span",qe,"৳"+d(parseFloat(e.saleData.paid_amount||0).toFixed(2)),1)]),s("div",{class:W(["invoice-totals-row invoice-totals-balance",e.saleData.balance_amount>0?"text-error":"text-success"])},[t[24]||(t[24]=s("span",{class:"invoice-totals-label text-body-2 font-weight-bold"},"Balance:",-1)),s("span",Ne,"৳"+d(parseFloat(e.saleData.balance_amount||0).toFixed(2)),1)],2)])]),_:1})]),_:1})]),t[25]||(t[25]=s("div",{class:"invoice-footer pa-2 text-center"},[s("div",{class:"text-caption text-grey"}," Thank you for your business! ")],-1))])):(h(),_("div",Wt,[l(g,{type:"error",variant:"tonal",class:"ma-3",density:"compact"},{default:n(()=>t[4]||(t[4]=[x(" Failed to load invoice details ")])),_:1,__:[4]})]))]),_:1}),l(P),l(A,{class:"justify-end pa-2 bg-grey-lighten-5"},{default:n(()=>[l(v,{color:"primary","prepend-icon":"mdi-printer",variant:"flat",size:"small",onClick:o.printInvoice},{default:n(()=>t[26]||(t[26]=[x(" Print Invoice ")])),_:1,__:[26]},8,["onClick"]),l(v,{variant:"text",size:"small",onClick:o.close},{default:n(()=>t[27]||(t[27]=[x("Close")])),_:1,__:[27]},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["model-value"])}const Be=Y(Yt,[["render",Oe],["__scopeId","data-v-f08cefe8"]]),Ye={name:"DatePicker",props:{modelValue:{type:[String,Date],default:null},label:{type:String,default:"Date"},rules:{type:Array,default:()=>[]},required:{type:Boolean,default:!1},fieldClass:{type:String,default:""},density:{type:String,default:"default"},variant:{type:String,default:"outlined"}},emits:["update:modelValue"],data(){return{dateMenu:!1}},computed:{formattedDate(){if(!this.modelValue)return"";try{let a;if(typeof this.modelValue=="string")/^\d{4}-\d{2}-\d{2}$/.test(this.modelValue)?a=this.modelValue:this.modelValue.includes("T")?a=this.modelValue.split("T")[0]:a=this.modelValue;else{const e=this.modelValue.getFullYear(),o=String(this.modelValue.getMonth()+1).padStart(2,"0"),u=String(this.modelValue.getDate()).padStart(2,"0");a=`${e}-${o}-${u}`}const[t,i,f]=a.split("-").map(Number);return isNaN(t)||isNaN(i)||isNaN(f)?this.modelValue:`${String(f).padStart(2,"0")}/${String(i).padStart(2,"0")}/${t}`}catch{return this.modelValue}},datePickerValue(){if(!this.modelValue)return null;try{let a;if(typeof this.modelValue=="string"){if(/^\d{4}-\d{2}-\d{2}$/.test(this.modelValue))return this.modelValue;this.modelValue.includes("T")?a=this.modelValue.split("T")[0]:a=this.modelValue}else{const t=this.modelValue.getFullYear(),i=String(this.modelValue.getMonth()+1).padStart(2,"0"),f=String(this.modelValue.getDate()).padStart(2,"0");a=`${t}-${i}-${f}`}return/^\d{4}-\d{2}-\d{2}$/.test(a)?a:this.modelValue}catch{return this.modelValue}}},methods:{onDateSelected(a){if(a&&/^\d{4}-\d{2}-\d{2}$/.test(a))this.$emit("update:modelValue",String(a));else if(a)try{if(typeof a=="string"&&a.includes("T")){const t=a.split("T")[0];if(/^\d{4}-\d{2}-\d{2}$/.test(t))this.$emit("update:modelValue",t);else{const i=new Date(a),f=i.getFullYear(),e=String(i.getMonth()+1).padStart(2,"0"),o=String(i.getDate()).padStart(2,"0");this.$emit("update:modelValue",`${f}-${e}-${o}`)}}else{const t=new Date(a),i=t.getFullYear(),f=String(t.getMonth()+1).padStart(2,"0"),e=String(t.getDate()).padStart(2,"0");this.$emit("update:modelValue",`${i}-${f}-${e}`)}}catch{this.$emit("update:modelValue",a)}else this.$emit("update:modelValue",null);this.dateMenu=!1},clearDate(){this.$emit("update:modelValue",null)}}};function je(a,t,i,f,e,o){const u=c("v-text-field"),v=c("v-date-picker"),y=c("v-menu");return h(),C(y,{modelValue:e.dateMenu,"onUpdate:modelValue":t[1]||(t[1]=r=>e.dateMenu=r),"close-on-content-click":!1,location:"bottom",transition:"scale-transition"},{activator:n(({props:r})=>[l(u,L({"model-value":o.formattedDate,label:i.label,readonly:""},r,{rules:i.rules,required:i.required,class:i.fieldClass,"prepend-inner-icon":"mdi-calendar",density:i.density,variant:i.variant,clearable:"","onClick:clear":o.clearDate,"onUpdate:modelValue":t[0]||(t[0]=g=>a.$emit("update:modelValue",g))}),null,16,["model-value","label","rules","required","class","density","variant","onClick:clear"])]),default:n(()=>[l(v,{"model-value":o.datePickerValue,"onUpdate:modelValue":o.onDateSelected,color:"primary","show-adjacent-months":"","hide-header":""},null,8,["model-value","onUpdate:modelValue"])]),_:1},8,["modelValue"])}const Re=Y(Ye,[["render",je],["__scopeId","data-v-c69c332a"]]),Le={name:"AdminSales",mixins:[K],components:{SaleDialog:Nt,ViewSaleDialog:Be,DatePicker:Re},data(){return{sales:[],loading:!1,dialog:!1,viewDialog:!1,selectedSale:null,filters:{search:"",status:null,date_from:"",date_to:""},pagination:{current_page:1,per_page:15,last_page:1,total:0},perPageOptions:[{title:"10",value:10},{title:"15",value:15},{title:"25",value:25},{title:"50",value:50},{title:"100",value:100}],statusOptions:[{title:"Draft",value:"draft"},{title:"Pending",value:"pending"},{title:"Partial",value:"partial"},{title:"Paid",value:"paid"},{title:"Cancelled",value:"cancelled"}]}},mounted(){this.fetchSales()},methods:{async fetchSales(){this.loading=!0;try{const a={page:this.pagination.current_page,per_page:this.pagination.per_page,search:this.filters.search||"",status:this.filters.status||null};this.filters.date_from&&String(this.filters.date_from).trim()!==""&&(a.from_date=this.filters.date_from),this.filters.date_to&&String(this.filters.date_to).trim()!==""&&(a.to_date=this.filters.date_to);const{data:t}=await I.get("/api/v1/sales",{params:a});this.sales=t.data||t.sales||[],this.pagination={current_page:t.current_page||1,per_page:t.per_page||15,last_page:t.last_page||1,total:t.total||0}}catch(a){console.error("Failed to fetch sales",a),this.showError("Failed to load sales")}finally{this.loading=!1}},openDialog(){this.selectedSale=null,this.dialog=!0},editSale(a){this.selectedSale=a,this.dialog=!0},viewSale(a){this.selectedSale=a,this.viewDialog=!0},async confirmDelete(a){var i,f;if(this.selectedSale=a,(await window.Swal.fire({title:"Are you sure?",text:`Do you want to delete sale ${a.invoice_number}?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"})).isConfirmed)try{await I.delete(`/api/v1/sales/${a.id}`),this.showSuccess("Sale deleted successfully"),this.fetchSales()}catch(e){console.error("Failed to delete sale",e),this.showError(((f=(i=e.response)==null?void 0:i.data)==null?void 0:f.message)||"Failed to delete sale")}},printInvoice(a){J.printInvoice(a,t=>{this.showError(t)})},handleSaved(){this.fetchSales()},resetFilters(){this.filters={search:"",status:null,date_from:"",date_to:""},this.pagination.current_page=1,this.fetchSales()},onPerPageChange(){this.pagination.current_page=1,this.fetchSales()},onDateFromChange(a){this.filters.date_from=a||"",this.pagination.current_page=1,this.fetchSales()},onDateToChange(a){this.filters.date_to=a||"",this.pagination.current_page=1,this.fetchSales()},formatDateDDMMYYYY:Bt,getStatusColor(a){return{draft:"grey",pending:"warning",partial:"info",paid:"success",cancelled:"error"}[a]||"grey"},showSuccess(a){window.Toast?window.Toast.fire({icon:"success",title:a}):window.Swal?window.Swal.fire({icon:"success",title:a,timer:2e3,showConfirmButton:!1}):alert(a)},showError(a){window.Toast?window.Toast.fire({icon:"error",title:a}):window.Swal?window.Swal.fire({icon:"error",title:a}):alert(a)},showInfo(a){window.Toast?window.Toast.fire({icon:"info",title:a}):window.Swal?window.Swal.fire({icon:"info",title:a,timer:2e3,showConfirmButton:!1}):alert(a)}}},We={class:"page-header"},Ke={class:"text-caption text-grey"},Je={key:0},He={key:0,class:"text-center py-4"},Qe={class:"font-weight-bold"},Ge={class:"text-end"},Xe={class:"text-end"},Ze={class:"text-end"},$e={key:0},ta={class:"d-flex flex-column flex-md-row justify-space-between align-center align-md-start gap-3 mt-4"},ea={class:"text-caption text-grey"},aa={key:0},sa={key:0,class:"ml-2"},oa={key:1},la={key:0,class:"d-flex align-center gap-2"};function ia(a,t,i,f,e,o){const u=c("v-btn"),v=c("v-select"),y=c("v-col"),r=c("DatePicker"),g=c("v-text-field"),D=c("v-row"),F=c("v-card-text"),k=c("v-card"),M=c("v-card-title"),P=c("v-progress-circular"),z=c("v-chip"),A=c("v-table"),U=c("v-pagination"),E=c("SaleDialog"),w=c("ViewSaleDialog");return h(),_("div",null,[s("div",We,[t[9]||(t[9]=s("h1",{class:"text-h4 page-title"},"Sales / POS",-1)),l(u,{color:"primary","prepend-icon":"mdi-plus",onClick:o.openDialog,class:"add-button"},{default:n(()=>t[8]||(t[8]=[x(" New Sale ")])),_:1,__:[8]},8,["onClick"])]),l(k,{class:"mb-4"},{default:n(()=>[l(F,null,{default:n(()=>[l(D,null,{default:n(()=>[l(y,{cols:"12",md:"3"},{default:n(()=>[l(v,{modelValue:e.pagination.per_page,"onUpdate:modelValue":[t[0]||(t[0]=p=>e.pagination.per_page=p),o.onPerPageChange],items:e.perPageOptions,label:"Items per page","prepend-inner-icon":"mdi-format-list-numbered",variant:"outlined",density:"compact"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),l(y,{cols:"12",md:"2"},{default:n(()=>[l(v,{modelValue:e.filters.status,"onUpdate:modelValue":[t[1]||(t[1]=p=>e.filters.status=p),o.fetchSales],items:e.statusOptions,label:"Status","prepend-inner-icon":"mdi-filter",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),l(y,{cols:"12",md:"2"},{default:n(()=>[l(r,{modelValue:e.filters.date_from,"onUpdate:modelValue":[t[2]||(t[2]=p=>e.filters.date_from=p),o.onDateFromChange],label:"From Date",density:"compact"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(y,{cols:"12",md:"2"},{default:n(()=>[l(r,{modelValue:e.filters.date_to,"onUpdate:modelValue":[t[3]||(t[3]=p=>e.filters.date_to=p),o.onDateToChange],label:"To Date",density:"compact"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(y,{cols:"12",md:"3"},{default:n(()=>[l(g,{modelValue:e.filters.search,"onUpdate:modelValue":[t[4]||(t[4]=p=>e.filters.search=p),o.fetchSales],label:"Search Invoice/Customer","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),l(k,null,{default:n(()=>[l(M,{class:"d-flex justify-space-between align-center"},{default:n(()=>[t[11]||(t[11]=s("span",null,"Sales",-1)),s("span",Ke,[t[10]||(t[10]=x(" Total Records: ")),s("strong",null,d(e.pagination.total||0),1),e.sales.length>0?(h(),_("span",Je," | Showing "+d((e.pagination.current_page-1)*e.pagination.per_page+1)+" to "+d(Math.min(e.pagination.current_page*e.pagination.per_page,e.pagination.total))+" of "+d(e.pagination.total),1)):b("",!0)])]),_:1,__:[11]}),l(F,null,{default:n(()=>[e.loading?(h(),_("div",He,[l(P,{indeterminate:"",color:"primary"})])):(h(),C(A,{key:1},{default:n(()=>[t[13]||(t[13]=s("thead",null,[s("tr",null,[s("th",null,"Invoice #"),s("th",null,"Customer"),s("th",null,"Date"),s("th",{class:"text-end"},"Total"),s("th",{class:"text-end"},"Paid"),s("th",{class:"text-end"},"Due"),s("th",null,"Status"),s("th",null,"Actions")])],-1)),s("tbody",null,[(h(!0),_(O,null,B(e.sales,p=>{var S;return h(),_("tr",{key:p.id},[s("td",null,[s("span",Qe,d(p.invoice_number),1)]),s("td",null,d(((S=p.customer)==null?void 0:S.name)||"Walk-in"),1),s("td",null,d(o.formatDateDDMMYYYY(p.invoice_date)),1),s("td",Ge," ৳"+d(parseFloat(p.total_amount).toFixed(2)),1),s("td",Xe," ৳"+d(parseFloat(p.paid_amount).toFixed(2)),1),s("td",Ze,[l(z,{color:p.balance_amount>0?"error":"success",size:"small"},{default:n(()=>[x(" ৳"+d(parseFloat(p.balance_amount).toFixed(2)),1)]),_:2},1032,["color"])]),s("td",null,[l(z,{color:o.getStatusColor(p.status),size:"small"},{default:n(()=>[x(d(p.status),1)]),_:2},1032,["color"])]),s("td",null,[l(u,{icon:"mdi-eye",size:"small",variant:"text",onClick:V=>o.viewSale(p)},null,8,["onClick"]),l(u,{icon:"mdi-pencil",size:"small",variant:"text",onClick:V=>o.editSale(p)},null,8,["onClick"]),l(u,{icon:"mdi-printer",size:"small",variant:"text",onClick:V=>o.printInvoice(p)},null,8,["onClick"]),l(u,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:V=>o.confirmDelete(p)},null,8,["onClick"])])])}),128)),e.sales.length===0?(h(),_("tr",$e,t[12]||(t[12]=[s("td",{colspan:"8",class:"text-center py-4"},"No sales found",-1)]))):b("",!0)])]),_:1,__:[13]})),s("div",ta,[s("div",ea,[e.sales.length>0&&e.pagination.total>0?(h(),_("span",aa,[t[14]||(t[14]=x(" Showing ")),s("strong",null,d((e.pagination.current_page-1)*e.pagination.per_page+1),1),t[15]||(t[15]=x(" to ")),s("strong",null,d(Math.min(e.pagination.current_page*e.pagination.per_page,e.pagination.total)),1),t[16]||(t[16]=x(" of ")),s("strong",null,d(e.pagination.total.toLocaleString()),1),t[17]||(t[17]=x(" records ")),e.pagination.last_page>1?(h(),_("span",sa," (Page "+d(e.pagination.current_page)+" of "+d(e.pagination.last_page)+") ",1)):b("",!0)])):(h(),_("span",oa," No records found "))]),e.pagination.last_page>1?(h(),_("div",la,[l(U,{modelValue:e.pagination.current_page,"onUpdate:modelValue":[t[5]||(t[5]=p=>e.pagination.current_page=p),o.fetchSales],length:e.pagination.last_page,"total-visible":7,density:"comfortable"},null,8,["modelValue","length","onUpdate:modelValue"])])):b("",!0)])]),_:1})]),_:1}),l(E,{"model-value":e.dialog,"onUpdate:modelValue":t[6]||(t[6]=p=>e.dialog=p),sale:e.selectedSale,onSaved:o.handleSaved},null,8,["model-value","sale","onSaved"]),l(w,{"model-value":e.viewDialog,"onUpdate:modelValue":t[7]||(t[7]=p=>e.viewDialog=p),sale:e.selectedSale},null,8,["model-value","sale"])])}const da=Y(Le,[["render",ia],["__scopeId","data-v-91246c00"]]);export{da as default};
