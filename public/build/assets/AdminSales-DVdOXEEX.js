import{c as W}from"./commonMixin-BwIVv23E.js";import{_ as L,i as q,d as F,w as l,a as o,r as m,b as e,f,t as n,c as _,e as D,l as Z,F as B,h as j,p as J,o as r}from"./app-C4LtncxF.js";import{D as $}from"./DatePickerVuetifyInput-CIggz0tO.js";import{D as tt}from"./DatePicker-DFqxtyTy.js";import{P as et,p as K}from"./PaginationControls-bn3QRFAz.js";const st={name:"SaleDialog",mixins:[W],components:{DatePickerVuetifyInput:$},props:{modelValue:{type:Boolean,required:!0},sale:{type:Object,default:null}},emits:["update:modelValue","saved"],data(){return{form:this.getEmptyForm(),formValid:!1,cartItems:[],productSearch:"",searchResults:[],mostSoldProducts:[],customers:[],warehouses:[],saving:!1,paymentMethod:"cash",paymentMethods:[{title:"Cash",value:"cash"},{title:"Card",value:"card"},{title:"Mobile Banking",value:"mobile_banking"},{title:"Bank Transfer",value:"bank_transfer"},{title:"Cheque",value:"cheque"}],rules:{required:a=>!!a||"Required"},discountAmountManuallySet:!1,taxAmountManuallySet:!1}},computed:{isEdit(){return!!this.form.id},calculatedItemsDiscount(){return this.cartItems.reduce((a,t)=>a+(t.discount||0),0)},calculatedItemsTax(){return this.cartItems.reduce((a,t)=>a+(t.tax||0),0)},calculatedTotalTax(){const a=this.calculatedItemsTax,t=parseFloat(this.form.tax_amount)||0,c=this.form.tax_amount>0||this.taxAmountManuallySet||this.form.tax_amount===0&&a===0?t:0;return a+c}},watch:{sale:{immediate:!0,async handler(a){a&&a.id?await this.loadSaleForEdit(a.id):(this.form=this.getEmptyForm(),this.cartItems=[],this.discountAmountManuallySet=!1,this.taxAmountManuallySet=!1)}},modelValue(a){a?(this.fetchOptions(),this.fetchMostSoldProducts(),(!this.sale||!this.sale.id)&&(this.form=this.getEmptyForm(),this.cartItems=[],this.discountAmountManuallySet=!1,this.taxAmountManuallySet=!1)):(this.form=this.getEmptyForm(),this.cartItems=[],this.discountAmountManuallySet=!1,this.taxAmountManuallySet=!1)}},methods:{getEmptyForm(){return{id:null,customer_id:null,warehouse_id:null,invoice_date:new Date().toISOString().split("T")[0],due_date:null,subtotal:0,tax_amount:0,discount_amount:0,shipping_cost:0,total_amount:0,paid_amount:0,balance_amount:0,notes:""}},async fetchOptions(){try{const[a,t]=await Promise.all([q.get("/api/v1/customers"),q.get("/api/v1/warehouses")]);this.customers=a.data.data||a.data.customers||[],this.warehouses=t.data.data||t.data.warehouses||[]}catch(a){console.error("Failed to load options",a)}},async fetchMostSoldProducts(){try{const{data:a}=await q.get("/api/v1/products",{params:{per_page:10,is_active:1,sort:"most_sold",order:"desc"}});let t=a.data||a.products||[];if(t.length===0){const{data:c}=await q.get("/api/v1/products",{params:{per_page:10,is_active:1,has_stock:1}});t=c.data||c.products||[]}this.mostSoldProducts=t.filter(c=>c.stock_quantity>0).slice(0,10)}catch(a){console.error("Failed to load most sold products",a)}},async searchProducts(){if(this.productSearch)try{const{data:a}=await q.get("/api/v1/products",{params:{search:this.productSearch,per_page:10}});this.searchResults=a.data||a.products||[]}catch(a){console.error("Failed to search products",a)}},addToCart(a){const t=this.cartItems.findIndex(c=>c.product_id===a.id);if(t>=0)this.cartItems[t].quantity++,this.updateCartItem(t);else{const c=parseFloat(a.tax_rate||0);this.cartItems.push({product_id:a.id,product_name:a.name,quantity:1,unit_price:parseFloat(a.sale_price),discount:0,tax_rate:c,tax:0,total:0}),this.updateCartItem(this.cartItems.length-1)}if(!this.form.warehouse_id&&a.stock_by_warehouse&&a.stock_by_warehouse.length>0){const c=a.stock_by_warehouse.filter(x=>x.quantity>0).sort((x,s)=>(s.quantity||0)-(x.quantity||0))[0];c&&c.warehouse_id?this.form.warehouse_id=c.warehouse_id:a.stock_by_warehouse[0]&&a.stock_by_warehouse[0].warehouse_id&&(this.form.warehouse_id=a.stock_by_warehouse[0].warehouse_id)}this.productSearch="",this.searchResults=[],this.calculateTotals()},updateCartItem(a,t=!1){const c=this.cartItems[a];if(!c)return;const s=c.quantity*c.unit_price-(c.discount||0);if(t)s>0&&c.tax>0&&(c.tax_rate=parseFloat((c.tax/s*100).toFixed(2)));else{const i=parseFloat(c.tax_rate||0);c.tax=parseFloat((s*i/100).toFixed(2))}c.total=parseFloat((s+c.tax).toFixed(2)),this.calculateTotals()},removeFromCart(a){this.cartItems.splice(a,1),this.calculateTotals()},calculateTotals(){const a=this.cartItems.reduce((h,v)=>h+v.quantity*v.unit_price,0),t=this.cartItems.reduce((h,v)=>h+(v.discount||0),0),c=this.cartItems.reduce((h,v)=>h+(v.tax||0),0);this.form.subtotal=parseFloat(a.toFixed(2));const x=this.form.discount_amount>0||this.form.discount_amount===0&&t===0?parseFloat(this.form.discount_amount):t,s=this.form.tax_amount>0||this.form.tax_amount===0&&c===0?parseFloat(this.form.tax_amount):c,i=a-x+s+(parseFloat(this.form.shipping_cost)||0);this.form.total_amount=parseFloat(i.toFixed(2)),this.calculateBalance()},calculateBalance(){this.form.balance_amount=parseFloat((this.form.total_amount-(this.form.paid_amount||0)).toFixed(2))},async loadSaleForEdit(a){var t,c,x;if(a)try{const i=(await q.get(`/api/v1/sales/${a}`)).data;if(!i){this.showError("Sale not found");return}console.log("Loading sale for edit:",i),this.form={id:i.id,customer_id:i.customer_id,warehouse_id:i.warehouse_id,invoice_date:i.invoice_date?i.invoice_date.includes("T")?i.invoice_date.split("T")[0]:i.invoice_date:new Date().toISOString().split("T")[0],due_date:i.due_date?i.due_date.includes("T")?i.due_date.split("T")[0]:i.due_date:null,subtotal:parseFloat(i.subtotal||0),tax_amount:parseFloat(i.tax_amount||0),discount_amount:parseFloat(i.discount_amount||0),shipping_cost:parseFloat(i.shipping_cost||0),total_amount:parseFloat(i.total_amount||0),paid_amount:parseFloat(i.paid_amount||0),balance_amount:parseFloat(i.balance_amount||0),notes:i.notes||""},this.discountAmountManuallySet=!0,this.taxAmountManuallySet=!0,i.items&&Array.isArray(i.items)&&i.items.length>0?this.cartItems=i.items.map(h=>{var A,P;const v=(h.quantity||0)*(h.unit_price||0),S=parseFloat(h.discount||0),d=v-S;let g=0;((A=h.product)==null?void 0:A.tax_rate)!==void 0?g=parseFloat(h.product.tax_rate||0):d>0&&(g=parseFloat(h.tax||0)/d*100);const w=parseFloat((d*g/100).toFixed(2)),C=parseFloat((d+w).toFixed(2));return{product_id:h.product_id,product_name:((P=h.product)==null?void 0:P.name)||"Unknown",quantity:parseInt(h.quantity,10),unit_price:parseFloat(h.unit_price||0),discount:S,tax_rate:g,tax:w,total:C}}):this.cartItems=[],this.calculateTotals()}catch(s){console.error("Failed to load sale for edit:",s),console.error("Error response:",(t=s.response)==null?void 0:t.data),this.showError(((x=(c=s.response)==null?void 0:c.data)==null?void 0:x.message)||"Failed to load sale details")}},showSuccess(a){window.Toast?window.Toast.fire({icon:"success",title:a}):window.Swal?window.Swal.fire({icon:"success",title:a,timer:2e3,showConfirmButton:!1}):alert(a)},showError(a){window.Toast?window.Toast.fire({icon:"error",title:a}):window.Swal?window.Swal.fire({icon:"error",title:a}):alert(a)},async save(a=null){var t,c,x;if(this.cartItems.length===0){this.showError("Please add at least one product");return}if(this.$refs.formRef){const{valid:s}=await this.$refs.formRef.validate();if(!s){this.showError("Please fill in all required fields");return}}if(!this.form.customer_id){this.showError("Please select a customer");return}if(!this.form.warehouse_id){this.showError("Please select a warehouse");return}if(!this.form.invoice_date){this.showError("Please select an invoice date");return}this.saving=!0;try{const s=this.cartItems.reduce((g,w)=>g+(w.discount||0),0),i=this.cartItems.reduce((g,w)=>g+(w.tax||0),0),h={customer_id:Number(this.form.customer_id),warehouse_id:Number(this.form.warehouse_id),invoice_date:this.form.invoice_date,due_date:this.form.due_date||null,paid_amount:parseFloat(this.form.paid_amount)||0,shipping_cost:parseFloat(this.form.shipping_cost)||0,notes:this.form.notes||"",payment_method:this.paymentMethod||"cash",items:this.cartItems.map(g=>({product_id:Number(g.product_id),quantity:parseInt(g.quantity,10),unit_price:parseFloat(g.unit_price),discount:parseFloat(g.discount)||0,tax:parseFloat(g.tax)||0,notes:g.notes||""}))},v=parseFloat(this.form.discount_amount)||0;(v>0||this.discountAmountManuallySet||v===0&&s===0)&&(h.discount_amount=v);const S=parseFloat(this.form.tax_amount)||0;(S>0||this.taxAmountManuallySet||S===0&&i===0)&&(h.tax_amount=S),a&&typeof a=="string"&&(h.status=String(a)),console.log("Saving sale with payload:",JSON.stringify(h,null,2));let d;this.isEdit?(d=await q.put(`/api/v1/sales/${this.form.id}`,h),this.showSuccess(a==="draft"?"Sale draft updated successfully":"Sale updated successfully")):(d=await q.post("/api/v1/sales",h),this.showSuccess(a==="draft"?"Sale saved as draft successfully":"Sale created successfully")),console.log("Sale saved successfully:",d.data),this.$emit("saved"),this.close()}catch(s){console.error("Failed to save sale:",s),console.error("Error response:",(t=s.response)==null?void 0:t.data),console.error("Error status:",(c=s.response)==null?void 0:c.status);let i="Failed to save sale. Please check the console for details.";(x=s.response)!=null&&x.data?s.response.data.message?i=s.response.data.message:s.response.data.error?i=s.response.data.error:s.response.data.errors&&(i=Object.values(s.response.data.errors).flat().join(", ")):s.message&&(i=s.message),this.showError(i)}finally{this.saving=!1}},async saveAsDraft(){await this.save("draft")},close(){this.$emit("update:modelValue",!1),this.form=this.getEmptyForm(),this.cartItems=[],this.searchResults=[],this.discountAmountManuallySet=!1,this.taxAmountManuallySet=!1}}},at={class:"d-flex align-center gap-2"},ot={class:"text-h6 text-white font-weight-medium"},it={key:0,class:"mt-3"},lt={class:"text-caption text-grey mb-2"},nt={class:"d-flex flex-wrap gap-2"},rt={class:"ml-1 text-caption"},dt={key:1,class:"search-results-container"},ct={class:"text-body-2 font-weight-medium"},ut={class:"text-body-2"},mt={class:"pa-1"},pt={class:"pa-1"},ht={class:"pa-1"},ft={class:"pa-1"},_t={class:"text-body-2 font-weight-bold text-end"},vt={class:"text-center"},xt={class:"mb-2"},gt={class:"mb-2"},yt={class:"totals-section"},bt={class:"d-flex justify-space-between mb-1"},wt={class:"text-body-2 font-weight-medium"},St={key:0,class:"d-flex justify-space-between mb-1"},Dt={class:"text-body-2 text-error"},kt={class:"d-flex justify-space-between mb-1"},Ft={key:1,class:"d-flex justify-space-between mb-1"},It={class:"text-body-2"},Ct={class:"d-flex justify-space-between mb-1"},Pt={key:2,class:"d-flex justify-space-between mb-1"},Tt={class:"text-body-2 font-weight-medium"},Vt={class:"d-flex justify-space-between mb-2"},zt={class:"d-flex justify-space-between mb-2 total-amount"},At={class:"text-h6 font-weight-bold text-primary"},Ut={class:"mb-2"},Mt={class:"mb-2"},Et={key:3,class:"mb-2"};function qt(a,t,c,x,s,i){const h=m("v-icon"),v=m("v-btn"),S=m("v-card-title"),d=m("v-text-field"),g=m("v-chip"),w=m("v-img"),C=m("v-avatar"),A=m("v-list-item-title"),P=m("v-list-item-subtitle"),y=m("v-list-item"),I=m("v-list"),T=m("v-card-text"),V=m("v-card"),z=m("v-divider"),b=m("v-table"),E=m("v-alert"),p=m("v-col"),U=m("v-autocomplete"),k=m("v-select"),N=m("DatePickerVuetifyInput"),R=m("v-row"),Y=m("v-textarea"),H=m("v-form"),G=m("v-card-actions"),X=m("v-dialog");return r(),F(X,{"model-value":c.modelValue,"onUpdate:modelValue":t[16]||(t[16]=u=>a.$emit("update:modelValue",u)),"max-width":"1400px",persistent:"",scrollable:""},{default:l(()=>[o(V,{class:"pos-dialog"},{default:l(()=>[o(S,{class:"pos-header d-flex justify-space-between align-center pa-3"},{default:l(()=>[e("div",at,[o(h,{color:"white"},{default:l(()=>t[17]||(t[17]=[f("mdi-point-of-sale")])),_:1,__:[17]}),e("span",ot,n(i.isEdit?"Edit Sale":"New Sale - POS"),1)]),o(v,{icon:"mdi-close",variant:"text",color:"white",size:"small",onClick:i.close},null,8,["onClick"])]),_:1}),o(T,{class:"pa-3"},{default:l(()=>[o(H,{ref:"formRef",modelValue:s.formValid,"onUpdate:modelValue":t[15]||(t[15]=u=>s.formValid=u)},{default:l(()=>[o(R,{dense:"",class:"ma-0"},{default:l(()=>[o(p,{cols:"12",lg:"8",class:"pa-2"},{default:l(()=>[o(V,{variant:"flat",class:"mb-3 search-card",elevation:"1"},{default:l(()=>[o(T,{class:"pa-3"},{default:l(()=>[o(d,{modelValue:s.productSearch,"onUpdate:modelValue":t[0]||(t[0]=u=>s.productSearch=u),label:"Search Product (Name/SKU/Barcode)",placeholder:"Type product name, SKU, or barcode and press Enter","prepend-inner-icon":"mdi-magnify",clearable:"",autofocus:"",variant:"outlined","hide-details":"auto",hint:"Search by product name, SKU, or barcode. Press Enter to search","persistent-hint":"",onKeyup:Z(i.searchProducts,["enter"]),"onClick:clear":t[1]||(t[1]=u=>s.searchResults=[])},null,8,["modelValue","onKeyup"]),s.mostSoldProducts.length>0&&s.searchResults.length===0?(r(),_("div",it,[e("div",lt,[o(h,{size:"14",class:"mr-1"},{default:l(()=>t[18]||(t[18]=[f("mdi-fire")])),_:1,__:[18]}),t[19]||(t[19]=f(" Most Sold Products "))]),e("div",nt,[(r(!0),_(B,null,j(s.mostSoldProducts,u=>(r(),F(g,{key:u.id,color:"primary",variant:"flat",size:"small",class:"product-chip",onClick:O=>i.addToCart(u),disabled:!u.stock_quantity||u.stock_quantity<=0},{default:l(()=>[o(h,{size:"14",class:"mr-1"},{default:l(()=>t[20]||(t[20]=[f("mdi-package-variant")])),_:1,__:[20]}),f(" "+n(u.name)+" ",1),e("span",rt,"(৳"+n(u.sale_price)+")",1)]),_:2},1032,["onClick","disabled"]))),128))])])):D("",!0),s.searchResults.length>0?(r(),_("div",dt,[o(I,{class:"search-results"},{default:l(()=>[(r(!0),_(B,null,j(s.searchResults,u=>(r(),F(y,{key:u.id,onClick:O=>i.addToCart(u),class:"search-item"},{prepend:l(()=>[o(C,{size:"40",color:"grey-lighten-4"},{default:l(()=>[u.image?(r(),F(w,{key:0,src:u.image},null,8,["src"])):(r(),F(h,{key:1},{default:l(()=>t[21]||(t[21]=[f("mdi-package-variant")])),_:1,__:[21]}))]),_:2},1024)]),append:l(()=>[o(g,{color:"primary",size:"small",variant:"flat"},{default:l(()=>[f("৳"+n(u.sale_price),1)]),_:2},1024)]),default:l(()=>[o(A,null,{default:l(()=>[f(n(u.name),1)]),_:2},1024),o(P,null,{default:l(()=>[f(" SKU: "+n(u.sku||"N/A")+" | Stock: "+n(u.stock_quantity||0),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})])):D("",!0)]),_:1})]),_:1}),o(V,{variant:"flat",class:"cart-card",elevation:"1"},{default:l(()=>[o(S,{class:"cart-header pa-2"},{default:l(()=>[o(h,{size:"18",class:"mr-1"},{default:l(()=>t[22]||(t[22]=[f("mdi-cart")])),_:1,__:[22]}),e("span",ct,"Cart Items ("+n(s.cartItems.length)+")",1)]),_:1}),o(z),o(T,{class:"pa-2"},{default:l(()=>[s.cartItems.length>0?(r(),F(b,{key:0,density:"compact",class:"cart-table"},{default:l(()=>[t[23]||(t[23]=e("thead",null,[e("tr",null,[e("th",{class:"text-caption"},"Product"),e("th",{class:"text-caption text-center",style:{width:"70px"}},"Qty"),e("th",{class:"text-caption text-end",style:{width:"90px"}},"Price"),e("th",{class:"text-caption text-end",style:{width:"80px"}},"Disc."),e("th",{class:"text-caption text-end",style:{width:"80px"}},"Tax"),e("th",{class:"text-caption text-end",style:{width:"100px"}},"Total"),e("th",{class:"text-caption",style:{width:"40px"}})])],-1)),e("tbody",null,[(r(!0),_(B,null,j(s.cartItems,(u,O)=>(r(),_("tr",{key:O,class:"cart-row"},[e("td",ut,n(u.product_name),1),e("td",mt,[o(d,{modelValue:u.quantity,"onUpdate:modelValue":[M=>u.quantity=M,M=>i.updateCartItem(O)],modelModifiers:{number:!0},type:"number",min:"1",density:"compact","hide-details":"",variant:"outlined",class:"cart-input"},null,8,["modelValue","onUpdate:modelValue"])]),e("td",pt,[o(d,{modelValue:u.unit_price,"onUpdate:modelValue":[M=>u.unit_price=M,M=>i.updateCartItem(O)],modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",density:"compact","hide-details":"",variant:"outlined",class:"cart-input"},null,8,["modelValue","onUpdate:modelValue"])]),e("td",ht,[o(d,{modelValue:u.discount,"onUpdate:modelValue":[M=>u.discount=M,M=>i.updateCartItem(O)],modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",density:"compact","hide-details":"",variant:"outlined",class:"cart-input"},null,8,["modelValue","onUpdate:modelValue"])]),e("td",ft,[o(d,{modelValue:u.tax,"onUpdate:modelValue":[M=>u.tax=M,M=>i.updateCartItem(O,!0)],modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",density:"compact","hide-details":"",variant:"outlined",class:"cart-input"},null,8,["modelValue","onUpdate:modelValue"])]),e("td",_t,"৳"+n(u.total.toFixed(2)),1),e("td",vt,[o(v,{icon:"mdi-delete",size:"x-small",variant:"text",color:"error",onClick:M=>i.removeFromCart(O)},null,8,["onClick"])])]))),128))])]),_:1,__:[23]})):(r(),F(E,{key:1,type:"info",variant:"tonal",density:"compact",class:"mt-2 mb-0"},{default:l(()=>t[24]||(t[24]=[e("span",{class:"text-caption"},"Cart is empty. Search and add products.",-1)])),_:1,__:[24]}))]),_:1})]),_:1})]),_:1}),o(p,{cols:"12",lg:"4",class:"pa-2"},{default:l(()=>[o(V,{variant:"flat",class:"details-card",elevation:"1"},{default:l(()=>[o(T,{class:"pa-2"},{default:l(()=>[e("div",xt,[o(U,{modelValue:s.form.customer_id,"onUpdate:modelValue":t[2]||(t[2]=u=>s.form.customer_id=u),items:s.customers,"item-value":"id","item-title":"name",placeholder:"Select or search for a customer",clearable:"",density:"compact",variant:"outlined","hide-details":"auto",rules:[s.rules.required],hint:"Select the customer for this sale","persistent-hint":""},{"prepend-inner":l(()=>[o(h,{size:"18"},{default:l(()=>t[25]||(t[25]=[f("mdi-account")])),_:1,__:[25]})]),label:l(()=>t[26]||(t[26]=[f(" Customer "),e("span",{class:"text-error",style:{"font-size":"1.2em","font-weight":"bold"}},"*",-1)])),_:1},8,["modelValue","items","rules"])]),e("div",gt,[o(k,{modelValue:s.form.warehouse_id,"onUpdate:modelValue":t[3]||(t[3]=u=>s.form.warehouse_id=u),items:s.warehouses,"item-value":"id","item-title":"name",placeholder:"Select warehouse",density:"compact",variant:"outlined","hide-details":"auto",rules:[s.rules.required],hint:"Select the warehouse for this sale","persistent-hint":""},{"prepend-inner":l(()=>[o(h,{size:"18"},{default:l(()=>t[27]||(t[27]=[f("mdi-warehouse")])),_:1,__:[27]})]),label:l(()=>t[28]||(t[28]=[f(" Warehouse "),e("span",{class:"text-error",style:{"font-size":"1.2em","font-weight":"bold"}},"*",-1)])),_:1},8,["modelValue","items","rules"])]),o(R,{dense:"",class:"ma-0 mb-2"},{default:l(()=>[o(p,{cols:"6",class:"pa-1"},{default:l(()=>[o(N,{"field-label":"Invoice Date",required:"true",variant:"outlined","initial-date":s.form.invoice_date,onTrigerInputValue:t[4]||(t[4]=u=>{s.form.invoice_date=u})},null,8,["initial-date"]),t[29]||(t[29]=e("div",{class:"text-caption text-grey mt-1 ml-2"},[e("span",{class:"text-error",style:{"font-size":"1.1em","font-weight":"bold"}},"*"),f(" Select the invoice date ")],-1))]),_:1,__:[29]}),o(p,{cols:"6",class:"pa-1"},{default:l(()=>[o(N,{"field-label":"Due Date",variant:"outlined","initial-date":s.form.due_date,onTrigerInputValue:t[5]||(t[5]=u=>{s.form.due_date=u})},null,8,["initial-date"]),t[30]||(t[30]=e("div",{class:"text-caption text-grey mt-1 ml-2"}," Optional: Select payment due date ",-1))]),_:1,__:[30]})]),_:1}),o(z,{class:"my-2"}),e("div",yt,[e("div",bt,[t[31]||(t[31]=e("span",{class:"text-caption text-grey"},"Subtotal:",-1)),e("span",wt,"৳"+n(s.form.subtotal.toFixed(2)),1)]),i.calculatedItemsDiscount>0?(r(),_("div",St,[t[32]||(t[32]=e("span",{class:"text-caption text-grey"},"Item Discounts:",-1)),e("span",Dt,"-৳"+n(i.calculatedItemsDiscount.toFixed(2)),1)])):D("",!0),e("div",kt,[t[33]||(t[33]=e("span",{class:"text-caption text-grey"},"Order Discount:",-1)),o(d,{modelValue:s.form.discount_amount,"onUpdate:modelValue":[t[6]||(t[6]=u=>s.form.discount_amount=u),t[7]||(t[7]=()=>{s.discountAmountManuallySet=!0,i.calculateTotals()})],modelModifiers:{number:!0},type:"number",density:"compact",variant:"outlined","hide-details":"",min:"0",step:"0.01",class:"compact-input"},null,8,["modelValue"])]),i.calculatedItemsTax>0?(r(),_("div",Ft,[t[34]||(t[34]=e("span",{class:"text-caption text-grey"},"Item Tax:",-1)),e("span",It,"৳"+n(i.calculatedItemsTax.toFixed(2)),1)])):D("",!0),e("div",Ct,[t[35]||(t[35]=e("span",{class:"text-caption text-grey"},"Order Tax:",-1)),o(d,{modelValue:s.form.tax_amount,"onUpdate:modelValue":[t[8]||(t[8]=u=>s.form.tax_amount=u),t[9]||(t[9]=()=>{s.taxAmountManuallySet=!0,i.calculateTotals()})],modelModifiers:{number:!0},type:"number",density:"compact",variant:"outlined","hide-details":"",min:"0",step:"0.01",class:"compact-input"},null,8,["modelValue"])]),i.calculatedTotalTax>0?(r(),_("div",Pt,[t[36]||(t[36]=e("span",{class:"text-caption text-grey font-weight-medium"},"Total Tax:",-1)),e("span",Tt,"৳"+n(i.calculatedTotalTax.toFixed(2)),1)])):D("",!0),e("div",Vt,[t[37]||(t[37]=e("span",{class:"text-caption text-grey"},"Shipping:",-1)),o(d,{modelValue:s.form.shipping_cost,"onUpdate:modelValue":[t[10]||(t[10]=u=>s.form.shipping_cost=u),i.calculateTotals],modelModifiers:{number:!0},type:"number",density:"compact",variant:"outlined","hide-details":"",min:"0",step:"0.01",class:"compact-input"},null,8,["modelValue","onUpdate:modelValue"])]),o(z,{class:"my-2"}),e("div",zt,[t[38]||(t[38]=e("span",{class:"text-body-1 font-weight-bold"},"Total:",-1)),e("span",At,"৳"+n(s.form.total_amount.toFixed(2)),1)]),e("div",Ut,[o(d,{modelValue:s.form.paid_amount,"onUpdate:modelValue":[t[11]||(t[11]=u=>s.form.paid_amount=u),i.calculateBalance],modelModifiers:{number:!0},type:"number",label:"Paid Amount",placeholder:"Enter paid amount (e.g., 1000.00)",density:"compact",variant:"outlined",min:"0",step:"0.01","prepend-inner-icon":"mdi-cash","hide-details":"auto",hint:"Enter the amount paid by the customer","persistent-hint":""},null,8,["modelValue","onUpdate:modelValue"])]),e("div",Mt,[o(d,{modelValue:s.form.balance_amount,"onUpdate:modelValue":t[12]||(t[12]=u=>s.form.balance_amount=u),modelModifiers:{number:!0},label:"Balance (Due)",density:"compact",variant:"outlined",readonly:"",color:s.form.balance_amount>0?"error":"success",class:J(s.form.balance_amount>0?"text-error":"text-success")},null,8,["modelValue","color","class"])]),s.form.paid_amount>0?(r(),_("div",Et,[o(k,{modelValue:s.paymentMethod,"onUpdate:modelValue":t[13]||(t[13]=u=>s.paymentMethod=u),items:s.paymentMethods,label:"Payment Method",placeholder:"Select payment method",density:"compact",variant:"outlined","hide-details":"auto",hint:"Select how the customer paid","persistent-hint":""},null,8,["modelValue","items"])])):D("",!0)]),o(z,{class:"my-2"}),o(Y,{modelValue:s.form.notes,"onUpdate:modelValue":t[14]||(t[14]=u=>s.form.notes=u),label:"Notes",placeholder:"Enter any additional notes about this sale (optional)",rows:"2",density:"compact",variant:"outlined","hide-details":"auto",hint:"Optional: Additional notes or comments about this sale","persistent-hint":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(z),o(G,{class:"pa-2 justify-end"},{default:l(()=>[o(v,{variant:"text",size:"small",onClick:i.close},{default:l(()=>t[39]||(t[39]=[f("Cancel")])),_:1,__:[39]},8,["onClick"]),i.isEdit?D("",!0):(r(),F(v,{key:0,color:"grey",size:"small",loading:s.saving,disabled:s.cartItems.length===0,onClick:i.saveAsDraft},{default:l(()=>[o(h,{size:"18",class:"mr-1"},{default:l(()=>t[40]||(t[40]=[f("mdi-content-save-outline")])),_:1,__:[40]}),t[41]||(t[41]=f(" Save as Draft "))]),_:1,__:[41]},8,["loading","disabled","onClick"])),o(v,{color:"success",size:"small",loading:s.saving,disabled:s.cartItems.length===0,onClick:i.save},{default:l(()=>[o(h,{size:"18",class:"mr-1"},{default:l(()=>t[42]||(t[42]=[f("mdi-content-save")])),_:1,__:[42]}),f(" "+n(i.isEdit?"Update":"Save Sale"),1)]),_:1},8,["loading","disabled","onClick"])]),_:1})]),_:1})]),_:1},8,["model-value"])}const Nt=L(st,[["render",qt],["__scopeId","data-v-319acddd"]]);function Ot(a){if(!a)return"";try{const t=new Date(a);if(isNaN(t.getTime()))return"";const c=String(t.getDate()).padStart(2,"0"),s=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()],i=t.getFullYear();return`${c}/${s}/${i}`}catch{return a}}function Bt(a){if(!a)return"";try{if(typeof a=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(a)){const[i,h,v]=a.split("-");return`${v}/${h}/${i}`}const t=new Date(a);if(isNaN(t.getTime()))return"";const c=String(t.getDate()).padStart(2,"0"),x=String(t.getMonth()+1).padStart(2,"0"),s=t.getFullYear();return`${c}/${x}/${s}`}catch{return a}}const Q={async printInvoice(a,t){var c,x,s,i,h,v;try{const{data:S}=await q.get(`/api/v1/sales/${a.id}`),d=S.data||S.sale||S;if(!d){t&&t("Sale data not found");return}const g=window.open("","_blank","width=800,height=600");if(!g){t&&t("Please allow popups to print invoice");return}const w=(d.items||[]).reduce((k,N)=>k+parseFloat(N.discount||0),0),C=(d.items||[]).reduce((k,N)=>k+parseFloat(N.tax||0),0),A=parseFloat(d.subtotal||0),P=parseFloat(d.discount_amount||0),y=parseFloat(d.tax_amount||0),I=parseFloat(d.shipping_cost||0),T=P>0||P===0&&w===0?P:w,V=y>0||y===0&&C===0?y:C;let z;d.total_amount!==void 0&&d.total_amount!==null?z=parseFloat(d.total_amount):z=A-T+V+I;const b=V,E=k=>k?new Date(k).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):"",U=`<!DOCTYPE html>
<html>
<head>
    <title>Invoice #${d.invoice_number}</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; padding: 20px; color: #000; }
        .invoice-container { max-width: 800px; margin: 0 auto; background: white; }
        .invoice-header { background: #1976d2; color: white; padding: 20px; text-align: center; }
        .invoice-header h1 { font-size: 24px; margin-bottom: 5px; }
        .invoice-header .invoice-number { font-size: 14px; opacity: 0.9; }
        .invoice-section { padding: 20px; border-bottom: 1px solid #ddd; }
        .invoice-row { display: flex; margin-bottom: 20px; }
        .invoice-col { flex: 1; }
        .invoice-col h3 { font-size: 14px; margin-bottom: 10px; color: #666; }
        .invoice-col p { margin: 3px 0; font-size: 13px; }
        .invoice-meta { display: flex; gap: 30px; margin-top: 15px; }
        .invoice-meta-item { flex: 1; }
        .invoice-meta-item label { font-size: 12px; color: #666; display: block; }
        .invoice-meta-item span { font-size: 14px; font-weight: bold; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th { background: #f5f5f5; padding: 10px; text-align: left; border: 1px solid #ddd; font-size: 12px; font-weight: bold; }
        td { padding: 10px; border: 1px solid #ddd; font-size: 12px; }
        .text-right { text-align: right; }
        .text-center { text-align: center; }
        .totals-box { background: #f9f9f9; padding: 15px; border: 2px solid #1976d2; margin-top: 20px; }
        .totals-row { display: flex; justify-content: space-between; padding: 5px 0; }
        .totals-row.total { border-top: 2px solid #1976d2; border-bottom: 2px solid #1976d2; padding: 10px 0; margin: 10px 0; background: rgba(25, 118, 210, 0.05); font-weight: bold; }
        .totals-row.balance { border-top: 1px dashed #999; padding-top: 10px; margin-top: 10px; font-weight: bold; }
        .invoice-footer { text-align: center; padding: 20px; color: #666; font-size: 12px; }
        .status-badge { display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: bold; text-transform: uppercase; }
        .status-draft { background: #9e9e9e; color: white; }
        .status-pending { background: #ff9800; color: white; }
        .status-partial { background: #2196f3; color: white; }
        .status-paid { background: #4caf50; color: white; }
        .status-cancelled { background: #f44336; color: white; }
        @media print {
            body { padding: 0; }
            .invoice-container { box-shadow: none; }
            @page { margin: 1.5cm; size: A4; }
        }
    </style>
</head>
<body>
    <div class="invoice-container">
        <div class="invoice-header">
            <h1>INVOICE</h1>
            <div class="invoice-number">#${d.invoice_number}</div>
        </div>

        <div class="invoice-section">
            <div class="invoice-row">
                <div class="invoice-col">
                    <h3>From</h3>
                    <p><strong>Your Company Name</strong></p>
                    <p>Company Address, City, State</p>
                    <p>Phone: +1234567890 | Email: info@company.com</p>
                </div>
                <div class="invoice-col">
                    <h3>Bill To</h3>
                    <p><strong>${((c=d.customer)==null?void 0:c.name)||"Walk-in Customer"}</strong></p>
                    ${(x=d.customer)!=null&&x.phone?`<p>Phone: ${d.customer.phone}</p>`:""}
                    ${(s=d.customer)!=null&&s.email?`<p>Email: ${d.customer.email}</p>`:""}
                    ${(i=d.customer)!=null&&i.address?`<p>${d.customer.address}</p>`:""}
                </div>
            </div>
            <div class="invoice-meta">
                <div class="invoice-meta-item">
                    <label>Invoice Date</label>
                    <span>${E(d.invoice_date)}</span>
                </div>
                ${d.due_date?`
                <div class="invoice-meta-item">
                    <label>Due Date</label>
                    <span>${E(d.due_date)}</span>
                </div>
                `:""}
                <div class="invoice-meta-item">
                    <label>Status</label>
                    <span class="status-badge status-${d.status||"pending"}">${(d.status||"pending").toUpperCase()}</span>
                </div>
            </div>
        </div>

        <div class="invoice-section">
            <h3 style="margin-bottom: 15px;">Items</h3>
            <table>
                <thead>
                    <tr>
                        <th style="width: 30px;">#</th>
                        <th>Product</th>
                        <th class="text-center" style="width: 60px;">Qty</th>
                        <th class="text-right" style="width: 90px;">Price</th>
                        <th class="text-right" style="width: 80px;">Disc.</th>
                        <th class="text-right" style="width: 80px;">Tax</th>
                        <th class="text-right" style="width: 100px;">Total</th>
                    </tr>
                </thead>
                <tbody>
                    ${(d.items||[]).map((k,N)=>{var R,Y;return`
                    <tr>
                        <td>${N+1}</td>
                        <td>
                            <strong>${((R=k.product)==null?void 0:R.name)||"Unknown"}</strong>
                            ${(Y=k.product)!=null&&Y.sku?`<br><small style="color: #666;">SKU: ${k.product.sku}</small>`:""}
                        </td>
                        <td class="text-center">${k.quantity}</td>
                        <td class="text-right">৳${parseFloat(k.unit_price||0).toFixed(2)}</td>
                        <td class="text-right" style="color: #f44336;">-৳${parseFloat(k.discount||0).toFixed(2)}</td>
                        <td class="text-right">৳${parseFloat(k.tax||0).toFixed(2)}</td>
                        <td class="text-right"><strong>৳${parseFloat(k.total||0).toFixed(2)}</strong></td>
                    </tr>
                    `}).join("")}
                </tbody>
            </table>
        </div>

        <div class="invoice-section">
            <div class="invoice-row">
                <div class="invoice-col">
                    ${d.notes?`
                    <div style="background: #f9f9f9; padding: 10px; border-radius: 4px; margin-bottom: 15px;">
                        <h3 style="margin-bottom: 5px; font-size: 13px;">Notes</h3>
                        <p style="font-size: 12px;">${d.notes}</p>
                    </div>
                    `:""}
                    ${d.warehouse?`
                    <div style="background: #f9f9f9; padding: 10px; border-radius: 4px;">
                        <h3 style="margin-bottom: 5px; font-size: 13px;">Warehouse</h3>
                        <p style="font-size: 12px;">${d.warehouse.name}</p>
                    </div>
                    `:""}
                </div>
                <div class="invoice-col">
                    <div class="totals-box">
                        <div class="totals-row">
                            <span>Subtotal:</span>
                            <span>৳${A.toFixed(2)}</span>
                        </div>
                        ${w>0&&T===w?`
                        <div class="totals-row">
                            <span>Item Discounts:</span>
                            <span style="color: #f44336;">-৳${w.toFixed(2)}</span>
                        </div>
                        `:""}
                        ${P>0&&T===P?`
                        <div class="totals-row">
                            <span>Order Discount:</span>
                            <span style="color: #f44336;">-৳${P.toFixed(2)}</span>
                        </div>
                        `:""}
                        ${C>0&&V===C?`
                        <div class="totals-row">
                            <span>Item Tax:</span>
                            <span>৳${C.toFixed(2)}</span>
                        </div>
                        `:""}
                        ${y>0&&V===y?`
                        <div class="totals-row">
                            <span>Order Tax:</span>
                            <span>৳${y.toFixed(2)}</span>
                        </div>
                        `:""}
                        ${b>0?`
                        <div class="totals-row">
                            <span><strong>Total Tax:</strong></span>
                            <span><strong>৳${b.toFixed(2)}</strong></span>
                        </div>
                        `:""}
                        ${I>0?`
                        <div class="totals-row">
                            <span>Shipping:</span>
                            <span>৳${I.toFixed(2)}</span>
                        </div>
                        `:""}
                        <div class="totals-row total">
                            <span>Total:</span>
                            <span style="color: #1976d2;">৳${z.toFixed(2)}</span>
                        </div>
                        <div class="totals-row" style="color: #4caf50;">
                            <span><strong>Paid:</strong></span>
                            <span><strong>৳${parseFloat(d.paid_amount||0).toFixed(2)}</strong></span>
                        </div>
                        <div class="totals-row balance" style="color: ${d.balance_amount>0?"#f44336":"#4caf50"};">
                            <span><strong>Balance:</strong></span>
                            <span><strong>৳${parseFloat(d.balance_amount||0).toFixed(2)}</strong></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="invoice-footer">
            <p>Thank you for your business!</p>
        </div>
    </div>
    <script>
        window.onload = function() {
            window.print();
            window.onafterprint = function() {
                window.close();
            };
        };
    <\/script>
`+`</body>
</html>`;g.document.write(U),g.document.close()}catch(S){console.error("Failed to print invoice",S),t&&t(((v=(h=S.response)==null?void 0:h.data)==null?void 0:v.message)||"Failed to print invoice")}}},jt={name:"ViewSaleDialog",props:{modelValue:{type:Boolean,required:!0},sale:{type:Object,default:null}},emits:["update:modelValue"],data(){return{saleData:null,loading:!1,currentSaleId:null}},watch:{modelValue:{immediate:!0,handler(a){a&&this.sale&&this.sale.id?this.currentSaleId!==this.sale.id&&this.loadSaleDetails(this.sale.id):a||(this.saleData=null,this.currentSaleId=null)}},sale:{immediate:!0,handler(a){a&&a.id&&this.modelValue&&this.currentSaleId!==a.id&&this.loadSaleDetails(a.id)}}},computed:{calculatedItemsDiscount(){return!this.saleData||!this.saleData.items?0:this.saleData.items.reduce((a,t)=>a+parseFloat(t.discount||0),0)},calculatedItemsTax(){return!this.saleData||!this.saleData.items?0:this.saleData.items.reduce((a,t)=>a+parseFloat(t.tax||0),0)},calculatedTotalTax(){var c;const a=this.calculatedItemsTax,t=parseFloat(((c=this.saleData)==null?void 0:c.tax_amount)||0);return t>0?t:a},calculatedTotalAmount(){if(!this.saleData)return 0;if(this.saleData.total_amount!==void 0&&this.saleData.total_amount!==null)return parseFloat(this.saleData.total_amount);const a=parseFloat(this.saleData.subtotal||0),t=parseFloat(this.saleData.discount_amount||0),c=parseFloat(this.saleData.shipping_cost||0),x=this.calculatedTotalTax,s=a-t+x+c;return parseFloat(s.toFixed(2))}},methods:{async loadSaleDetails(a){var t,c,x;if(!a){console.error("No sale ID provided");return}if(!(this.currentSaleId===a&&this.saleData)){this.currentSaleId=a,this.loading=!0,this.saleData=null;try{const{data:s}=await q.get(`/api/v1/sales/${a}`);this.saleData=s.data||s.sale||s,this.saleData||(this.showError("Sale data not found"),this.currentSaleId=null)}catch(s){console.error("Failed to load sale details:",s),console.error("Error response:",(t=s.response)==null?void 0:t.data),this.showError(((x=(c=s.response)==null?void 0:c.data)==null?void 0:x.message)||"Failed to load sale details"),this.currentSaleId=null}finally{this.loading=!1}}},formatDate:Ot,getStatusColor(a){return{draft:"grey",pending:"warning",partial:"info",paid:"success",cancelled:"error"}[a]||"grey"},printInvoice(){if(!this.sale||!this.sale.id){this.showError("Sale information not available");return}Q.printInvoice(this.sale,a=>{this.showError(a)})},close(){this.$emit("update:modelValue",!1),this.saleData=null,this.currentSaleId=null},showError(a){window.Toast?window.Toast.fire({icon:"error",title:a}):window.Swal?window.Swal.fire({icon:"error",title:a}):alert(a)}}},Rt={class:"d-flex align-center gap-2"},Yt={key:0,class:"text-caption text-white text-opacity-90"},Kt={key:0,class:"text-center py-8"},Lt={key:1,class:"text-center py-8"},Wt={key:2,class:"invoice-content"},Jt={class:"invoice-header-section pa-3"},Qt={class:"invoice-customer-info"},Ht={class:"text-body-2 font-weight-medium mb-0"},Gt={key:0,class:"text-caption text-grey"},Xt={key:1,class:"text-caption text-grey"},Zt={key:2,class:"text-caption text-grey"},$t={class:"invoice-meta-item"},te={class:"text-body-2 font-weight-medium"},ee={class:"invoice-meta-item"},se={class:"text-body-2 font-weight-medium"},ae={class:"invoice-meta-item"},oe={class:"invoice-items-section pa-3"},ie={key:0},le={class:"text-grey text-caption"},ne={class:"text-body-2 font-weight-medium"},re={key:0,class:"text-caption text-grey"},de={class:"text-center text-body-2"},ce={class:"text-right text-body-2"},ue={class:"text-right text-body-2 text-error"},me={class:"text-right text-body-2"},pe={class:"text-right text-body-2 font-weight-bold"},he={class:"invoice-totals-section pa-3"},fe={key:0,class:"invoice-notes"},_e={class:"text-body-2 text-caption"},ve={key:1,class:"invoice-warehouse mt-2"},xe={class:"text-body-2 text-caption"},ge={class:"invoice-totals-box"},ye={class:"invoice-totals-row"},be={class:"invoice-totals-value text-body-2"},we={key:0,class:"invoice-totals-row"},Se={class:"invoice-totals-value text-body-2 text-error"},De={key:1,class:"invoice-totals-row"},ke={class:"invoice-totals-value text-body-2 text-error"},Fe={key:2,class:"invoice-totals-row"},Ie={class:"invoice-totals-value text-body-2"},Ce={key:3,class:"invoice-totals-row"},Pe={class:"invoice-totals-value text-body-2"},Te={key:4,class:"invoice-totals-row invoice-totals-highlight"},Ve={class:"invoice-totals-value text-body-2 font-weight-medium"},ze={key:5,class:"invoice-totals-row"},Ae={class:"invoice-totals-value text-body-2"},Ue={class:"invoice-totals-row invoice-totals-total"},Me={class:"invoice-totals-value text-subtitle-1 font-weight-bold text-primary"},Ee={class:"invoice-totals-row invoice-totals-paid"},qe={class:"invoice-totals-value text-body-2 font-weight-medium text-success"},Ne={class:"invoice-totals-value text-body-2 font-weight-bold"};function Oe(a,t,c,x,s,i){const h=m("v-icon"),v=m("v-btn"),S=m("v-card-title"),d=m("v-progress-circular"),g=m("v-alert"),w=m("v-col"),C=m("v-row"),A=m("v-chip"),P=m("v-table"),y=m("v-divider"),I=m("v-card-text"),T=m("v-card-actions"),V=m("v-card"),z=m("v-dialog");return r(),F(z,{"model-value":c.modelValue,"onUpdate:modelValue":t[0]||(t[0]=b=>a.$emit("update:modelValue",b)),"max-width":"900px",persistent:"",scrollable:""},{default:l(()=>[o(V,{class:"invoice-card"},{default:l(()=>[o(S,{class:"invoice-header d-flex justify-space-between align-center pa-3"},{default:l(()=>[e("div",Rt,[o(h,{color:"white",size:"24"},{default:l(()=>t[1]||(t[1]=[f("mdi-file-document-outline")])),_:1,__:[1]}),e("div",null,[t[2]||(t[2]=e("div",{class:"text-h6 text-white font-weight-bold"},"INVOICE",-1)),s.saleData?(r(),_("div",Yt," #"+n(s.saleData.invoice_number),1)):D("",!0)])]),o(v,{icon:"mdi-close",variant:"text",color:"white",size:"small",onClick:i.close},null,8,["onClick"])]),_:1}),o(I,{class:"pa-0"},{default:l(()=>[s.loading?(r(),_("div",Kt,[o(d,{indeterminate:"",color:"primary",size:"48"}),t[3]||(t[3]=e("div",{class:"mt-3 text-body-2"},"Loading invoice details...",-1))])):s.saleData?(r(),_("div",Wt,[e("div",Jt,[o(C,{dense:""},{default:l(()=>[o(w,{cols:"12",md:"6"},{default:l(()=>t[5]||(t[5]=[e("div",{class:"invoice-company-info"},[e("div",{class:"text-subtitle-2 font-weight-bold mb-1"},"From"),e("div",{class:"text-body-2 font-weight-medium mb-0"},"Your Company Name"),e("div",{class:"text-caption text-grey"},"Company Address, City, State"),e("div",{class:"text-caption text-grey"},"Phone: +1234567890 | Email: info@company.com ")],-1)])),_:1,__:[5]}),o(w,{cols:"12",md:"6"},{default:l(()=>{var b,E,p,U;return[e("div",Qt,[t[6]||(t[6]=e("div",{class:"text-subtitle-2 font-weight-bold mb-1"},"Bill To",-1)),e("div",Ht,n(((b=s.saleData.customer)==null?void 0:b.name)||"Walk-in Customer"),1),(E=s.saleData.customer)!=null&&E.phone?(r(),_("div",Gt," Phone: "+n(s.saleData.customer.phone),1)):D("",!0),(p=s.saleData.customer)!=null&&p.email?(r(),_("div",Xt," Email: "+n(s.saleData.customer.email),1)):D("",!0),(U=s.saleData.customer)!=null&&U.address?(r(),_("div",Zt,n(s.saleData.customer.address),1)):D("",!0)])]}),_:1})]),_:1}),o(C,{dense:"",class:"mt-2"},{default:l(()=>[o(w,{cols:"12",md:"4"},{default:l(()=>[e("div",$t,[t[7]||(t[7]=e("div",{class:"text-caption text-grey mb-0"},"Invoice Date",-1)),e("div",te,n(i.formatDate(s.saleData.invoice_date)),1)])]),_:1}),s.saleData.due_date?(r(),F(w,{key:0,cols:"12",md:"4"},{default:l(()=>[e("div",ee,[t[8]||(t[8]=e("div",{class:"text-caption text-grey mb-0"},"Due Date",-1)),e("div",se,n(i.formatDate(s.saleData.due_date)),1)])]),_:1})):D("",!0),o(w,{cols:"12",md:"4"},{default:l(()=>[e("div",ae,[t[9]||(t[9]=e("div",{class:"text-caption text-grey mb-0"},"Status",-1)),o(A,{color:i.getStatusColor(s.saleData.status),size:"x-small",variant:"flat",class:"font-weight-medium"},{default:l(()=>{var b;return[f(n(((b=s.saleData.status)==null?void 0:b.toUpperCase())||"PENDING"),1)]}),_:1},8,["color"])])]),_:1})]),_:1})]),e("div",oe,[t[12]||(t[12]=e("div",{class:"text-subtitle-1 font-weight-bold mb-2"},"Items",-1)),o(P,{class:"invoice-table",density:"compact"},{default:l(()=>[t[11]||(t[11]=e("thead",null,[e("tr",{class:"invoice-table-header"},[e("th",{class:"text-left",style:{width:"30px"}},"#"),e("th",{class:"text-left"},"Product"),e("th",{class:"text-center",style:{width:"60px"}},"Qty"),e("th",{class:"text-right",style:{width:"90px"}},"Price"),e("th",{class:"text-right",style:{width:"80px"}},"Disc."),e("th",{class:"text-right",style:{width:"80px"}},"Tax"),e("th",{class:"text-right",style:{width:"100px"}},"Total")])],-1)),e("tbody",null,[!s.saleData.items||s.saleData.items.length===0?(r(),_("tr",ie,t[10]||(t[10]=[e("td",{colspan:"7",class:"text-center py-4 text-grey"},"No items found",-1)]))):D("",!0),(r(!0),_(B,null,j(s.saleData.items||[],(b,E)=>{var p,U;return r(),_("tr",{key:b.id||b.product_id,class:"invoice-table-row"},[e("td",le,n(E+1),1),e("td",null,[e("div",ne,n(((p=b.product)==null?void 0:p.name)||"Unknown"),1),(U=b.product)!=null&&U.sku?(r(),_("div",re,"SKU: "+n(b.product.sku),1)):D("",!0)]),e("td",de,n(b.quantity),1),e("td",ce,"৳"+n(parseFloat(b.unit_price||0).toFixed(2)),1),e("td",ue,"-৳"+n(parseFloat(b.discount||0).toFixed(2)),1),e("td",me,"৳"+n(parseFloat(b.tax||0).toFixed(2)),1),e("td",pe,"৳"+n(parseFloat(b.total||0).toFixed(2)),1)])}),128))])]),_:1,__:[11]})]),e("div",he,[o(C,{dense:""},{default:l(()=>[o(w,{cols:"12",md:"7"},{default:l(()=>[s.saleData.notes?(r(),_("div",fe,[t[13]||(t[13]=e("div",{class:"text-subtitle-2 font-weight-bold mb-1"},"Notes",-1)),e("div",_e,n(s.saleData.notes),1)])):D("",!0),s.saleData.warehouse?(r(),_("div",ve,[t[14]||(t[14]=e("div",{class:"text-subtitle-2 font-weight-bold mb-1"},"Warehouse",-1)),e("div",xe,n(s.saleData.warehouse.name),1)])):D("",!0)]),_:1}),o(w,{cols:"12",md:"5"},{default:l(()=>[e("div",ge,[e("div",ye,[t[15]||(t[15]=e("span",{class:"invoice-totals-label text-caption"},"Subtotal:",-1)),e("span",be,"৳"+n(parseFloat(s.saleData.subtotal||0).toFixed(2)),1)]),i.calculatedItemsDiscount>0&&(!s.saleData.discount_amount||s.saleData.discount_amount===0)?(r(),_("div",we,[t[16]||(t[16]=e("span",{class:"invoice-totals-label text-caption"},"Item Discounts:",-1)),e("span",Se,"-৳"+n(i.calculatedItemsDiscount.toFixed(2)),1)])):D("",!0),s.saleData.discount_amount>0?(r(),_("div",De,[t[17]||(t[17]=e("span",{class:"invoice-totals-label text-caption"},"Order Discount:",-1)),e("span",ke,"-৳"+n(parseFloat(s.saleData.discount_amount).toFixed(2)),1)])):D("",!0),i.calculatedItemsTax>0&&(!s.saleData.tax_amount||s.saleData.tax_amount===0)?(r(),_("div",Fe,[t[18]||(t[18]=e("span",{class:"invoice-totals-label text-caption"},"Item Tax:",-1)),e("span",Ie,"৳"+n(i.calculatedItemsTax.toFixed(2)),1)])):D("",!0),s.saleData.tax_amount>0?(r(),_("div",Ce,[t[19]||(t[19]=e("span",{class:"invoice-totals-label text-caption"},"Order Tax:",-1)),e("span",Pe,"৳"+n(parseFloat(s.saleData.tax_amount).toFixed(2)),1)])):D("",!0),i.calculatedTotalTax>0?(r(),_("div",Te,[t[20]||(t[20]=e("span",{class:"invoice-totals-label text-body-2 font-weight-medium"},"Total Tax:",-1)),e("span",Ve,"৳"+n(i.calculatedTotalTax.toFixed(2)),1)])):D("",!0),s.saleData.shipping_cost>0?(r(),_("div",ze,[t[21]||(t[21]=e("span",{class:"invoice-totals-label text-caption"},"Shipping:",-1)),e("span",Ae,"৳"+n(parseFloat(s.saleData.shipping_cost).toFixed(2)),1)])):D("",!0),o(y,{class:"my-2"}),e("div",Ue,[t[22]||(t[22]=e("span",{class:"invoice-totals-label text-subtitle-1 font-weight-bold"},"Total:",-1)),e("span",Me,"৳"+n(i.calculatedTotalAmount.toFixed(2)),1)]),e("div",Ee,[t[23]||(t[23]=e("span",{class:"invoice-totals-label text-body-2 font-weight-medium text-success"},"Paid:",-1)),e("span",qe,"৳"+n(parseFloat(s.saleData.paid_amount||0).toFixed(2)),1)]),e("div",{class:J(["invoice-totals-row invoice-totals-balance",s.saleData.balance_amount>0?"text-error":"text-success"])},[t[24]||(t[24]=e("span",{class:"invoice-totals-label text-body-2 font-weight-bold"},"Balance:",-1)),e("span",Ne,"৳"+n(parseFloat(s.saleData.balance_amount||0).toFixed(2)),1)],2)])]),_:1})]),_:1})]),t[25]||(t[25]=e("div",{class:"invoice-footer pa-2 text-center"},[e("div",{class:"text-caption text-grey"}," Thank you for your business! ")],-1))])):(r(),_("div",Lt,[o(g,{type:"error",variant:"tonal",class:"ma-3",density:"compact"},{default:l(()=>t[4]||(t[4]=[f(" Failed to load invoice details ")])),_:1,__:[4]})]))]),_:1}),o(y),o(T,{class:"justify-end pa-2 bg-grey-lighten-5"},{default:l(()=>[o(v,{color:"primary","prepend-icon":"mdi-printer",variant:"flat",size:"small",onClick:i.printInvoice},{default:l(()=>t[26]||(t[26]=[f(" Print Invoice ")])),_:1,__:[26]},8,["onClick"]),o(v,{variant:"text",size:"small",onClick:i.close},{default:l(()=>t[27]||(t[27]=[f("Close")])),_:1,__:[27]},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["model-value"])}const Be=L(jt,[["render",Oe],["__scopeId","data-v-d921f09f"]]),je={name:"AdminSales",mixins:[W],components:{SaleDialog:Nt,ViewSaleDialog:Be,DatePicker:tt,PaginationControls:et},data(){return{sales:[],dialog:!1,viewDialog:!1,selectedSale:null,filters:{search:"",status:null,date_from:"",date_to:""},statusOptions:[{title:"Draft",value:"draft"},{title:"Pending",value:"pending"},{title:"Partial",value:"partial"},{title:"Paid",value:"paid"},{title:"Cancelled",value:"cancelled"}],currentPage:1,perPage:10,perPageOptions:[{title:"10",value:10,description:"Quick view"},{title:"25",value:25,description:"Standard"},{title:"50",value:50,description:"Comfortable"},{title:"100",value:100,description:"Extended"},{title:"500",value:500,description:"Large dataset"},{title:"Show All",value:"all",description:"All records"}],pagination:{current_page:1,last_page:1,per_page:10,total:0}}},async mounted(){await this.fetchSales()},methods:{async fetchSales(){try{this.loading=!0;const a=this.buildPaginationParams();this.perPage==="all"&&(a.per_page=999999),this.filters.search&&(a.search=this.filters.search),this.filters.status&&(a.status=this.filters.status),this.filters.date_from&&String(this.filters.date_from).trim()!==""&&(a.from_date=this.filters.date_from),this.filters.date_to&&String(this.filters.date_to).trim()!==""&&(a.to_date=this.filters.date_to);const t=await this.$axios.get("/api/v1/sales",{params:a,headers:this.getAuthHeaders()});this.sales=t.data.data||t.data.sales||[],this.updatePagination(t.data)}catch(a){this.handleApiError(a,"Failed to load sales")}finally{this.loading=!1}},openDialog(){this.selectedSale=null,this.dialog=!0},editSale(a){this.selectedSale=a,this.dialog=!0},viewSale(a){this.selectedSale=a,this.viewDialog=!0},async confirmDelete(a){if(confirm(`Are you sure you want to delete sale ${a.invoice_number}?`))try{await this.$axios.delete(`/api/v1/sales/${a.id}`,{headers:this.getAuthHeaders()}),this.showSuccess("Sale deleted successfully"),await this.fetchSales()}catch(t){this.handleApiError(t,"Error deleting sale")}},printInvoice(a){Q.printInvoice(a,t=>{this.showError(t)})},handleSaved(){this.fetchSales()},resetFilters(){this.filters={search:"",status:null,date_from:"",date_to:""},this.resetPagination(),this.fetchSales()},buildPaginationParams(a={}){return K.buildPaginationParams(this.currentPage,this.perPage,a,this.sortBy,this.sortDirection)},updatePagination(a){K.updatePagination(this,a)},resetPagination(){K.resetPagination(this)},onPerPageUpdate(a){this.perPage=a,this.onPerPageChange()},onPageChange(a){this.currentPage=a,this.fetchSales()},onPerPageChange(){this.resetPagination(),this.fetchSales()},onSort(a){this.handleSort(a),this.currentPage=1,this.fetchSales()},onDateFromChange(a){this.filters.date_from=a||"",this.resetPagination(),this.fetchSales()},onDateToChange(a){this.filters.date_to=a||"",this.resetPagination(),this.fetchSales()},formatDateDDMMYYYY:Bt,getStatusColor(a){return{draft:"grey",pending:"warning",partial:"info",paid:"success",cancelled:"error"}[a]||"grey"}}},Re={class:"page-header"},Ye={class:"text-caption text-grey"},Ke={class:"sortable-header"},Le={class:"sortable-header"},We={class:"sortable-header justify-end"},Je={class:"sortable-header justify-end"},Qe={class:"sortable-header justify-end"},He={class:"sortable-header"},Ge={class:"d-flex"},Xe={class:"font-weight-bold"},Ze={class:"text-end"},$e={class:"text-end"},ts={class:"text-end"},es={key:0},ss={class:"d-flex flex-column flex-md-row justify-space-between align-center align-md-start gap-3 mt-4"},as={class:"text-caption text-grey"},os={key:0},is={key:0},ls={key:1},ns={key:1};function rs(a,t,c,x,s,i){const h=m("v-btn"),v=m("v-select"),S=m("v-col"),d=m("DatePicker"),g=m("v-text-field"),w=m("v-row"),C=m("v-card-text"),A=m("v-card"),P=m("v-card-title"),y=m("v-icon"),I=m("v-skeleton-loader"),T=m("v-chip"),V=m("v-table"),z=m("PaginationControls"),b=m("SaleDialog"),E=m("ViewSaleDialog");return r(),_("div",null,[e("div",Re,[t[14]||(t[14]=e("h1",{class:"text-h4 page-title"},"Sales / POS",-1)),o(h,{color:"primary","prepend-icon":"mdi-plus",onClick:i.openDialog,class:"add-button"},{default:l(()=>t[13]||(t[13]=[f(" New Sale ")])),_:1,__:[13]},8,["onClick"])]),o(A,{class:"mb-4"},{default:l(()=>[o(C,null,{default:l(()=>[o(w,null,{default:l(()=>[o(S,{cols:"12",md:"3"},{default:l(()=>[o(v,{modelValue:s.filters.status,"onUpdate:modelValue":[t[0]||(t[0]=p=>s.filters.status=p),i.fetchSales],items:s.statusOptions,label:"Filter by Status","prepend-inner-icon":"mdi-filter",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),o(S,{cols:"12",md:"3"},{default:l(()=>[o(d,{modelValue:s.filters.date_from,"onUpdate:modelValue":[t[1]||(t[1]=p=>s.filters.date_from=p),i.onDateFromChange],label:"From Date",density:"compact"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(S,{cols:"12",md:"3"},{default:l(()=>[o(d,{modelValue:s.filters.date_to,"onUpdate:modelValue":[t[2]||(t[2]=p=>s.filters.date_to=p),i.onDateToChange],label:"To Date",density:"compact"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(S,{cols:"12",md:"3"},{default:l(()=>[o(g,{modelValue:s.filters.search,"onUpdate:modelValue":t[3]||(t[3]=p=>s.filters.search=p),label:"Search Invoice/Customer","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"",onInput:i.fetchSales},null,8,["modelValue","onInput"])]),_:1})]),_:1})]),_:1})]),_:1}),o(A,null,{default:l(()=>[o(P,{class:"d-flex justify-space-between align-center"},{default:l(()=>[t[16]||(t[16]=e("span",null,"Sales",-1)),e("span",Ye,[t[15]||(t[15]=f(" Total Records: ")),e("strong",null,n(s.pagination.total||0),1)])]),_:1,__:[16]}),o(C,null,{default:l(()=>[o(V,null,{default:l(()=>[e("thead",null,[e("tr",null,[e("th",{class:"sortable",onClick:t[4]||(t[4]=p=>i.onSort("invoice_number"))},[e("div",Ke,[t[18]||(t[18]=e("span",null,"Invoice #",-1)),a.sortBy==="invoice_number"?(r(),F(y,{key:0,size:"18",class:"sort-icon active"},{default:l(()=>[f(n(a.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(r(),F(y,{key:1,size:"18",class:"sort-icon inactive"},{default:l(()=>t[17]||(t[17]=[f(" mdi-unfold-more-horizontal ")])),_:1,__:[17]}))])]),t[29]||(t[29]=e("th",null,"Customer",-1)),e("th",{class:"sortable",onClick:t[5]||(t[5]=p=>i.onSort("invoice_date"))},[e("div",Le,[t[20]||(t[20]=e("span",null,"Date",-1)),a.sortBy==="invoice_date"?(r(),F(y,{key:0,size:"18",class:"sort-icon active"},{default:l(()=>[f(n(a.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(r(),F(y,{key:1,size:"18",class:"sort-icon inactive"},{default:l(()=>t[19]||(t[19]=[f(" mdi-unfold-more-horizontal ")])),_:1,__:[19]}))])]),e("th",{class:"text-end sortable",onClick:t[6]||(t[6]=p=>i.onSort("total_amount"))},[e("div",We,[t[22]||(t[22]=e("span",null,"Total",-1)),a.sortBy==="total_amount"?(r(),F(y,{key:0,size:"18",class:"sort-icon active"},{default:l(()=>[f(n(a.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(r(),F(y,{key:1,size:"18",class:"sort-icon inactive"},{default:l(()=>t[21]||(t[21]=[f(" mdi-unfold-more-horizontal ")])),_:1,__:[21]}))])]),e("th",{class:"text-end sortable",onClick:t[7]||(t[7]=p=>i.onSort("paid_amount"))},[e("div",Je,[t[24]||(t[24]=e("span",null,"Paid",-1)),a.sortBy==="paid_amount"?(r(),F(y,{key:0,size:"18",class:"sort-icon active"},{default:l(()=>[f(n(a.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(r(),F(y,{key:1,size:"18",class:"sort-icon inactive"},{default:l(()=>t[23]||(t[23]=[f(" mdi-unfold-more-horizontal ")])),_:1,__:[23]}))])]),e("th",{class:"text-end sortable",onClick:t[8]||(t[8]=p=>i.onSort("balance_amount"))},[e("div",Qe,[t[26]||(t[26]=e("span",null,"Due",-1)),a.sortBy==="balance_amount"?(r(),F(y,{key:0,size:"18",class:"sort-icon active"},{default:l(()=>[f(n(a.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(r(),F(y,{key:1,size:"18",class:"sort-icon inactive"},{default:l(()=>t[25]||(t[25]=[f(" mdi-unfold-more-horizontal ")])),_:1,__:[25]}))])]),e("th",{class:"sortable",onClick:t[9]||(t[9]=p=>i.onSort("status"))},[e("div",He,[t[28]||(t[28]=e("span",null,"Status",-1)),a.sortBy==="status"?(r(),F(y,{key:0,size:"18",class:"sort-icon active"},{default:l(()=>[f(n(a.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(r(),F(y,{key:1,size:"18",class:"sort-icon inactive"},{default:l(()=>t[27]||(t[27]=[f(" mdi-unfold-more-horizontal ")])),_:1,__:[27]}))])]),t[30]||(t[30]=e("th",null,"Actions",-1))])]),e("tbody",null,[a.loading?(r(),_(B,{key:0},j(5,p=>e("tr",{key:`skeleton-${p}`},[e("td",null,[o(I,{type:"text",width:"100"})]),e("td",null,[o(I,{type:"text",width:"120"})]),e("td",null,[o(I,{type:"text",width:"90"})]),e("td",null,[o(I,{type:"text",width:"80"})]),e("td",null,[o(I,{type:"text",width:"80"})]),e("td",null,[o(I,{type:"chip",width:"80",height:"24"})]),e("td",null,[o(I,{type:"chip",width:"80",height:"24"})]),e("td",null,[e("div",Ge,[o(I,{type:"button",width:"32",height:"32",class:"mr-1"}),o(I,{type:"button",width:"32",height:"32",class:"mr-1"}),o(I,{type:"button",width:"32",height:"32",class:"mr-1"}),o(I,{type:"button",width:"32",height:"32"})])])])),64)):(r(),_(B,{key:1},[(r(!0),_(B,null,j(s.sales,p=>{var U;return r(),_("tr",{key:p.id},[e("td",null,[e("span",Xe,n(p.invoice_number),1)]),e("td",null,n(((U=p.customer)==null?void 0:U.name)||"Walk-in"),1),e("td",null,n(i.formatDateDDMMYYYY(p.invoice_date)),1),e("td",Ze," ৳"+n(parseFloat(p.total_amount).toFixed(2)),1),e("td",$e," ৳"+n(parseFloat(p.paid_amount).toFixed(2)),1),e("td",ts,[o(T,{color:p.balance_amount>0?"error":"success",size:"small"},{default:l(()=>[f(" ৳"+n(parseFloat(p.balance_amount).toFixed(2)),1)]),_:2},1032,["color"])]),e("td",null,[o(T,{color:i.getStatusColor(p.status),size:"small"},{default:l(()=>[f(n(p.status),1)]),_:2},1032,["color"])]),e("td",null,[o(h,{icon:"mdi-eye",size:"small",variant:"text",onClick:k=>i.viewSale(p)},null,8,["onClick"]),o(h,{icon:"mdi-pencil",size:"small",variant:"text",onClick:k=>i.editSale(p)},null,8,["onClick"]),o(h,{icon:"mdi-printer",size:"small",variant:"text",onClick:k=>i.printInvoice(p)},null,8,["onClick"]),o(h,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:k=>i.confirmDelete(p)},null,8,["onClick"])])])}),128)),s.sales.length===0?(r(),_("tr",es,t[31]||(t[31]=[e("td",{colspan:"8",class:"text-center py-4"},"No sales found",-1)]))):D("",!0)],64))])]),_:1}),e("div",ss,[e("div",as,[s.sales.length>0&&s.pagination.total>0?(r(),_("span",os,[s.perPage==="all"?(r(),_("span",is,[t[32]||(t[32]=f(" Showing ")),e("strong",null,"all "+n(s.pagination.total.toLocaleString()),1),t[33]||(t[33]=f(" records "))])):(r(),_("span",ls,[t[34]||(t[34]=f(" Showing ")),e("strong",null,n((s.currentPage-1)*s.perPage+1),1),t[35]||(t[35]=f(" to ")),e("strong",null,n(Math.min(s.currentPage*s.perPage,s.pagination.total)),1),t[36]||(t[36]=f(" of ")),e("strong",null,n(s.pagination.total.toLocaleString()),1),t[37]||(t[37]=f(" records "))]))])):(r(),_("span",ns,"No records found"))]),o(z,{modelValue:s.currentPage,"onUpdate:modelValue":t[10]||(t[10]=p=>s.currentPage=p),pagination:s.pagination,"per-page-value":s.perPage,"per-page-options":s.perPageOptions,"onUpdate:perPage":i.onPerPageUpdate,onPageChange:i.onPageChange},null,8,["modelValue","pagination","per-page-value","per-page-options","onUpdate:perPage","onPageChange"])])]),_:1})]),_:1}),o(b,{"model-value":s.dialog,"onUpdate:modelValue":t[11]||(t[11]=p=>s.dialog=p),sale:s.selectedSale,onSaved:i.handleSaved},null,8,["model-value","sale","onSaved"]),o(E,{"model-value":s.viewDialog,"onUpdate:modelValue":t[12]||(t[12]=p=>s.viewDialog=p),sale:s.selectedSale},null,8,["model-value","sale"])])}const hs=L(je,[["render",rs],["__scopeId","data-v-b536ff91"]]);export{hs as default};
